var BitShuva;Array.prototype.includes||(Array.prototype.includes=function(n){"use strict";var f=Object(this),u=parseInt(f.length)||0,i,t,r;if(u===0)return!1;for(i=parseInt(arguments[1])||0,i>=0?t=i:(t=u+i,t<0&&(t=0));t<u;){if(r=f[t],n===r||n!==n&&r!==r)return!0;t++}return!1});Array.prototype.find||(Array.prototype.find=function(n){var t;if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof n!="function")throw new TypeError("predicate must be a function");var i=Object(this),u=i.length>>>0,f=arguments[1],r;for(t=0;t<u;t++)if(r=i[t],n.call(f,r,t,i))return r;return undefined});window.Modernizr=function(n,t,i){function y(n){k.cssText=n}function u(n,t){return typeof n===t}function tt(n,t){return!!~(""+n).indexOf(t)}function p(n,t){var u,r;for(u in n)if(r=n[u],!tt(r,"-")&&k[r]!==i)return t=="pfx"?r:!0;return!1}function it(n,t,r){var e,f;for(e in n)if(f=t[n[e]],f!==i)return r===!1?n[e]:u(f,"function")?f.bind(r||t):f;return!1}function w(n,t,i){var r=n.charAt(0).toUpperCase()+n.slice(1),f=(n+" "+g.join(r+" ")+r).split(" ");return u(t,"string")||u(t,"undefined")?p(f,t):(f=(n+" "+nt.join(r+" ")+r).split(" "),it(f,t,i))}var r={},s=!0,h=t.documentElement,b=t.createElement("modernizr"),k=b.style,rt,ft={}.toString,d="Webkit Moz O ms",g=d.split(" "),nt=d.toLowerCase().split(" "),f={},c=[],l=c.slice,e,a={}.hasOwnProperty,v,o;v=!u(a,"undefined")&&!u(a.call,"undefined")?function(n,t){return a.call(n,t)}:function(n,t){return t in n&&u(n.constructor.prototype[t],"undefined")};Function.prototype.bind||(Function.prototype.bind=function(n){var t=this,i,r;if(typeof t!="function")throw new TypeError;return i=l.call(arguments,1),r=function(){var f,e,u;return this instanceof r?(f=function(){},f.prototype=t.prototype,e=new f,u=t.apply(e,i.concat(l.call(arguments))),Object(u)===u?u:e):t.apply(n,i.concat(l.call(arguments)))},r});f.csstransitions=function(){return w("transition")};f.audio=function(){var i=t.createElement("audio"),n=!1;try{(n=!!i.canPlayType)&&(n=new Boolean(n),n.ogg=i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),n.mp3=i.canPlayType("audio/mpeg;").replace(/^no$/,""),n.wav=i.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),n.m4a=(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(r){}return n};for(o in f)v(f,o)&&(e=o.toLowerCase(),r[e]=f[o](),c.push((r[e]?"":"no-")+e));return r.addTest=function(n,t){if(typeof n=="object")for(var u in n)v(n,u)&&r.addTest(u,n[u]);else{if(n=n.toLowerCase(),r[n]!==i)return r;t=typeof t=="function"?t():t;typeof s!="undefined"&&s&&(h.className+=" "+(t?"":"no-")+n);r[n]=t}return r},y(""),b=rt=null,function(n,t){function v(n,t){var i=n.createElement("p"),r=n.getElementsByTagName("head")[0]||n.documentElement;return i.innerHTML="x<style>"+t+"<\/style>",r.insertBefore(i.lastChild,r.firstChild)}function s(){var n=r.elements;return typeof n=="string"?n.split(" "):n}function u(n){var t=a[n[l]];return t||(t={},o++,n[l]=o,a[o]=t),t}function h(n,r,f){if(r||(r=t),i)return r.createElement(n);f||(f=u(r));var e;return e=f.cache[n]?f.cache[n].cloneNode():b.test(n)?(f.cache[n]=f.createElem(n)).cloneNode():f.createElem(n),e.canHaveChildren&&!w.test(n)&&!e.tagUrn?f.frag.appendChild(e):e}function y(n,r){if(n||(n=t),i)return n.createDocumentFragment();r=r||u(n);for(var e=r.frag.cloneNode(),f=0,o=s(),h=o.length;f<h;f++)e.createElement(o[f]);return e}function p(n,t){t.cache||(t.cache={},t.createElem=n.createElement,t.createFrag=n.createDocumentFragment,t.frag=t.createFrag());n.createElement=function(i){return r.shivMethods?h(i,n,t):t.createElem(i)};n.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+s().join().replace(/[\w\-]+/g,function(n){return t.createElem(n),t.frag.createElement(n),'c("'+n+'")'})+");return n}")(r,t.frag)}function c(n){n||(n=t);var f=u(n);return r.shivCSS&&!e&&!f.hasCSS&&(f.hasCSS=!!v(n,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),i||p(n,f),n}var f=n.html5||{},w=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,b=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,e,l="_html5shiv",o=0,a={},i,r;(function(){try{var n=t.createElement("a");n.innerHTML="<xyz><\/xyz>";e="hidden"in n;i=n.childNodes.length==1||function(){t.createElement("a");var n=t.createDocumentFragment();return typeof n.cloneNode=="undefined"||typeof n.createDocumentFragment=="undefined"||typeof n.createElement=="undefined"}()}catch(r){e=!0;i=!0}})();r={elements:f.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:"3.7.0",shivCSS:f.shivCSS!==!1,supportsUnknownElements:i,shivMethods:f.shivMethods!==!1,type:"default",shivDocument:c,createElement:h,createDocumentFragment:y};n.html5=r;c(t)}(this,t),r._version="2.7.1",r._domPrefixes=nt,r._cssomPrefixes=g,r.testProp=function(n){return p([n])},r.testAllProps=w,h.className=h.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(s?" js "+c.join(" "):""),r}(this,this.document),function(n,t,i){function h(n){return"[object Function]"==y.call(n)}function c(n){return"string"==typeof n}function l(){}function w(n){return!n||"loaded"==n||"complete"==n||"uninitialized"==n}function f(){var n=a.shift();v=1;n?n.t?s(function(){("c"==n.t?u.injectCss:u.injectJs)(n.s,0,n.a,n.x,n.e,1)},0):(n(),f()):v=0}function ut(n,i,o,h,c,l,y){function k(t){if(!nt&&w(p.readyState)&&(tt.r=nt=1,!v&&f(),p.onload=p.onreadystatechange=null,t)){"img"!=n&&s(function(){g.removeChild(p)},50);for(var u in r[i])r[i].hasOwnProperty(u)&&r[i][u].onload()}}var y=y||u.errorTimeout,p=t.createElement(n),nt=0,b=0,tt={t:o,s:i,e:c,a:l,x:y};1===r[i]&&(b=1,r[i]=[]);"object"==n?p.data=i:(p.src=i,p.type=n);p.width=p.height="0";p.onerror=p.onload=p.onreadystatechange=function(){k.call(this,b)};a.splice(h,0,tt);"img"!=n&&(b||2===r[i]?(g.insertBefore(p,d?null:e),s(k,y)):r[i].push(p))}function ft(n,t,i,r,u){return v=0,t=t||"j",c(n)?ut("c"==t?et:nt,n,t,this.i++,i,r,u):(a.splice(this.i++,0,n),1==a.length&&f()),this}function b(){var n=u;return n.loader={load:ft,i:0},n}var o=t.documentElement,s=n.setTimeout,e=t.getElementsByTagName("script")[0],y={}.toString,a=[],v=0,k="MozAppearance"in o.style,d=k&&!!t.createRange().compareNode,g=d?o:e.parentNode,o=n.opera&&"[object Opera]"==y.call(n.opera),o=!!t.attachEvent&&!o,nt=k?"object":o?"script":"img",et=o?"script":nt,tt=Array.isArray||function(n){return"[object Array]"==y.call(n)},p=[],r={},it={timeout:function(n,t){return t.length&&(n.timeout=t[0]),n}},rt,u;u=function(n){function a(n){for(var n=n.split("!"),f=p.length,i=n.pop(),e=n.length,i={url:i,origUrl:i,prefixes:n},u,r,t=0;t<e;t++)r=n[t].split("="),(u=it[r.shift()])&&(i=u(i,r));for(t=0;t<f;t++)i=p[t](i);return i}function f(n,t,u,f,e){var o=a(n),s=o.autoCallback;o.url.split(".").pop().split("?").shift();o.bypass||(t&&(t=h(t)?t:t[n]||t[f]||t[n.split("/").pop().split("?")[0]]),o.instead?o.instead(n,t,u,f,e):(r[o.url]?o.noexec=!0:r[o.url]=1,u.load(o.url,o.forceCSS||!o.forceJS&&"css"==o.url.split(".").pop().split("?").shift()?"c":i,o.noexec,o.attrs,o.timeout),(h(t)||h(s))&&u.load(function(){b();t&&t(o.origUrl,e,f);s&&s(o.origUrl,e,f);r[o.url]=2})))}function s(n,t){function a(n,o){if(n){if(c(n))o||(i=function(){var n=[].slice.call(arguments);s.apply(this,n);u()}),f(n,i,t,0,e);else if(Object(n)===n)for(r in v=function(){var t=0;for(var i in n)n.hasOwnProperty(i)&&t++;return t}(),n)n.hasOwnProperty(r)&&(!o&&!--v&&(h(i)?i=function(){var n=[].slice.call(arguments);s.apply(this,n);u()}:i[r]=function(n){return function(){var t=[].slice.call(arguments);n&&n.apply(this,t);u()}}(s[r])),f(n[r],i,t,r,e))}else o||u()}var e=!!n.test,o=n.load||n.both,i=n.callback||l,s=i,u=n.complete||l,v,r;a(e?n.yep:n.nope,!!o);o&&a(o)}var e,t,o=this.yepnope.loader;if(c(n))f(n,0,o,0);else if(tt(n))for(e=0;e<n.length;e++)t=n[e],c(t)?f(t,0,o,0):tt(t)?u(t):Object(t)===t&&s(t,o);else Object(n)===n&&s(n,o)};u.addPrefix=function(n,t){it[n]=t};u.addFilter=function(n){p.push(n)};u.errorTimeout=1e4;null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",rt=function(){t.removeEventListener("DOMContentLoaded",rt,0);t.readyState="complete"},0));n.yepnope=b();n.yepnope.executeStack=f;n.yepnope.injectJs=function(n,i,r,o,h,c){var a=t.createElement("script"),v,y,o=o||u.errorTimeout;a.src=n;for(y in r)a.setAttribute(y,r[y]);i=c?f:i||l;a.onreadystatechange=a.onload=function(){!v&&w(a.readyState)&&(v=1,i(),a.onload=a.onreadystatechange=null)};s(function(){v||(v=1,i(1))},o);h?a.onload():e.parentNode.insertBefore(a,e)};n.yepnope.injectCss=function(n,i,r,u,o,h){var u=t.createElement("link"),c,i=h?f:i||l;u.href=n;u.rel="stylesheet";u.type="text/css";for(c in r)u.setAttribute(c,r[c]);o||(e.parentNode.insertBefore(u,e),s(i,0))}}(this,document);Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};String.prototype.includes||(String.prototype.includes=function(){"use strict";return String.prototype.indexOf.apply(this,arguments)!==-1});String.prototype.endsWith||(String.prototype.endsWith=function(n,t){var i=this.toString(),r;return(t===undefined||t>i.length)&&(t=i.length),t!==undefined&&t!==null&&(t-=n.length),r=i.indexOf(n,t),r!==-1&&r===t});String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return t=t||0,this.lastIndexOf(n,t)===t}),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.fetcher=n;this.cacheKey=t;this.cacheSelector=i;this.afterLoadProcessor=r;this.items=[];this.hasLoaded=!1;this.isLoading=!1;this.noItemsText="There are no results";t&&this.rehydrateCachedItems(t,i)}return n.prototype.reset=function(){this.items.length=0;this.isLoading=!1},n.prototype.resetAndFetch=function(){this.reset();this.fetch()},n.prototype.fetch=function(){var n=this,t;return this.isLoading?null:(this.isLoading=!0,this.hasLoaded=!1,t=this.fetcher(),t.then(function(t){n.isLoading&&(n.items=t,n.afterLoadProcessor&&n.afterLoadProcessor(t),n.cacheKey&&setTimeout(function(){return n.cacheItems(n.cacheKey,t)},0));n.hasLoaded=!0}).finally(function(){return n.isLoading=!1}),t)},n.prototype.remove=function(n){var t=this.items.length,i=_.pull(this.items,n);return t>i.length},n.prototype.cache=function(){this.cacheKey&&this.cacheItems(this.cacheKey,this.items)},n.prototype.rehydrateCachedItems=function(n,t){var i,r;try{i=window.localStorage.getItem(n);i&&(r=JSON.parse(i),this.items=t?r.map(function(n){return t(n)}):r,this.afterLoadProcessor&&this.afterLoadProcessor(this.items))}catch(u){console.log("Failed to rehydrated cached items for cacheKey",n,u)}},n.prototype.cacheItems=function(n,t){try{var i=JSON.stringify(t);window.localStorage.setItem(n,i)}catch(r){console.log("Unable to cache list of items with cache key",n,t,r)}},Object.defineProperty(n.prototype,"isLoadedWithData",{get:function(){return this.hasLoaded&&!this.isLoading&&this.itemsTotalCount>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoadedAndEmpty",{get:function(){return this.itemsTotalCount===0&&!this.isLoading},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"itemsTotalCount",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),n}();n.List=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){this.fetcher=n;this.cacheKey=t;this.afterFetch=i;this.skip=0;this.take=10;this.items=[];this.isLoading=!1;this.noItemsText="There are no results";t&&this.rehydrateCachedItems(t)}return n.prototype.reset=function(){this.skip=0;this.items.length=0;this.itemsTotalCount=null;this.isLoading=!1},n.prototype.resetAndFetch=function(){this.reset();this.fetchNextChunk()},n.prototype.fetchNextChunk=function(){var n=this,t;this.isLoading||(this.isLoading=!0,t=this.skip,this.fetcher(t,this.take).then(function(i){var u,r;n.isLoading&&(r=n.cacheKey,r&&t===0&&(n.items.length=0,n.cacheItems(r,i.items)),(u=n.items).push.apply(u,i.items),n.itemsTotalCount=i.total,n.skip+=i.items.length,n.afterFetch&&n.afterFetch(n.items))}).finally(function(){return n.isLoading=!1}))},n.prototype.rehydrateCachedItems=function(n){try{var t=window.localStorage.getItem(n);t&&(this.items=JSON.parse(t),this.afterFetch&&this.afterFetch(this.items))}catch(i){console.log("Failed to rehydrated cached items for cacheKey",n,i)}},n.prototype.cacheItems=function(n,t){try{var i=JSON.stringify(t);window.localStorage.setItem(n,i)}catch(r){console.log("Unable to cache list of items with cache key",n,t,r)}},Object.defineProperty(n.prototype,"isLoadedWithData",{get:function(){return this.itemsTotalCount!=null&&this.itemsTotalCount>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoadedAndEmpty",{get:function(){return this.itemsTotalCount===0&&!this.isLoading},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hasMoreItems",{get:function(){return this.itemsTotalCount!=null&&this.itemsTotalCount>this.items.length},enumerable:!0,configurable:!0}),n}();n.PagedList=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Anonymous=0]="Anonymous";n[n.Authenticated=1]="Authenticated";n[n.Admin=2]="Admin"})(t=n.RouteAccess||(n.RouteAccess={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.isSaving=!1;angular.merge(this,n)}return n}();n.Album=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(t){this.isSaving=!1;t||(t=n.createDefaultServerObj());angular.merge(this,t)}return n.prototype.updateFrom=function(n){angular.merge(this,n)},n.createDefaultServerObj=function(){return{bio:"",images:[],name:""}},n}();n.Artist=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Paused=0]="Paused";n[n.Playing=1]="Playing";n[n.Ended=2]="Ended";n[n.Erred=3]="Erred";n[n.Stalled=4]="Stalled";n[n.Buffering=5]="Buffering";n[n.Aborted=6]="Aborted"})(t=n.AudioStatus||(n.AudioStatus={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Normal=0]="Normal";n[n.VeryPoor=1]="VeryPoor";n[n.Poor=2]="Poor";n[n.Good=3]="Good";n[n.Great=4]="Great";n[n.Best=5]="Best"})(t=n.CommunityRankStanding||(n.CommunityRankStanding={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.NowPlaying=0]="NowPlaying";n[n.Trending=1]="Trending";n[n.Top=2]="Top";n[n.Likes=3]="Likes";n[n.Other=4]="Other"})(t=n.HeaderRoute||(n.HeaderRoute={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.NotSpecified=0]="NotSpecified";n[n.Like=1]="Like";n[n.Love=2]="Love";n[n.Favorite=3]="Favorite"})(t=n.LikeLevel||(n.LikeLevel={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Trace=0]="Trace";n[n.Debug=1]="Debug";n[n.Information=2]="Information";n[n.Warning=3]="Warning";n[n.Error=4]="Error";n[n.Critical=5]="Critical";n[n.None=6]="None"})(t=n.LogLevel||(n.LogLevel={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Oldest=0]="Oldest";n[n.Newest=1]="Newest";n[n.OccurrenceCount=2]="OccurrenceCount"})(t=n.LogSort||(n.LogSort={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(){})(t=n.Server||(n.Server={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Success=0]="Success";n[n.LockedOut=1]="LockedOut";n[n.RequiresVerification=2]="RequiresVerification";n[n.Failure=3]="Failure"})(t=n.SignInStatus||(n.SignInStatus={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.albumArtOrArtistImage="";this.isCumulativeRank=!0;this.albumSwatchBackground="white";this.albumSwatchForeground="black";this.albumSwatchMuted="silver";this.albumSwatchTextShadow="white";this.albumSwatchDarker="black";this.albumSwatchLighter="white";this.hasSetAlbumArtColors=!1;this.isLyricsExpanded=!1;this.isSongStatusExpanded=!1;this.isSupportExpanded=!1;this.isShareExpanded=!1;this.isEditingLyrics=!1;this.isShowingEmbedCode=!1;angular.merge(this,n);"albumSwatchBackground"in n&&(this.hasSetAlbumArtColors=!0);this.clientId=n.id+"_"+((new Date).getTime()+Math.random())}return Object.defineProperty(t.prototype,"communityRankText",{get:function(){return this.communityRank>0?"+"+this.communityRank.toString():this.communityRank.toString()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"communityRankStandingText",{get:function(){switch(this.communityRankStanding){case n.CommunityRankStanding.Best:return"Best";case n.CommunityRankStanding.Good:return"Good";case n.CommunityRankStanding.Great:return"Great";case n.CommunityRankStanding.Poor:return"Poor";case n.CommunityRankStanding.VeryPoor:return"Very Poor";case n.CommunityRankStanding.Normal:default:return"Average"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nthSongText",{get:function(){return this.number===0?"1st":this.number===1?"1st":this.number===2?"2nd":this.number===3?"3rd":this.number>=4&&this.number<=19?this.number+"th":"#"+this.number},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reasonPlayedText",{get:function(){return this._reasonPlayedText||(this._reasonPlayedText=this.createReasonPlayedText()),this._reasonPlayedText},enumerable:!0,configurable:!0}),t.prototype.updateFrom=function(n){angular.merge(this,n)},t.prototype.updateAlbumArtColors=function(n){this.hasSetAlbumArtColors=!0;this.albumSwatchBackground=n.backgroundColor||this.albumSwatchBackground;this.albumSwatchForeground=n.foregroundColor||this.albumSwatchForeground;this.albumSwatchMuted=n.mutedColor||this.albumSwatchMuted;this.albumSwatchTextShadow=n.textShadowColor||this.albumSwatchTextShadow;var i=tinycolor(this.albumSwatchBackground).getBrightness(),r=tinycolor(this.albumSwatchForeground).getBrightness(),t=r>=i;this.albumSwatchLighter=t?this.albumSwatchForeground:this.albumSwatchBackground;this.albumSwatchDarker=t?this.albumSwatchBackground:this.albumSwatchForeground},t.empty=function(){return new t({album:"",albumId:"",albumArtUri:"",artist:"",artistId:"",communityRank:0,communityRankStanding:0,id:"songs/0",artistImages:[],genres:[],lyrics:"",name:"",number:0,purchaseUri:"",songLike:0,tags:[],totalPlays:0,uri:"",reasonsPlayed:this.createEmptySongPickReasons("songs/0")})},t.prototype.setSolePickReason=function(n){this.reasonsPlayed=t.createEmptySongPickReasons(this.id);this.reasonsPlayed.soleReason=n},t.prototype.createReasonPlayedText=function(){var i="Chavah plays random songs from time to time to see what kind of music you like",t;if(this.reasonsPlayed){if(this.reasonsPlayed.soleReason!==null)switch(this.reasonsPlayed.soleReason){case n.SongPick.SomeoneRequestedSong:return"it was requested by a listener";case n.SongPick.SongFromAlbumRequested:return"you asked to hear another song from the "+this.album+" album";case n.SongPick.SongFromArtistRequested:return"you asked to hear another song from "+this.artist;case n.SongPick.SongWithTagRequested:return"you asked to hear another song with this tag";case n.SongPick.VeryPoorRank:return"...well, even the lowest-ranked songs will get played sometimes :-)";case n.SongPick.YouRequestedSong:return"you asked Chavah to play it";case n.SongPick.RandomSong:default:return i}return(t=[],this.reasonsPlayed.ranking===n.LikeLevel.Favorite?t.push("it's one of the highest ranked songs on Chavah"):this.reasonsPlayed.ranking===n.LikeLevel.Love?t.push("it's got a great community ranking"):this.reasonsPlayed.ranking===n.LikeLevel.Like&&t.push("it's got a good community ranking"),this.reasonsPlayed.artist===n.LikeLevel.Favorite?t.push(this.artist+" is one of your favorite artists"):this.reasonsPlayed.artist===n.LikeLevel.Love?t.push("you love "+this.artist+" and have thumbed-up an abundance of "+this.artist+" songs"):this.reasonsPlayed.artist===n.LikeLevel.Like&&t.push("you like "+this.artist),this.reasonsPlayed.album===n.LikeLevel.Favorite&&t.push("you like nearly all the songs on "+this.album),this.reasonsPlayed.album===n.LikeLevel.Love?t.push("you love "+this.album):this.reasonsPlayed.album===n.LikeLevel.Like&&t.push("you like "+this.album),this.reasonsPlayed.songThumbedUp&&t.push("you like this song"),this.reasonsPlayed.similar===n.LikeLevel.Favorite?t.push("it's similar to some of your favorite songs"):this.reasonsPlayed.similar===n.LikeLevel.Love?t.push("you love similiar songs"):this.reasonsPlayed.similar===n.LikeLevel.Like&&t.push("you like similiar songs"),t.length===0)?"you might like it":t.length===1?t[0]:t.length===2?t.join(" and "):(t[t.length-1]="and "+t[t.length-1],t.join(", "))}return i},t.createEmptySongPickReasons=function(t){return{album:n.LikeLevel.NotSpecified,artist:n.LikeLevel.NotSpecified,ranking:n.LikeLevel.NotSpecified,similar:n.LikeLevel.NotSpecified,songThumbedUp:!1,songId:t,soleReason:null}},t.defaultSwatch={getBodyTextColor:function(){return"black"},getHex:function(){return"white"},getHsl:function(){return"black"},getPopulation:function(){return 0},getTitleTextColor:function(){return"black"},hsl:[255,255,255],rgb:[255,255,255]},t}();n.Song=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Pending=0]="Pending";n[n.Rejected=1]="Rejected";n[n.Approved=2]="Approved"})(t=n.SongEditStatus||(n.SongEditStatus={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Unranked=0]="Unranked";n[n.Liked=1]="Liked";n[n.Disliked=2]="Disliked"})(t=n.SongLike||(n.SongLike={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.RandomSong=0]="RandomSong";n[n.VeryPoorRank=1]="VeryPoorRank";n[n.PoorRank=2]="PoorRank";n[n.NormalRank=3]="NormalRank";n[n.GoodRank=4]="GoodRank";n[n.GreatRank=5]="GreatRank";n[n.BestRank=6]="BestRank";n[n.LikedArtist=7]="LikedArtist";n[n.LikedAlbum=8]="LikedAlbum";n[n.LikedSong=9]="LikedSong";n[n.LikedTag=10]="LikedTag";n[n.SongFromAlbumRequested=11]="SongFromAlbumRequested";n[n.SongFromArtistRequested=12]="SongFromArtistRequested";n[n.SongWithTagRequested=13]="SongWithTagRequested";n[n.YouRequestedSong=14]="YouRequestedSong";n[n.SomeoneRequestedSong=15]="SomeoneRequestedSong"})(t=n.SongPick||(n.SongPick={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.activeOccurrenceIndex=0;this.activeCategory="Message";this.isExpanded=!1;angular.merge(this,n)}return n}();n.StructuredLog=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){angular.merge(this,n)}return Object.defineProperty(n.prototype,"isAdmin",{get:function(){return this.roles.includes(n.roles.admin)},enumerable:!0,configurable:!0}),n.prototype.updateFrom=function(n){angular.merge(this,n)},n.roles={admin:"admin"},n}();n.User=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){"use strict";function r(n){var t=u.cacheBustedAngularViews.find(function(t){return t.search(new RegExp(n,"i"))!==-1});if(!t)throw new Error("Unable to find cache-busted Angular view "+n);return t}function t(t,i){i===void 0&&(i=n.RouteAccess.Anonymous);var u=r(t);return{templateUrl:u,access:i}}var u,f,i;n.App=angular.module("ChavahApp",["ngRoute","ngAnimate","ui.bootstrap","ui.bootstrap.tpls","LocalStorageModule",]);u=window["BitShuva.Chavah.HomeViewModel"];n.App.constant("initConfig",u);n.FindAppView=r;f={artistList:r("/partials/ArtistList.html"),songList:r("/partials/SongList.html"),songRequestModal:r("/modals/RequestSongModal.html"),confirmDeleteSongModal:r("/modals/ConfirmDeleteSongModal.html"),songRequestResult:r("/partials/SongRequestResult.html"),headerPartial:r("/partials/Header.html"),footerPartial:r("/partials/Footer.html"),adminSidebar:r("/partials/AdminSidebar.html"),goBack:r("/partials/GoBack.html"),cropImageModal:r("/modals/CropImageModal.html")};n.App.constant("templatePaths",f);i={nowPlaying:"/NowPlaying.html",trending:"/Trending.html",profile:"/Profile.html",popular:"/Popular.html",recent:"/RecentSongs.html",myLikes:"/MyLikes.html",editSong:"/EditSong.html",shareThanks:"/ShareThanks.html",about:"/Legal.html",welcome:"/Welcome.html",songEditApproved:"/SongEditApproved.html",privacyPolicy:"/PrivacyPolicy.html",support:"/Support.html",promptSignIn:"/PromptSignIn.html",signIn:"/SignIn.html",password:"/Password.html",forgotPassword:"/ForgotPassword.html",createPassword:"/CreatePassword.html",register:"/Register.html",confirmEmail:"/ConfirmEmail.html",resetPassword:"/ResetPassword.html",donate:"/Donate.html",donateSuccess:"/DonateSuccess.html",donateCancelled:"/DonateCancelled.html",albums:"/Albums.html",uploadAlbum:"/UploadAlbum.html",createAlbum:"/EditAlbum.html",editAlbum:"/EditAlbum.html",editArtist:"/EditArtist.html",songEdits:"/ApproveSongEdits.html",tags:"/TagEditor.html",logs:"/LogEditor.html",editSongs:"/EditSongs.html"};n.App.config(["$routeProvider","$locationProvider",function(r,u){r.caseInsensitiveMatch=!0;u.hashPrefix("");r.when("/",t("NowPlaying.html")).when("/nowplaying",{redirectTo:"/"}).when("/trending",t("Trending.html")).when("/profile",t(i.profile,n.RouteAccess.Authenticated)).when("/popular",t(i.popular)).when("/recent",t(i.recent)).when("/mylikes",t(i.myLikes)).when("/edit/songs/:id",t(i.editSong,n.RouteAccess.Authenticated)).when("/sharethanks/:artist?",t(i.shareThanks)).when("/about",t(i.about)).when("/welcome",t(i.welcome)).when("/songeditapproved/:artist/:songName",t(i.songEditApproved)).when("/privacy",t(i.privacyPolicy)).when("/support",t(i.support)).when("/promptsignin",t(i.promptSignIn)).when("/signin",t(i.signIn)).when("/password/:email",t(i.password)).when("/forgotpassword",t(i.forgotPassword)).when("/createpassword/:email",t(i.createPassword)).when("/register/:email?",t(i.register)).when("/confirmemail/:email/:confirmCode",t(i.confirmEmail)).when("/resetpassword/:email/:confirmCode",t(i.resetPassword)).when("/donate/:artist?",t(i.donate)).when("/donatesuccess",t(i.donateSuccess)).when("/donatecancelled",t(i.donateCancelled)).when("/admin",t(i.editSongs,n.RouteAccess.Admin)).when("/admin/albums",t(i.albums,n.RouteAccess.Admin)).when("/admin/album/upload",t(i.uploadAlbum,n.RouteAccess.Admin)).when("/admin/album/create",t(i.createAlbum,n.RouteAccess.Admin)).when("/admin/album/:artist/:album",t(i.editAlbum,n.RouteAccess.Admin)).when("/admin/artists/:artistName?",t(i.editArtist,n.RouteAccess.Admin)).when("/admin/songedits",t(i.songEdits,n.RouteAccess.Admin)).when("/admin/tags",t(i.tags,n.RouteAccess.Admin)).when("/admin/logs",t(i.logs,n.RouteAccess.Admin)).when("/admin/songs",t(i.editSongs,n.RouteAccess.Admin)).otherwise({redirectTo:"/nowplaying"})}]);n.App.run(["templatePaths","accountApi","appNav","adminScripts","navigatorMediaSession","uwpNativeAudio","iOSMediaSession","$rootScope","$location","$window","$q",function(t,i,r,u,f,e,o,s,h,c,l){c.Promise=l;o.install();f.install();e.install();s.Partials=t;$(".splash").remove();s.$on("$routeChangeSuccess",function(){var n=window.ga;n&&n("send","pageview",h.path())});s.$on("$routeChangeStart",function(t,f){var e=f.$$route,o,s;if(e&&e.access!==undefined){if(o=!i.isSignedIn&&e.access!==n.RouteAccess.Anonymous,s=e.access===n.RouteAccess.Admin&&i.currentUser&&!i.currentUser.isAdmin,o||s){r.signIn();return}e.access===n.RouteAccess.Admin&&u.install()}})}]);document.addEventListener("DOMContentLoaded",function(){return FastClick.attach(document.body)},!1)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var i=function(){function n(n,t,i){var r=this,u;this.element=t;u=n.$eval(i.backgroundImage);n.$watch(i.backgroundImage,function(n){return r.applyBackgroundImage(n)})}return n.prototype.applyBackgroundImage=function(n){if(n){var t='url("'+n+'")';this.element.css("background-image",t)}else this.element.css("background-image","none")},n}(),t=function(){function n(){this.restrict="A";this.priority=99;this.link=this.unboundLink.bind(this)}return n.prototype.unboundLink=function(n,t,r,u){new i(n,t,r,u)},n}();n.BackgroundImageBinder=t;n.App.directive("backgroundImage",function(){return new t})})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.scope=n;this.element=t;var u=r(i.enterHandler);t.on("keydown",function(t){t.keyCode===13&&(u(n),t.preventDefault&&t.preventDefault(),n.$applyAsync())});t.on("$destroy",function(){return t.off("keydown $destroy")})}return n}(),i=function(){function n(n){this.$parse=n;this.restrict="A";this.link=this.unboundLink.bind(this)}return n.prototype.unboundLink=function(n,i,r){new t(n,i,r,this.$parse)},n}();n.App.directive("enterHandler",["$parse",function(n){return new i(n)}])})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.scope=n;this.element=t;var u=r(i.fileUploadChanged);t.on("change",function(t){u(n,{e:t});n.$applyAsync()})}return n}(),i=function(){function n(n){this.parse=n;this.restrict="A";this.link=this.unboundLink.bind(this)}return n.prototype.unboundLink=function(n,i,r){new t(n,i,r,this.parse)},n}();n.App.directive("fileUploadChanged",["$parse",function(n){return new i(n)}])})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){n.App.directive("imageCropper",function(){return{restrict:"E",scope:{src:"=",ngModel:"=",base64:"="},link:function(n,t){function u(){if(n.src&&window.Croppie){var i=new Croppie(t[0],{viewport:{width:200,height:200,type:"circle"},boundary:{width:300,height:300}});i.bind({url:n.src});t.on("update.croppie",function(){i.result("blob").then(function(t){return n.$applyAsync(function(){return n.ngModel=t})});i.result("base64").then(function(t){return n.$applyAsync(function(){return n.base64=t})})})}}var f,e,r;if(n.$watch("src",function(n){n&&u()}),window.Croppie)u();else if(f="croppieScriptInitForImageCropper",e=$("#"+f).length>0,e)$(document).on("croppieLoaded",u);else{var i=document.createElement("script");i.async=!0;i.id=f;$("body").append(i);i.onload=function(){$(document).trigger("croppieLoaded");u()};i.src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.2/croppie.min.js";r=document.createElement("link");r.setAttribute("href","https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.2/croppie.min.css");r.setAttribute("rel","stylesheet");r.setAttribute("type","text/css");document.body.appendChild(r)}}}})})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){this.scope=n;this.element=t;var f=u(i.triggerFocus);n.$watch(f,function(n){n&&r(function(){return t[0].focus()})});t.bind("blur",function(){return n.$apply(f.assign(n,!1))})}return n}(),i=function(){function n(n,t){this.$timeout=n;this.$parse=t;this.restrict="A";this.link=this.unboundLink.bind(this)}return n.prototype.unboundLink=function(n,i,r){new t(n,i,r,this.$timeout,this.$parse)},n}();n.App.directive("triggerFocus",["$timeout","$parse",function(n,t){return new i(n,t)}])})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r,u){if(this.appNav=t,this.initConfig=i,this.httpApi=r,this.localStorageService=u,this.signedIn=new Rx.BehaviorSubject(!1),this.apiUri="/api/account",this.initConfig.user){this.currentUser=new n.User(this.initConfig.user);this.signedIn.onNext(!0)}}return Object.defineProperty(t.prototype,"isSignedIn",{get:function(){return!!this.currentUser},enumerable:!0,configurable:!0}),t.prototype.signOut=function(){var n=this,t=this.httpApi.post(this.apiUri+"/SignOut",null);return t.then(function(){n.currentUser=null;n.signedIn.onNext(!1)}),t},t.prototype.clearNotifications=function(){return this.httpApi.post(this.apiUri+"/clearNotifications",null)},t.prototype.register=function(n,t){var i={email:n,password:t};return this.httpApi.postUriEncoded(this.apiUri+"/register",i)},t.prototype.getUserWithEmail=function(n){var t={email:n};return this.httpApi.query(this.apiUri+"/getUserWithEmail",t)},t.prototype.createPassword=function(n,t){var i={email:n,password:t};return this.httpApi.postUriEncoded(this.apiUri+"/createPassword",i)},t.prototype.signIn=function(t,i,r){var u=this,e={email:t,password:i,staySignedIn:r},f=this.httpApi.postUriEncoded(this.apiUri+"/signIn",e);return f.then(function(t){if(t.status===n.SignInStatus.Success&&t.user){u.currentUser=new n.User(t.user);u.signedIn.onNext(!0);var i=window.ga;i&&i("set","userId",t.user.email)}else{u.currentUser=null;u.signedIn.onNext(!1)}}),f},t.prototype.confirmEmail=function(n,t){var i={email:n,confirmCode:t};return this.httpApi.postUriEncoded(this.apiUri+"/ConfirmEmail",i)},t.prototype.sendPasswordResetEmail=function(n){var t={email:n};return this.httpApi.postUriEncoded(this.apiUri+"/sendResetPasswordEmail",t)},t.prototype.resetPassword=function(n,t,i){var r={email:n,passwordResetCode:t,newPassword:i};return this.httpApi.postUriEncoded(this.apiUri+"/resetPassword",r)},t.prototype.sendSupportMessage=function(n,t,i){var r={name:n,email:t,message:i,date:(new Date).toISOString(),userAgent:window.navigator.userAgent};return this.httpApi.post(this.apiUri+"/sendSupportMessage",r)},t.$inject=["appNav","initConfig","httpApi","localStorageService",],t}();n.AccountService=t;n.App.service("accountApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.audioPlayer=n;this.initConfig=t;this.lastAnnouncementTime=new Date}return n.prototype.hasPendingAnnouncement=function(){return!1},n.prototype.playAdAnnouncement=function(){},n.$inject=["audioPlayer","initConfig",],n}();n.AdAnnouncerService=t;n.App.service("adAnnouncer",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(){this.hasInstalled=!1}return n.prototype.install=function(){if(!this.hasInstalled){this.hasInstalled=!0;["https://api.filepicker.io/v1/filepicker.js","https://cdnjs.cloudflare.com/ajax/libs/vibrant.js/1.0.0/Vibrant.min.js"].forEach(function(n){var t=document.createElement("script");t.type="text/javascript";t.src=n;document.body.appendChild(t)})}},n}();n.AdminScriptsService=t;n.App.service("adminScripts",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t){this.httpApi=n;this.$q=t}return t.prototype.upload=function(n){return this.httpApi.post("/api/albums/upload",n)},t.prototype.changeArt=function(n,i){var r={albumId:n,artUri:i};return this.httpApi.postUriEncoded("/api/albums/changeArt",r,t.albumSelector)},t.prototype.get=function(n){var i={id:n};return this.httpApi.query("/api/albums/get",i,t.albumSelector)},t.prototype.getAll=function(n,i,r){var u={skip:n,take:i,search:r};return this.httpApi.query("/api/albums/getAll",u,t.albumPagedListSelector)},t.prototype.getByArtistAndAlbumName=function(n,i){var r={artist:n,album:i};return this.httpApi.query("/api/albums/getByArtistAlbum",r,t.albumSelector)},t.prototype.save=function(t){return this.httpApi.post("/api/albums/save",t,function(t){return new n.Album(t)})},t.prototype.getAlbums=function(n){var i={albumIdsCsv:n.join(",")};return this.httpApi.query("/api/albums/getAlbums",i,t.albumArraySelector)},t.prototype.getLikedAlbums=function(n,t,i){var r={skip:n,take:t,search:i};return this.httpApi.query("/api/albums/getLikedAlbums",r)},t.prototype.deleteAlbum=function(n){var t={albumId:n};return this.httpApi.postUriEncoded("/api/albums/delete",t)},t.albumSelector=function(t){return t?new n.Album(t):null},t.albumArraySelector=function(n){return n.map(function(n){return t.albumSelector(n)})},t.albumPagedListSelector=function(n){return{items:t.albumArraySelector(n.items),skip:n.skip,take:n.take,total:n.total}},t.$inject=["httpApi","$q",],t}();n.AlbumApiService=t;n.App.service("albumApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t){this.albumApi=n;this.$q=t;this.cache=[]}return t.prototype.getAlbumsForSongs=function(n){var e=this,i,o,f;t.hasAttemptedRehydratedCache||(i=t.tryRehydrateCache(),i&&(this.cache=i));var r=[],u=[],s=_.uniq(n.filter(function(n){return!!n.albumId}).map(function(n){return n.albumId}));return(s.forEach(function(n){var t=e.getCachedAlbum(n);t?u.push(t):r.push(n)}),o=r.length===0,o)?this.$q.resolve(u):(f=this.$q.defer(),this.albumApi.getAlbums(_.uniq(r)).then(function(n){e.addToCache(n);f.resolve(u.concat(n))}),f.promise)},t.prototype.getCachedAlbum=function(n){var t=n.toLowerCase();return this.cache.find(function(n){return n.id.toLowerCase()===t})},t.prototype.addToCache=function(n){var r=this,i,u=n.filter(function(n){return!r.cache.some(function(t){return t.id===n.id})});(i=this.cache).push.apply(i,u);t.tryStoreCacheInLocalStorage(this.cache)},t.tryStoreCacheInLocalStorage=function(n){try{var i=JSON.stringify(n);localStorage.setItem(t.cacheKey,i)}catch(r){console.log("Unable to save album cache to local storage.")}},t.tryRehydrateCache=function(){var i,r;t.hasAttemptedRehydratedCache=!0;try{if(i=localStorage.getItem(t.cacheKey),i&&(r=JSON.parse(i),r))return r.map(function(t){return new n.Album(t)})}catch(u){console.log("Unable to rehydrate album art cache.",u)}return null},t.$inject=["albumApi","$q",],t.cacheKey="album-art-cache",t.hasAttemptedRehydratedCache=!1,t}();n.AlbumCacheService=t;n.App.service("albumCache",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.templatePaths=n;this.$location=t;this.$uibModal=i;this.initConfig=r;this.promptSignInUrl="#/promptsignin"}return n.prototype.signIn=function(){this.$location.url("/signin")},n.prototype.signOut=function(){this.$location.url("/nowplaying");window.location.reload()},n.prototype.nowPlaying=function(){this.$location.url("/nowplaying")},n.prototype.promptSignIn=function(){this.$location.url(this.promptSignInUrl.replace("#",""))},n.prototype.register=function(n){n?this.$location.url("/register/"+encodeURIComponent(n)):this.$location.url("/register")},n.prototype.createPassword=function(n){this.$location.url("/createpassword/"+encodeURIComponent(n))},n.prototype.password=function(n){this.$location.url("/password/"+encodeURIComponent(n))},n.prototype.editAlbumById=function(n){this.$location.url("/admin/album/"+n)},n.prototype.editAlbum=function(n,t){var i=encodeURIComponent(n),r=encodeURIComponent(t);this.$location.url("/admin/album/"+i+"/"+r)},n.prototype.getEditSongUrl=function(n){return"/edit/"+n},n.prototype.songRequestModal=function(){return this.$uibModal.open({controller:"RequestSongController as vm",templateUrl:this.templatePaths.songRequestModal,windowClass:"request-song-modal"})},n.prototype.cropImageModal=function(n){return this.$uibModal.open({controller:"CropImageController as vm",templateUrl:this.templatePaths.cropImageModal,windowClass:"crop-image-modal",resolve:{imageFile:function(){return n}}})},n.prototype.confirmDeleteSong=function(n){return this.$uibModal.open({controller:"ConfirmDeleteSongController as vm",templateUrl:this.templatePaths.confirmDeleteSongModal,windowClass:"confirm-delete-song-modal",resolve:{song:function(){return n}}})},n.prototype.createAlbum=function(){this.$location.url("/admin/album/create")},n.prototype.getQueryParams=function(){return this.$location.search()},n.$inject=["templatePaths","$location","$uibModal","initConfig",],n}();n.AppNavService=t;n.App.service("appNav",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.httpApi=n}return t.prototype.getAll=function(n,t,i){n===void 0&&(n="");t===void 0&&(t=0);i===void 0&&(i=1024);var r={search:n,skip:t,take:i};return this.httpApi.query("/api/artists/getAll",r)},t.prototype.getByName=function(n){var i={artistName:n};return this.httpApi.query("/api/artists/getByName",i,t.artistSelector)},t.prototype.save=function(n){return this.httpApi.post("/api/artists/save",n,t.artistSelector)},t.prototype.getLikedArtists=function(n,t,i){var r={skip:n,take:t,search:i};return this.httpApi.query("/api/artists/getLikedArtists",r)},t.artistSelector=function(t){return new n.Artist(t)},t.$inject=["httpApi"],t}();n.ArtistApiService=t;n.App.service("artistApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i){var r=this;this.songApi=t;this.initConfig=i;this.status=new Rx.BehaviorSubject(n.AudioStatus.Paused);this.song=new Rx.BehaviorSubject(null);this.songCompleted=new Rx.BehaviorSubject(null);this.playedTime=new Rx.BehaviorSubject(0);this.playedTimeText=new Rx.BehaviorSubject("");this.remainingTimeText=new Rx.BehaviorSubject("");this.playedTimePercentage=new Rx.BehaviorSubject(0);this.duration=new Rx.BehaviorSubject(0);this.playedSongs=[];this.audioErrors=new Rx.Subject;this.lastPlayedTime=0;this.song.subscribe(function(n){return r.updateDocumentTitle(n)})}return t.prototype.initialize=function(t){var i=this,r=Modernizr.audio.mp3;r&&(this.audio=t,this.audio.addEventListener("ended",function(){return i.ended()}),this.audio.addEventListener("error",function(n){return i.erred(n)}),this.audio.addEventListener("pause",function(){return i.status.onNext(n.AudioStatus.Paused)}),this.audio.addEventListener("play",function(){return i.status.onNext(n.AudioStatus.Playing)}),this.audio.addEventListener("playing",function(){return i.status.onNext(n.AudioStatus.Playing)}),this.audio.addEventListener("waiting",function(){return i.status.onNext(n.AudioStatus.Buffering)}),this.audio.addEventListener("stalled",function(n){return i.stalled(n)}),this.audio.addEventListener("timeupdate",function(n){return i.playbackPositionChanged(n)}))},t.prototype.playNewSong=function(n){var t=this.song.getValue();t&&(this.playedSongs.unshift(t),this.playedSongs.length>3&&(this.playedSongs.length=3));this.song.onNext(n);this.playNewUri(n.uri)},t.prototype.playNewUri=function(n){if(this.audio&&(this.audio.src="",n)){this.audio.src=n;this.audio.load();try{this.audio.play()}catch(t){console.log("Unable to play audio",t)}}},t.prototype.playSongById=function(n){var t=this.songApi.getSongById(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongFromArtistAndAlbum=function(n,t){var i=this.songApi.getSongByArtistAndAlbum(n,t);this.playSongWhenFinishedLoading(i)},t.prototype.playSongFromArtist=function(n){var t=this.songApi.getSongByArtist(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongFromAlbum=function(n){var t=this.songApi.getSongByAlbum(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongFromAlbumId=function(n){var t=this.songApi.getSongByAlbumId(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongWithTag=function(n){var t=this.songApi.getSongWithTag(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongWhenFinishedLoading=function(n){var t=this,i=this.song.getValue();this.pause();n.then(function(n){var r=t.song.getValue()===i;r&&(n?t.playNewSong(n):t.resume())})},t.prototype.pauseSongById=function(n){var t=this;this.pause();this.songApi.getSongById(n).then(function(n){if(!n){t.resume();return}var i=t.song.getValue();i&&t.playedSongs.unshift(i);t.song.onNext(n);t.audio&&(t.audio.src=n.uri,t.audio.load(),t.audio.pause())})},t.prototype.resume=function(){this.audio&&this.audio.play()},t.prototype.pause=function(){this.audio&&this.audio.pause()},t.prototype.setVolume=function(){this.audio&&(this.audio.volume=0)},t.prototype.skipToEnd=function(){this.audio&&this.audio.duration&&(this.audio.currentTime=this.audio.duration-1)},t.prototype.aborted=function(t){this.status.onNext(n.AudioStatus.Aborted);console.log("Audio aborted",this.audio.currentSrc,t)},t.prototype.erred=function(t){this.status.onNext(n.AudioStatus.Erred);console.log("Audio erred. Error code: ",this.audio.error,"Audio source: ",this.audio.currentSrc,"Error event: ",t);var i=this.song.getValue();this.audioErrors.onNext({errorCode:this.audio.error,songId:i?i.id:"",trackPosition:this.audio.currentTime})},t.prototype.ended=function(){var t=this.song.getValue();if(this.audio&&t&&this.audio.src===encodeURI(t.uri))this.songCompleted.onNext(t);this.status.onNext(n.AudioStatus.Ended)},t.prototype.stalled=function(t){this.status.onNext(n.AudioStatus.Stalled);console.log("Audio stalled, unable to stream in audio data.",this.audio.currentSrc,t)},t.prototype.playbackPositionChanged=function(){var i=this.audio.currentTime,n=Math.floor(i),r=n!==this.lastPlayedTime,t;if(r){this.lastPlayedTime=n;t=this.audio.duration;this.duration.onNext(t);this.playedTime.onNext(n);var u=(new Date).setMinutes(0,n),f=moment(u),e=(new Date).setMinutes(0,t-n),o=moment(e);this.playedTimeText.onNext(f.format("m:ss"));this.remainingTimeText.onNext(o.format("m:ss"));this.playedTimePercentage.onNext(100/t*n)}},t.prototype.submitAudioError=function(n){this.songApi.songFailed(n)},t.prototype.updateDocumentTitle=function(n){document.title=n?n.name+" by "+n.artist+" on "+this.initConfig.title:this.initConfig.title},t.$inject=["songApi","initConfig"],t}();n.AudioPlayerService=t;n.App.service("audioPlayer",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){this.loadingProgress=n;this.appNav=t;this.localStorageService=i;this.$http=r;this.$q=u;this.apiBaseUrl=""}return n.prototype.query=function(n,t,i,r){var e=this,u,f;return t===void 0&&(t=null),r===void 0&&(r=!0),u=r?this.loadingProgress.start():this.$q.defer(),f={url:this.apiBaseUrl+n,method:"GET",params:t,headers:this.createHeaders()},this.$http(f).then(function(n){var t=i?i(n.data):n.data;u.resolve(t)},function(t){u.reject(t);e.onAjaxError(t,"Error loading "+n+".")}),u.promise},n.prototype.post=function(n,t,i,r){var e=this,u;r===void 0&&(r=!0);u=r?this.loadingProgress.start():this.$q.defer();var o=""+this.apiBaseUrl+n,s={headers:this.createHeaders()},f=this.$http.post(o,t,s);return f.then(function(n){var t=i?i(n.data):n.data;u.resolve(t)}),f.catch(function(t){e.onAjaxError(t,"Error saving "+n+".");u.reject(t)}),u.promise},n.prototype.postUriEncoded=function(n,t,i,r){var l=this,f,u,s,e,h,o;r===void 0&&(r=!0);f=r?this.loadingProgress.start():this.$q.defer();u=""+this.apiBaseUrl+n+"?";s={headers:this.createHeaders()};for(e in t){h=u.endsWith("?");u+=h?"":"&";var c=t[e],a=c?c.toString():"",v=encodeURIComponent(a);u+=e+"="+v}return o=this.$http.post(u,null,s),o.then(function(n){var t=i?i(n.data):n.data;f.resolve(t)}),o.catch(function(t){l.onAjaxError(t,"Error saving "+n+".");f.reject(t)}),f.promise},n.prototype.postFormData=function(n,t,i){var f=this,r=this.loadingProgress.start(),e=n.indexOf("?")!==-1?"&":"?",o=""+this.apiBaseUrl+n+e,s={method:"POST",url:o,data:t,headers:{"Content-Type":undefined}},u=this.$http(s);return u.then(function(n){var t=i?i(n.data):n.data;r.resolve(t)}),u.catch(function(t){f.onAjaxError(t,"Error saving "+n+".");r.reject(t)}),r.promise},n.prototype.createHeaders=function(){return{}},n.prototype.onAjaxError=function(n){n&&n.status===401&&this.appNav.signIn()},n.$inject=["loadingProgress","appNav","localStorageService","$http","$q",],n}();n.HttpApiService=t;n.App.service("httpApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.audioPlayer=n;this.nowPlayingInfo=null}return n.prototype.install=function(){var n=this;document.addEventListener("deviceready",function(){return n.cordovaLoaded()},!1)},n.prototype.cordovaLoaded=function(){try{this.nowPlaying=window.NowPlaying;this.nowPlaying&&this.listenForAudioEvents();this.remoteCommand=window.RemoteCommand;this.remoteCommand&&(this.setInitialNativeUIState(),this.listenForNativeUIEvents())}catch(n){console.log("Error installing iOS Cordova hooks for media session",n)}},n.prototype.listenForAudioEvents=function(){var n=this;this.nowPlaying&&(this.audioPlayer.song.distinctUntilChanged().subscribe(function(t){return n.songChanged(t)}),this.audioPlayer.status.distinctUntilChanged().subscribe(function(t){return n.songStatusChanged(t)}),this.audioPlayer.playedTime.distinctUntilChanged().subscribe(function(t){return n.songCurrentTimeChanged(t)}),this.audioPlayer.duration.distinctUntilChanged().subscribe(function(t){return n.songDurationChanged(t)}))},n.prototype.setInitialNativeUIState=function(){this.remoteCommand&&(this.remoteCommand.enabled("play",!0),this.remoteCommand.enabled("pause",!0),this.remoteCommand.enabled("nextTrack",!0),this.remoteCommand.enabled("previousTrack",!1))},n.prototype.listenForNativeUIEvents=function(){var n=this;if(this.remoteCommand){this.remoteCommand.on("play",function(){return n.audioPlayer.resume()});this.remoteCommand.on("pause",function(){return n.audioPlayer.pause()});this.remoteCommand.on("nextTrack",function(){return n.audioPlayer.skipToEnd()})}},n.prototype.songChanged=function(n){if(this.nowPlaying){var t={};n&&(t.albumTitle=n.album,t.artist=n.artist,t.title=n.hebrewName?n.name+" "+n.hebrewName:n.name,t.trackNumber=n.number,t.artwork="https://messianicradio.com/api/albums/getAlbumArtBySongId?songId="+n.id);this.nowPlayingInfo=t;this.nowPlaying.set(t)}},n.prototype.songCurrentTimeChanged=function(n){this.nowPlaying&&this.nowPlayingInfo&&(this.nowPlayingInfo.elapsedPlaybackTime=n,this.nowPlaying.set(this.nowPlayingInfo))},n.prototype.songDurationChanged=function(n){this.nowPlaying&&this.nowPlayingInfo&&(this.nowPlayingInfo.playbackDuration=n,this.nowPlaying.set(this.nowPlayingInfo))},n.prototype.songStatusChanged=function(){this.nowPlaying&&this.nowPlayingInfo&&this.nowPlaying.set(this.nowPlayingInfo)},n.$inject=["audioPlayer"],n}();n.IOSMediaSessionService=t;n.App.service("iOSMediaSession",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.dislikeSong=function(n){return this.httpApi.postUriEncoded("/api/likes/dislike",{songId:n})},n.prototype.likeSong=function(n){return this.httpApi.postUriEncoded("/api/likes/like",{songId:n})},n.$inject=["httpApi"],n}();n.LikeApiService=t;n.App.service("likeApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.$q=n;this.resultsInProgress=0}return n.prototype.start=function(){var t=this,n=this.$q.defer();return this.loadingStarted(),n.promise.finally(function(){return t.loadingEnded()}),n},Object.defineProperty(n.prototype,"isLoading",{get:function(){return this.resultsInProgress>0},enumerable:!0,configurable:!0}),n.prototype.loadingStarted=function(){this.resultsInProgress++;this.resultsInProgress===1&&NProgress.start()},n.prototype.loadingEnded=function(){this.resultsInProgress--;this.resultsInProgress===0&&NProgress.done()},n.$inject=["$q"],n}();n.LoadingProgressService=t;n.App.service("loadingProgress",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.httpApi=n}return t.prototype.getAll=function(n,i,r,u){var f={skip:n,take:i,level:r,sort:u};return this.httpApi.query("/api/logs/getAll",f,t.pagedListSelector)},t.prototype.deleteLog=function(n){var t={id:n};return this.httpApi.postUriEncoded("/api/logs/delete",t)},t.pagedListSelector=function(t){return{skip:t.skip,take:t.take,total:t.total,items:t.items.map(function(t){return new n.StructuredLog(t)})}},t.$inject=["httpApi"],t}();n.LogService=t;n.App.service("logApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.audioPlayer=n}return t.prototype.install=function(){try{var n="mediaSession"in navigator;n&&(this.mediaSession=navigator.mediaSession,this.listenForUIEvents(),this.listenForAudioEvents())}catch(t){console.log("Unable to install navigator media session",t)}},t.prototype.listenForUIEvents=function(){var n=this;this.mediaSession&&(this.mediaSession.setActionHandler("play",function(){return n.audioPlayer.resume()}),this.mediaSession.setActionHandler("pause",function(){return n.audioPlayer.pause()}),this.mediaSession.setActionHandler("nexttrack",function(){return n.audioPlayer.skipToEnd()}))},t.prototype.listenForAudioEvents=function(){var n=this;this.mediaSession&&(this.audioPlayer.song.distinctUntilChanged().subscribe(function(t){return n.songChanged(t)}),this.audioPlayer.status.distinctUntilChanged().subscribe(function(t){return n.audioStatusChanged(t)}))},t.prototype.audioStatusChanged=function(t){if(this.mediaSession)try{switch(t){case n.AudioStatus.Paused:this.mediaSession.playbackState="paused";break;case n.AudioStatus.Playing:this.mediaSession.playbackState="playing";break;default:this.mediaSession.playbackState="none"}}catch(i){console.log("Unable to set media session playback state",i)}},t.prototype.songChanged=function(n){if(this.mediaSession){var t={title:"",artist:"",album:"",artwork:[]};n&&(t.album=n.album,t.artist=n.artist,t.title=n.hebrewName?n.name+" "+n.hebrewName:n.name,t.artwork.push({src:n.albumArtUri,sizes:"any",type:"image/jpeg"}));try{this.mediaSession.metadata=new window.MediaMetadata(t)}catch(i){console.log("unable to set mediaSession metadata",i)}}},t.$inject=["audioPlayer"],t}();n.NavigatorMediaSessionService=t;n.App.service("navigatorMediaSession",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.initConfig=n}return n.prototype.shareUrl=function(n){return this.initConfig.defaultUrl+"/?song="+n},n.prototype.getEmbedCode=function(n){return'<iframe style="border-top: medium none; height: 558px; border-right: medium none; width: 350px; border-bottom: medium none; border-left: medium none" src="'+this.initConfig.defaultUrl+"/home/embed?song="+n+'" scrolling="none"><\/iframe>'},n.prototype.facebookShareUrl=function(n){var t=this.getSongName(n),i=(t+" by "+n.artist).replace(new RegExp("&","g"),"and"),r=this.initConfig.defaultUrl+"/?song="+n.id,u=this.initConfig.defaultUrl+"/api/albums/getAlbumArtBySongId?songId="+n.id;return"https://www.facebook.com/dialog/feed?app_id=256833604430846&link="+r+("&picture="+encodeURIComponent(u))+("&name="+encodeURIComponent(i))+("&description="+encodeURIComponent("On "+n.album))+("&caption="+encodeURIComponent("Courtesy of Chavah Messianic Radio - The very best Messianic Jewish and Hebrew Roots music"))+("&redirect_uri="+encodeURIComponent(this.initConfig.defaultUrl+"/#/sharethanks"))},n.prototype.twitterShareUrl=function(n){var t=this.getSongName(n),i="Listening to "+t+" by "+n.artist,r=this.initConfig.defaultUrl+"/?song="+n.id;return"https://twitter.com/share?text="+encodeURIComponent(i)+"&url="+encodeURIComponent(r)+"&via="+encodeURIComponent("messianicradio")},n.prototype.googlePlusShareUrl=function(n){return"https://plus.google.com/share?url="+encodeURI(this.initConfig.debug+"/?song="+n)},n.prototype.nativeShareUrl=function(n){var t=navigator.share,i;if(t){i=this.getSongName(n);try{t({title:i+" by "+n.artist,text:"via Chavah Messianic Radio",url:this.initConfig.defaultUrl+"/?song="+n.id})}catch(r){console.log("Unable to trigger navigator.share",r)}}},n.prototype.getSongName=function(n){return[n.hebrewName,n.name].filter(function(n){return!!n}).join(" ")},n.$inject=["initConfig"],n}();n.SharingService=t;n.App.service("sharing",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.httpApi=n}return t.prototype.chooseSong=function(){return this.httpApi.query("/api/songs/chooseSong",null,t.songConverter)},t.prototype.chooseSongBatch=function(){return this.httpApi.query("/api/songs/chooseSongBatch",null,t.songListConverter)},t.prototype.getSongById=function(n,i){var r=this.httpApi.query("/api/songs/getById",{songId:n},t.songOrNullConverter);return i!=null&&r.then(function(n){n&&n.setSolePickReason(i)}),r},t.prototype.getSongByArtistAndAlbum=function(n,i){var r={artist:n,album:i};return this.httpApi.query("/api/songs/getByArtistAndAlbum",r,t.songOrNullConverter)},t.prototype.getSongByAlbum=function(n){var i={album:n};return this.httpApi.query("/api/songs/getByAlbum/",i,t.songOrNullConverter)},t.prototype.getSongByAlbumId=function(n){var i={albumId:n};return this.httpApi.query("/api/songs/getByAlbumId/",i,t.songOrNullConverter)},t.prototype.getSongWithTag=function(n){var i={tag:n};return this.httpApi.query("/api/songs/getByTag",i,t.songOrNullConverter)},t.prototype.getSongByArtist=function(n){var i={artist:n};return this.httpApi.query("/api/songs/getByArtist",i,t.songOrNullConverter)},t.prototype.getSongMatches=function(n){var i={searchText:n};return this.httpApi.query("/api/songs/search",i,t.songListConverter)},t.prototype.getTrendingSongs=function(n,i){var r={skip:n,take:i};return this.httpApi.query("/api/songs/getTrending",r,t.songPagedListConverter)},t.prototype.getPopularSongs=function(n){var i={count:n};return this.httpApi.query("/api/songs/getpopular",i,t.songListConverter)},t.prototype.getRandomLikedSongs=function(n){var i={count:n};return this.httpApi.query("/api/songs/getRandomLikedSongs",i,t.songListConverter)},t.prototype.getLikes=function(n,i,r){var u={skip:n,take:i,search:r};return this.httpApi.query("/api/songs/getLikedSongs",u,t.songPagedListConverter)},t.prototype.getRecentPlays=function(n){var i={count:n};return this.httpApi.query("/api/songs/getRecentPlays",i,t.songListConverter)},t.prototype.songCompleted=function(n){var t={songId:n};return this.httpApi.postUriEncoded("/api/songs/songCompleted",t)},t.prototype.songFailed=function(n){return this.httpApi.post("/api/songs/audiofailed",n)},t.prototype.getSongsAdmin=function(n,t,i){var r={skip:n,take:t,search:i};return this.httpApi.query("/api/songs/getSongsAdmin",r)},t.prototype.deleteSong=function(n){return this.httpApi.post("/api/songs/deleteSong",n)},t.songPagedListConverter=function(t){return{items:t.items.map(function(t){return new n.Song(t)}),skip:t.skip,take:t.take,total:t.total}},t.songListConverter=function(n){return n.map(function(n){return t.songConverter(n)})},t.songOrNullConverter=function(n){return n?t.songConverter(n):null},t.songConverter=function(t){return new n.Song(t)},t.$inject=["httpApi"],t}();n.SongApiService=t;n.App.service("songApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){var u=this;this.audioPlayer=n;this.songApi=t;this.songRequestApi=i;this.accountApi=r;this.songsBatch=new Rx.BehaviorSubject([]);r.signedIn.distinctUntilChanged().subscribe(function(n){return u.signedInChanged(n)})}return n.prototype.playNext=function(){var n=this,t,i;if(this.songsBatch.getValue().length>0){t=this.songsBatch.getValue().splice(0,1)[0];this.songsBatch.onNext(this.songsBatch.getValue());this.audioPlayer.playNewSong(t)}else this.songApi.chooseSong().then(function(t){n.audioPlayer.playNewSong(t);n.fetchSongBatch()});i=this.songsBatch.getValue().length<5;i&&this.fetchSongBatch()},n.prototype.fetchSongBatch=function(){var n=this;this.songApi.chooseSongBatch().then(function(t){var i=n.songsBatch.getValue(),r=t.filter(function(n){return i.map(function(n){return n.id}).indexOf(n.id)===-1}).filter(function(t){return!n.songRequestApi.isSongPendingRequest(t.id)});n.songsBatch.onNext(i.concat(r))})},n.prototype.signedInChanged=function(n){var t=this.songsBatch.getValue().length>0;if(n&&t){this.songsBatch.onNext([]);this.fetchSongBatch()}},n.$inject=["audioPlayer","songApi","songRequestApi","accountApi",],n}();n.SongBatchService=t;n.App.service("songBatch",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.getSongEdit=function(n){var t={songId:n};return this.httpApi.query("/api/songEdits/get",t)},n.prototype.submit=function(n){return this.httpApi.post("/api/songEdits/editSong",n)},n.prototype.getPendingEdits=function(n){var t={take:n};return this.httpApi.query("/api/songEdits/getPendingEdits",t)},n.prototype.approve=function(n){return this.httpApi.post("/api/songEdits/approve",n)},n.prototype.reject=function(n){var t={songEditId:n};return this.httpApi.postUriEncoded("/api/songEdits/reject",t)},n.$inject=["httpApi",],n}();n.SongEditService=t;n.App.service("songEditApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r){this.httpApi=n;this.audioPlayer=t;this.songApi=i;this.initConfig=r;this.pendingSongRequestIds=[];this.hasPlayedRequestAnnouncement=!1}return t.prototype.hasPendingRequest=function(){var n=this,t=this.pendingSongRequestIds.length>0;return this.pendingSongRequestIds.length===0&&setTimeout(function(){return n.fetchPendingSongRequests()},2e3),t},t.prototype.isSongPendingRequest=function(n){return this.pendingSongRequestIds.indexOf(n)!==-1},t.prototype.requestSong=function(n){this.pendingSongRequestIds.unshift(n.id);this.hasPlayedRequestAnnouncement=!1;var t={songId:n.id};return this.httpApi.postUriEncoded("/api/songRequests/requestsong",t)},t.prototype.playRequest=function(){var t=this,r,u;if(!this.hasPendingRequest())throw new Error("There was no pending song request.");if(this.hasPlayedRequestAnnouncement)this.hasPlayedRequestAnnouncement=!1,r=this.pendingSongRequestIds.splice(0,1)[0],u=this.audioPlayer.song.getValue(),this.songApi.getSongById(r,n.SongPick.SomeoneRequestedSong).then(function(n){var i=t.audioPlayer.song.getValue()===u;i&&n&&t.audioPlayer.playNewSong(n)});else{this.hasPlayedRequestAnnouncement=!0;var i=[1,3,4,5,6,7,8,9,10],f="SongRequest"+i[Math.floor(Math.random()*i.length)]+".mp3",e=this.initConfig.soundEffects+"/"+f;this.audioPlayer.playNewUri(e)}},t.prototype.removePendingSongRequest=function(n){this.pendingSongRequestIds=this.pendingSongRequestIds.filter(function(t){return t!==n})},t.prototype.fetchPendingSongRequests=function(){var n=this;return this.httpApi.query("/api/songRequests/getPending").then(function(t){t&&n.pendingSongRequestIds.indexOf(t)===-1&&n.pendingSongRequestIds.push(t)})},t.$inject=["httpApi","audioPlayer","songApi","initConfig",],t}();n.SongRequestApiService=t;n.App.service("songRequestApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.audioPlayer=n;this.initConfig=t;this.lastAnnouncementTime=new Date}return n.prototype.hasPendingAnnouncement=function(){var t=new Date,n=t.getMinutes(),i=n>55||n<5||n>25&&n<35,r=(t.valueOf()-this.lastAnnouncementTime.valueOf())/6e4,u=r>=15;return u&&i?(this.lastAnnouncementTime=t,!0):!1},n.prototype.playStationIdAnnouncement=function(){var n=[1,2,3,4,5,6,7],t="StationId"+n[Math.floor(Math.random()*n.length)]+".mp3",i=this.initConfig.soundEffects+"/"+t;this.audioPlayer.playNewUri(i)},n.$inject=["audioPlayer","initConfig",],n}();n.StationIdentifierService=t;n.App.service("stationIdentifier",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.getAll=function(){return this.httpApi.query("/api/tags/getAll")},n.prototype.renameTag=function(n,t){var i={oldTag:n,newTag:t};return this.httpApi.postUriEncoded("/api/tags/rename",i)},n.prototype.deleteTag=function(n){var t={tag:n};return this.httpApi.postUriEncoded("/api/tags/delete",t)},n.prototype.searchTags=function(n){var t={search:n};return this.httpApi.query("/api/tags/searchTags",t)},n.$inject=["httpApi"],n}();n.TagService=t;n.App.service("tagApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.updateProfile=function(n){return this.httpApi.post("/api/users/updateProfile",n)},n.prototype.updateProfilePic=function(n){var t=new FormData;return t.append("file",n),this.httpApi.postFormData("/api/users/uploadProfilePicture",t)},n.prototype.saveVolume=function(n){var t={volume:n};return this.httpApi.postUriEncoded("/api/users/saveVolume",t)},n.$inject=["httpApi"],n}();n.UserApiService=t;n.App.service("userApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.audioPlayer=n;this.systemMedia=null}return t.prototype.install=function(){try{var n=typeof Windows!="undefined";n&&(this.systemMedia=this.tryGetSmtc(),this.systemMedia&&(this.setInitialSmtcState(),this.listenForAudioEvents()))}catch(t){console.log("Unable to install Windows native audio hooks",t)}},t.prototype.setInitialSmtcState=function(){this.systemMedia&&(this.systemMedia.isNextEnabled=!0,this.systemMedia.isPreviousEnabled=!1,this.systemMedia.isFastForwardEnabled=!1,this.systemMedia.isRewindEnabled=!1,this.systemMedia.isStopEnabled=!0,this.systemMedia.isPlayEnabled=!0,this.systemMedia.isPauseEnabled=!0,this.systemMedia.playbackStatus=Windows.Media.MediaPlaybackStatus.changing,this.systemMedia.isEnabled=!0)},t.prototype.tryGetSmtc=function(){try{return Windows.Media.SystemMediaTransportControls.getForCurrentView()}catch(n){return console.log("Unable to get SMTC",n),null}},t.prototype.listenForAudioEvents=function(){var n=this;this.audioPlayer.status.distinctUntilChanged().subscribe(function(t){return n.audioStatusChanged(t)});this.audioPlayer.song.distinctUntilChanged().subscribe(function(t){return n.songChanged(t)});this.systemMedia&&(this.systemMedia.addEventListener("buttonpressed",function(t){return n.windowsMediaButtonPressed(t)}),this.systemMedia.addEventListener("propertychanged",function(t){return n.windowsMediaPropertyChanged(t)}))},t.prototype.windowsMediaButtonPressed=function(n){var t=Windows.Media.SystemMediaTransportControlsButton;switch(n.button){case t.play:this.audioPlayer.resume();break;case t.pause:this.audioPlayer.pause();break;case t.next:this.audioPlayer.skipToEnd()}},t.prototype.windowsMediaPropertyChanged=function(){},t.prototype.audioStatusChanged=function(t){if(this.systemMedia)switch(t){case n.AudioStatus.Playing:this.systemMedia.playbackStatus=Windows.Media.MediaPlaybackStatus.playing;break;case n.AudioStatus.Paused:this.systemMedia.playbackStatus=Windows.Media.MediaPlaybackStatus.paused;break;case n.AudioStatus.Buffering:case n.AudioStatus.Stalled:this.systemMedia.playbackStatus=Windows.Media.MediaPlaybackStatus.paused;break;case n.AudioStatus.Ended:this.systemMedia.playbackStatus=Windows.Media.MediaPlaybackStatus.changing}},t.prototype.songChanged=function(n){var t,i;if(this.systemMedia){if(!n){this.systemMedia.displayUpdater.clearAll();return}this.systemMedia.displayUpdater.type=Windows.Media.MediaPlaybackType.music;t=this.systemMedia.displayUpdater.musicProperties;t.artist=n.artist;t.albumTitle=n.album;t.trackNumber=n.number;t.title=n.hebrewName?n.name+" "+n.hebrewName:n.name;n.albumArtUri&&(i=new Windows.Foundation.Uri(n.albumArtUri),this.systemMedia.displayUpdater.thumbnail=Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(i));this.systemMedia.displayUpdater.update()}},t.$inject=["audioPlayer"],t}();n.UwpNativeAudioService=t;n.App.service("uwpNativeAudio",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i){var r=this;this.albumApi=t;this.appNav=i;this.search="";this.albums=new n.PagedList(function(n,t){return r.albumApi.getAll(n,t,r.search)});this.isSaving=!1;this.albums.take=50;this.albums.fetchNextChunk()}return t.prototype.searchChanged=function(){this.albums.resetAndFetch()},t.prototype.deleteAlbum=function(n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:this.isSaving=!0;t.label=1;case 1:return t.trys.push([1,,3,4]),[4,this.albumApi.deleteAlbum(n.id)];case 2:return t.sent(),_.pull(this.albums.items,n),[3,4];case 3:return this.isSaving=!1,[7];case 4:return[2]}})})},t.$inject=["albumApi","appNav",],t}();n.AlbumsController=t;n.App.controller("AlbumsController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.songApi=n;this.songEditApi=t;this.tagApi=i;this.pendingEdits=[];this.currentEdit=null;this.isSaving=!1;this.hasLoaded=!1;this.tagsInput="";this.songEditApi.getPendingEdits(20).then(function(n){return r.pendingEditsLoaded(n)})}return n.prototype.pendingEditsLoaded=function(n){this.pendingEdits=n;this.setCurrentEdit(n[0]);this.hasLoaded=!0},n.prototype.setCurrentEdit=function(n){this.currentEdit=n},n.prototype.approve=function(){var n=this,t=this.currentEdit;!this.isSaving&&t&&(this.isSaving=!0,this.songEditApi.approve(t).then(function(t){return n.removeSongEdit(t.id)}).finally(function(){return n.isSaving=!1}))},n.prototype.reject=function(){var n=this,t=this.currentEdit;!this.isSaving&&t&&(this.isSaving=!0,this.songEditApi.reject(t.id).then(function(t){t&&n.removeSongEdit(t.id)}).finally(function(){return n.isSaving=!1}))},n.prototype.removeSongEdit=function(n){this.pendingEdits=this.pendingEdits.filter(function(t){return t.id!==n});this.currentEdit&&this.currentEdit.id===n&&this.setCurrentEdit(this.pendingEdits[0])},n.prototype.removeTag=function(n){if(this.currentEdit){var t=this.currentEdit.newTags.indexOf(n);t>=0&&this.currentEdit.newTags.splice(t,1)}},n.prototype.autoCompleteTagSelected=function(n){this.addTag(n);this.tagsInput=""},n.prototype.addTag=function(n){if(this.currentEdit){var t=n.toLowerCase().trim();!this.currentEdit.newTags.includes(t)&&t.length>1&&this.currentEdit.newTags.push(t)}},n.prototype.tagsInputChanged=function(){var t=this,n;this.tagsInput.includes(",")&&(n=this.tagsInput.split(","),this.tagsInput="",n.filter(function(n){return n&&n.length>1}).forEach(function(n){return t.addTag(n)}))},n.prototype.tagsEnterKeyPressed=function(){this.tagsInput.length>1&&this.autoCompleteTagSelected(this.tagsInput)},n.prototype.searchTags=function(n){return this.tagApi.searchTags(n)},n.$inject=["songApi","songEditApi","tagApi",],n}();n.ApproveSongEditsController=t;n.App.controller("ApproveSongEditsController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){this.song=n;this.songApi=t;this.$uibModalInstance=i;this.saving=!1}return n.prototype.close=function(){this.$uibModalInstance.close(!1)},n.prototype.deleteSong=function(){var n=this;this.saving||(this.saving=!0,this.songApi.deleteSong(this.song).then(function(){return n.$uibModalInstance.close(!0)}).finally(function(){return n.saving=!1}))},n.$inject=["song","songApi","$uibModalInstance"],n}();n.ConfirmDeleteSongController=t;n.App.controller("ConfirmDeleteSongController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){var r=this,i;this.accountApi=n;this.email="";this.confirmCode="";this.isConfirming=!0;this.confirmSucceeded=!1;this.confirmFailed=!1;this.confirmFailedErrorMessage="";this.email=t.email;i=t.confirmCode||"";this.confirmCode=i.replace(new RegExp("___","g"),"/");setTimeout(function(){return r.confirm()},1e3)}return n.prototype.confirm=function(){var n=this;this.accountApi.confirmEmail(this.email,this.confirmCode).then(function(t){return n.confirmEmailCompleted(t)}).catch(function(t){return n.confirmEmailCompleted({errorMessage:t&&t.data&&t.data.exceptionMessage?t.data.exceptionMessage:"Couldn't confirm email",success:!1})})},n.prototype.confirmEmailCompleted=function(n){this.isConfirming=!1;this.confirmSucceeded=n.success;this.confirmFailed=!this.confirmSucceeded;this.confirmFailedErrorMessage=n.errorMessage},n.$inject=["accountApi","$routeParams",],n}();n.ConfirmEmailController=t;n.App.controller("ConfirmEmailController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i){this.accountApi=n;this.appNav=t;this.password="";this.showPasswordError=!1;this.isSaving=!1;this.hasCreatedPassword=!1;this.email=i.email;this.emailWithoutDomain=this.email.substr(0,this.email.indexOf("@"))}return Object.defineProperty(t.prototype,"isPasswordValid",{get:function(){return!!this.password&&this.password.length>=6&&!!this.password.match(n.ResetPasswordController.regexContainsLetterAndNumber)},enumerable:!0,configurable:!0}),t.prototype.createPassword=function(){var n=this;if(!this.isPasswordValid){this.showPasswordError=!0;return}this.isSaving||(this.isSaving=!0,this.accountApi.createPassword(this.email,this.password).then(function(){return n.hasCreatedPassword=!0}).finally(function(){return n.isSaving=!1}))},t.minPasswordLength=6,t.$inject=["accountApi","appNav","$routeParams",],t}();n.CreatePasswordController=t;n.App.controller("CreatePasswordController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var f=this,r,u;this.$uibModalInstance=t;this.$q=i;this.rawImage=null;this.croppedImage=null;this.croppedBase64=null;r=this.loadRawImage(n);u=t.rendered;i.all([r,u]).then(function(n){return f.rawImage=n[0]})}return n.prototype.loadRawImage=function(n){var i=this.$q.defer(),t=new FileReader;return t.addEventListener("load",function(){return i.resolve(t.result)},!1),t.readAsDataURL(n),i.promise},n.prototype.close=function(){this.$uibModalInstance.close()},n.prototype.apply=function(){var n={image:this.croppedImage,imageBase64:this.croppedBase64};this.$uibModalInstance.close(n)},n.$inject=["imageFile","$uibModalInstance","$q"],n}();n.CropImageController=t;n.App.controller("CropImageController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.initConfig=i;this.desiredArtistName=null;this.selectedArtist=null;this.donationTargetOptions=[this.initConfig.title,"All artists on "+this.initConfig.title,];this.donationTarget=this.donationTargetOptions[0];this.desiredArtistName=t.artist;this.desiredArtistName&&(this.donationTargetOptions.push(this.desiredArtistName),this.donationTarget=this.desiredArtistName);n.getAll("",0,1e3).then(function(n){return r.allArtistsFetched(n.items)})}return n.prototype.allArtistsFetched=function(n){var t,i=n.map(function(n){return n.name});(t=this.donationTargetOptions).push.apply(t,i)},n.$inject=["artistApi","$routeParams","initConfig",],n}();n.DonateController=t;n.App.controller("DonateController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r){var e=this,u,f,o;this.albumApi=n;this.appNav=t;this.$q=r;this.album=null;this.allAlbumSwatches=[];this.hasChangedAlbumArt=!1;u=i.artist;f=i.album;u&&f?(o=u.toLowerCase()==="albums",o?this.albumApi.get(u+"/"+f).then(function(n){return e.albumLoaded(n)}):this.albumApi.getByArtistAndAlbumName(u,f).then(function(n){return e.albumLoaded(n)})):this.createNewAlbum()}return t.prototype.createNewAlbum=function(){return new n.Album({albumArtUri:"",artist:"[new artist]",isVariousArtists:!1,backgroundColor:"",foregroundColor:"",mutedColor:"",name:"[new album]",id:"",textShadowColor:"",songCount:0})},t.prototype.albumLoaded=function(n){var t=this;n?(this.album=n,n.albumArtUri&&this.loadCanvasSafeAlbumArt(n.albumArtUri).then(function(n){return t.populateColorSwatches(n)})):this.appNav.createAlbum()},t.prototype.save=function(){var n=this,t;return this.album&&!this.album.isSaving&&(this.album.isSaving=!0,t=void 0,this.hasChangedAlbumArt?this.albumApi.save(this.album).then(function(t){return n.albumApi.changeArt(t.id,n.album.albumArtUri)}).then(function(t){n.album=t;n.hasChangedAlbumArt=!1}).finally(function(){return n.album.isSaving=!1}):this.albumApi.save(this.album).then(function(t){return n.album=t}).finally(function(){return n.album.isSaving=!1})),null},t.prototype.hexToRgbString=function(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t&&t.length>=4?"rgb("+parseInt(t[1],16)+", "+parseInt(t[2],16)+", "+parseInt(t[3],16)+")":""},t.prototype.resetColorSwatches=function(n){var t=this;this.loadCanvasSafeAlbumArt(n).then(function(n){return t.populateColorSwatches(n)})},t.prototype.chooseAlbumArt=function(){var i=this,t;filepicker.setKey(n.UploadAlbumController.filePickerKey);t={extensions:[".jpg",".png"]};filepicker.pick(t,function(n){return i.albumArtChosen(n)},function(n){return console.log("Album art pick failed.",n)})},t.prototype.albumArtChosen=function(n){var t=this;this.hasChangedAlbumArt=!0;this.album&&(this.album.albumArtUri=n.url);this.loadCanvasSafeAlbumArt(n.url).then(function(n){return t.populateColorSwatches(n)})},t.prototype.populateColorSwatches=function(t){if(this.album){var r=new Vibrant(t,64,5),i=r.swatches();i&&(this.allAlbumSwatches=n.UploadAlbumController.getFriendlySwatches(i),this.album.backgroundColor||(this.album.backgroundColor=(i.DarkVibrant||i.DarkMuted||n.Song.defaultSwatch).getHex(),this.album.foregroundColor=(i.LightVibrant||i.Vibrant||n.Song.defaultSwatch).getHex(),this.album.mutedColor=(i.DarkMuted||i.DarkVibrant||i.Vibrant||n.Song.defaultSwatch).getBodyTextColor(),this.album.textShadowColor=(i.DarkMuted||i.DarkVibrant||n.Song.defaultSwatch).getHex()))}},t.prototype.loadCanvasSafeAlbumArt=function(n){if(!n)throw new Error("imgUrl must not be null or undefined");var i=this.$q.defer(),t=document.createElement("img");return t.src="/api/albums/imageOnDomain?imageUrl="+encodeURIComponent(n),t.addEventListener("load",function(){i.resolve(t)}),t.addEventListener("error",function(){return i.reject()}),i.promise},t.$inject=["albumApi","appNav","$routeParams","$q",],t}();n.EditAlbumController=t;n.App.controller("EditAlbumController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r){var f=this,u;this.artistApi=t;this.$scope=r;u=i.artistName;u&&u.length>0?this.artistApi.getByName(u).then(function(n){return f.artist=n}):this.artist=new n.Artist}return t.prototype.removeImage=function(n){this.artist&&(this.artist.images=this.artist.images.filter(function(t){return t!==n}))},t.prototype.addImages=function(){var i=this,t;filepicker.setKey(n.UploadAlbumController.filePickerKey);t={extensions:[".jpg",".png"],maxFiles:100};filepicker.pickMultiple(t,function(n){return i.imagesAdded(n)},function(n){return console.log("Failed to add image.",n)})},t.prototype.imagesAdded=function(n){var t=this;n.forEach(function(n){return t.artist.images.push(n.url)});this.$scope.$applyAsync()},t.prototype.save=function(){var n=this;this.artist&&!this.artist.isSaving&&(this.artist.isSaving=!0,this.artistApi.save(this.artist).then(function(t){return n.artist.updateFrom(t)}).finally(function(){return n.artist.isSaving=!1}))},t.$inject=["artistApi","$routeParams","$scope",],t}();n.EditArtistController=t;n.App.controller("EditArtistController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r){this.songEditApi=n;this.tagApi=t;this.song=null;this.tagsInput="";this.isSaving=!1;this.isSaveSuccess=!1;this.isSaveFail=!1;this.tags=[];this.isLyricsFocused=!0;this.tagPlaceholder="piano, violin, male vocal, hebrew, psalms";this.songId="songs/"+r.id;this.isAdmin=!!i.currentUser&&i.currentUser.isAdmin}return t.prototype.$onInit=function(){var n=this;this.songId&&this.songEditApi.getSongEdit(this.songId).then(function(t){return n.songEditLoaded(t)})},t.prototype.searchTags=function(n){return this.tagApi.searchTags(n)},t.prototype.songEditLoaded=function(t){this.song=n.Song.empty();this.song.id=t.songId;this.song.name=t.newName;this.song.hebrewName=t.newHebrewName;this.song.album=t.newAlbum;this.song.artist=t.newArtist;this.song.lyrics=t.newLyrics;this.song.albumArtUri="/api/albums/getAlbumArtBySongId?songId="+t.songId;this.tags=t.newTags;this.tags.length>0&&(this.tagPlaceholder="")},t.prototype.tagsInputChanged=function(){var t=this,n;this.tagsInput.includes(",")&&(n=this.tagsInput.split(","),this.tagsInput="",n.filter(function(n){return n&&n.length>1}).forEach(function(n){return t.addTag(n)}))},t.prototype.removeTag=function(n){var t=this.tags.indexOf(n);t>=0&&this.tags.splice(t,1)},t.prototype.autoCompleteTagSelected=function(n){this.addTag(n);this.tagsInput=""},t.prototype.addTag=function(n){var t=n.toLowerCase().trim();!this.tags.includes(t)&&t.length>1&&(this.tags.push(t),this.tagPlaceholder="")},t.prototype.tagsEnterKeyPressed=function(){this.tagsInput.length>1&&this.autoCompleteTagSelected(this.tagsInput)},t.prototype.submit=function(){var n=this;this.song&&!this.isSaving&&(this.song.tags=this.tags,this.isSaving=!0,this.songEditApi.submit(this.song).then(function(){return n.isSaveSuccess=!0}).catch(function(){return n.isSaveFail=!0}).finally(function(){return n.isSaving=!1}))},t.$inject=["songEditApi","tagApi","accountApi","$routeParams",],t}();n.EditSongController=t;n.App.controller("EditSongController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i){var r=this;this.songApi=t;this.appNav=i;this.songs=new n.PagedList(function(n,t){return r.songApi.getSongsAdmin(n,t,r.search)});this.search=""}return t.prototype.$onInit=function(){this.songs.fetchNextChunk()},t.prototype.searchChanged=function(){this.songs.resetAndFetch()},t.prototype.deleteSong=function(n){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(r){switch(r.label){case 0:return t=this.appNav.confirmDeleteSong(n),[4,t.result];case 1:return i=r.sent(),i&&_.pull(this.songs.items,n),[2]}})})},t.$inject=["songApi","appNav"],t}();n.EditSongsController=t;n.App.controller("EditSongsController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r,u,f,e,o,s,h){var c=this;this.audioPlayer=n;this.songBatch=t;this.likeApi=i;this.songRequestApi=r;this.accountApi=u;this.userApi=f;this.stationIdentifier=e;this.adAnnouncer=o;this.appNav=s;this.$scope=h;this.volumeShown=!1;this.volumeVal=new Rx.Subject;this.isBuffering=!1;this.lastAudioErrorTime=null;this.stalledTimerHandle=null;this.audio=null;this.audioPlayer.status.debounce(100).subscribe(function(n){return c.audioStatusChanged(n)});this.audioPlayer.playedTimeText.distinctUntilChanged().subscribe(function(n){return $(".footer .track-time").text(n)});this.audioPlayer.duration.distinctUntilChanged().subscribe(function(n){return $(".footer .track-duration").text(c.getFormattedTime(n))});this.audioPlayer.status.distinctUntilChanged().subscribe(function(n){return $(".footer .audio-status").text(c.getAudioStatusText(n))});this.audioPlayer.playedTimePercentage.distinctUntilChanged().subscribe(function(n){return $(".footer .trackbar").width(n+"%")});this.accountApi.signedIn.distinctUntilChanged().where(function(n){return n}).subscribe(function(){return c.restoreVolumeFromSignedInUser()})}return Object.defineProperty(t.prototype,"likesCurrentSong",{get:function(){var t=this.audioPlayer.song.getValue();return t?t.songLike===n.SongLike.Liked:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dislikesCurrentSong",{get:function(){var t=this.audioPlayer.song.getValue();return t?t.songLike===n.SongLike.Disliked:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"likeText",{get:function(){return this.likesCurrentSong?"You have already liked this song. Chavah is playing it more often.":"Like this song. Chavah will play this song, and others like it, more often."},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dislikeText",{get:function(){return this.dislikesCurrentSong?"You have already disliked this song. Chavah is playing it less often.":"Dislike this song. Chavah will play this song, and others like it, less often."},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volumeIconClass",{get:function(){return this.volume>.95?"fa-volume-up":this.volume<.05?"fa-volume-off":"fa-volume-down"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this.audio?this.audio.volume:1},set:function(n){this.audio&&(this.audio.volume=n);this.volumeVal.onNext(n)},enumerable:!0,configurable:!0}),t.prototype.$onInit=function(){var n=this;if(this.audio=document.querySelector("#audio"),!this.audio)throw new Error("Couldn't locate #audio element");this.audioPlayer.initialize(this.audio);this.restoreVolumeFromSignedInUser();this.volumeVal.distinctUntilChanged().debounce(2e3).where(function(t){return!!n.accountApi.currentUser&&n.accountApi.currentUser.volume!==t}).subscribe(function(t){return n.saveVolumePreference(t)})},t.prototype.toggleVolumnShown=function(){this.volumeShown=!this.volumeShown},t.prototype.isPaused=function(){return this.audioPlayer.status.getValue()===n.AudioStatus.Paused},t.prototype.playPause=function(){this.audioPlayer.status.getValue()===n.AudioStatus.Playing?this.audioPlayer.pause():this.audioPlayer.resume()},t.prototype.dislikeSong=function(){if(this.requireSignIn()){var t=this.audioPlayer.song.getValue();t&&t.songLike!==n.SongLike.Disliked&&(t.songLike=n.SongLike.Disliked,this.likeApi.dislikeSong(t.id).then(function(n){return t.communityRank=n}),this.songBatch.playNext())}},t.prototype.likeSong=function(){if(this.requireSignIn()){var t=this.audioPlayer.song.getValue();t&&t.songLike!==n.SongLike.Liked&&(t.songLike=n.SongLike.Liked,this.likeApi.likeSong(t.id).then(function(n){return t.communityRank=n}))}},t.prototype.requestSong=function(){var n=this;this.requireSignIn()&&this.appNav.songRequestModal().result.then(function(t){return n.songRequestDialogCompleted(t)})},t.prototype.requireSignIn=function(){return this.accountApi.isSignedIn?!0:(this.appNav.promptSignIn(),!1)},t.prototype.songRequestDialogCompleted=function(n){var t=this;n&&(this.audioPlayer.pause(),this.songRequestApi.requestSong(n).then(function(){return t.playNextSong()}))},t.prototype.playNextSong=function(){this.audioPlayer.pause();this.songRequestApi.hasPendingRequest()?this.songRequestApi.playRequest():this.stationIdentifier.hasPendingAnnouncement()?this.stationIdentifier.playStationIdAnnouncement():this.adAnnouncer.hasPendingAnnouncement()?this.adAnnouncer.playAdAnnouncement():this.songBatch.playNext()},t.prototype.audioStatusChanged=function(t){var i=this,r,u;t===n.AudioStatus.Ended&&this.playNextSong();t===n.AudioStatus.Erred?(r=30,u=this.lastAudioErrorTime===null||moment().diff(moment(this.lastAudioErrorTime),"seconds")>r,u&&this.playNextSong(),this.lastAudioErrorTime=new Date):t===n.AudioStatus.Stalled&&this.stalledTimerHandle&&(clearTimeout(this.stalledTimerHandle),this.stalledTimerHandle=setTimeout(function(){i.audioPlayer.status.getValue()===n.AudioStatus.Stalled&&i.playNextSong()},5e3));this.isBuffering=t===n.AudioStatus.Buffering||t===n.AudioStatus.Stalled;this.$scope.$applyAsync()},t.prototype.getFormattedTime=function(n){if(isNaN(n))return"00";var t=Math.floor(n/60),i=Math.floor(n-t*60),r=i<10?"0":"";return t+":"+r+i},t.prototype.getAudioStatusText=function(t){switch(t){case n.AudioStatus.Aborted:return"Unable to play";case n.AudioStatus.Buffering:return"Buffering...";case n.AudioStatus.Ended:return"Ended...";case n.AudioStatus.Erred:return"Encountered an error";case n.AudioStatus.Paused:return"Paused";case n.AudioStatus.Playing:return"";case n.AudioStatus.Stalled:return"Stalled..."}},t.prototype.restoreVolumeFromSignedInUser=function(){this.accountApi.currentUser&&(this.volume=Math.max(.1,this.accountApi.currentUser.volume))},t.prototype.saveVolumePreference=function(n){this.accountApi.currentUser&&this.accountApi.currentUser.volume!==n&&(this.accountApi.currentUser.volume=n,this.userApi.saveVolume(n))},t.$inject=["audioPlayer","songBatch","likeApi","songRequestApi","accountApi","userApi","stationIdentifier","adAnnouncer","appNav","$scope"],t}();n.FooterController=t;n.App.controller("FooterController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.accountApi=n;this.email="";this.resetPasswordSuccessfully=!1;this.couldNotFindEmail=!1;this.resetErrorMessage="";this.isBusy=!1}return Object.defineProperty(n.prototype,"registerUrl",{get:function(){return this.email&&this.email.indexOf("@")>=0?"#/register/"+encodeURIComponent(this.email):"#/register"},enumerable:!0,configurable:!0}),n.prototype.resetPassword=function(){var n=this,t=this.email&&this.email.includes("@");if(!t){this.resetErrorMessage="Please enter your email so we can reset your password";return}this.resetFields();this.isBusy||(this.isBusy=!0,this.accountApi.sendPasswordResetEmail(this.email).then(function(t){return n.passwordResetCompleted(t)}).finally(function(){return n.isBusy=!1}))},n.prototype.passwordResetCompleted=function(n){n.success?this.resetPasswordSuccessfully=!0:n.invalidEmail?this.couldNotFindEmail=!0:this.resetErrorMessage=n.errorMessage||"Unable to reset password"},n.prototype.resetFields=function(){this.couldNotFindEmail=!1;this.resetPasswordSuccessfully=!1;this.resetErrorMessage=""},n.$inject=["accountApi",],n}();n.ForgotPasswordController=t;n.App.controller("ForgotPasswordController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.initConfig=n;this.accountApi=t;this.appNav=i;this.profilePicUrl=null;this.notifications=n.user?n.user.notifications:[];this.profilePicUrl=n.user?n.user.profilePicUrl:null;this.accountApi.signedIn.select(function(){return r.accountApi.currentUser}).subscribe(function(n){return r.signedInUserChanged(n)})}return Object.defineProperty(n.prototype,"currentUserName",{get:function(){return this.accountApi.currentUser?this.accountApi.currentUser.email:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"unreadNotificationCount",{get:function(){return this.notifications.filter(function(n){return n.isUnread}).length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this.initConfig.title},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"desc",{get:function(){return this.initConfig.description},enumerable:!0,configurable:!0}),n.prototype.markNotificationsAsRead=function(){this.notifications.some(function(n){return n.isUnread})&&(this.notifications.forEach(function(n){return n.isUnread=!1}),this.accountApi.clearNotifications())},n.prototype.signOut=function(){var n=this;this.accountApi.signOut().then(function(){return n.appNav.signOut()})},n.prototype.signedInUserChanged=function(n){n&&(this.notifications=n.notifications,this.profilePicUrl=n.profilePicUrl)},n.$inject=["initConfig","accountApi","appNav"],n}();n.HeaderController=t;n.App.controller("HeaderController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t){var i=this;this.logApi=t;this.logs=new n.PagedList(function(n,t){return i.logApi.getAll(n,t,i.selectedFilter.value,i.selectedSort.value)});this.saving=!1;this.timeAgoCache={};this.filterOptions=[{title:"All",value:null,description:""},{title:"Critical",value:n.LogLevel.Critical,description:"text-danger"},{title:"Error",value:n.LogLevel.Error,description:"text-danger"},{title:"Warning",value:n.LogLevel.Warning,description:"text-warning"},{title:"Info",value:n.LogLevel.Information,description:"text-info"},{title:"Debug",value:n.LogLevel.Debug,description:"text-info"},{title:"Trace",value:n.LogLevel.Trace,description:"text-info"}];this.selectedFilter=this.filterOptions[0];this.sortOptions=[{title:"Newest",value:n.LogSort.Newest},{title:"Oldest",value:n.LogSort.Oldest},{title:"Total occurrences",value:n.LogSort.OccurrenceCount}];this.selectedSort=this.sortOptions[0]}return t.prototype.$onInit=function(){this.logs.fetchNextChunk()},t.prototype.getTimeAgo=function(n){var f=this.timeAgoCache[n];if(f)return f;var e=moment(n).local(),o=e.diff(moment()),s=Math.abs(o),h=s/1e3,t=h/60,i=t/60,r=i/24,u="";return u=r>=1?Math.floor(r)+" day"+(r>=2?"s":"")+" ago ("+e.format("M/D/YY H:mm a")+")":i>=1?Math.floor(i)+" hour"+(i>=2?"s":"")+" ago":t>=1?Math.floor(t)+" minute"+(t>=2?"s":"")+" ago":"less than a minute ago",this.timeAgoCache[n]=u,u},t.prototype.getFriendlyDate=function(n){return moment(n).local().format("dddd MMMM DD, YYYY h:mma")},t.prototype.deleteLog=function(n){var t=this;this.saving||(this.saving=!0,this.logApi.deleteLog(n.id).then(function(){return t.logs.resetAndFetch()}).finally(function(){return t.saving=!1}))},t.prototype.getActiveOccurrenceText=function(n){var t=n.occurrences[n.activeOccurrenceIndex];return t?JSON.stringify(t,null,4):""},t.prototype.getIconClass=function(t){switch(t){case n.LogLevel.Critical:case n.LogLevel.Error:return"fa-exclamation-circle text-danger";case n.LogLevel.Warning:return"fa-exclamation-triangle text-warning";case n.LogLevel.Information:case n.LogLevel.Debug:case n.LogLevel.Trace:return"fa-info-circle text-info";default:return""}},t.prototype.getLogClass=function(t){switch(t.level){case n.LogLevel.Critical:return"left-border border-danger text-danger";case n.LogLevel.Error:return"left-border border-danger";case n.LogLevel.Warning:return"left-border border-warning";case n.LogLevel.Information:return"left-border border-info";default:return""}},t.prototype.getLevelDescription=function(n){var t=this.filterOptions.find(function(t){return t.value===n});return t?t.title:""},t.prototype.getException=function(n){var t=n.occurrences.find(function(n){return!!n.exception});return t?t.exception:null},t.prototype.getLogLevel=function(t){switch(t.level){case n.LogLevel.Critical:return"Critical";case n.LogLevel.Error:return"Error";case n.LogLevel.Warning:return"Warn";case n.LogLevel.Information:return"Info";case n.LogLevel.Debug:return"Debug";case n.LogLevel.Trace:return"Trace";default:return""}},t.prototype.getLogDetails=function(n){return n.activeCategory==="Message"?n.messageTemplate:n.activeCategory==="Exception"?this.getException(n):n.activeCategory==="Occurrences"?this.getActiveOccurrenceText(n):""},t.prototype.selectFilter=function(n){this.selectedFilter!==n&&(this.selectedFilter=n,this.logs.resetAndFetch())},t.prototype.selectSort=function(n){this.selectedSort!==n&&(this.selectedSort=n,this.logs.resetAndFetch())},t.$inject=["logApi"],t}();n.LogEditorController=t;n.App.controller("LogEditorController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r,u,f){var e=this;this.songApi=t;this.albumApi=i;this.artistApi=r;this.audioPlayer=u;this.appNav=f;this.songs=new n.PagedList(function(n,t){return e.songApi.getLikes(n,t,e.search)});this.albums=new n.PagedList(function(n,t){return e.albumApi.getLikedAlbums(n,t,e.search)});this.artists=new n.PagedList(function(n,t){return e.artistApi.getLikedArtists(n,t,e.search)});this.searchText="";this.activeCategory="Songs";this.allCategories=["Songs","Albums","Artists",];this.songs.take=20;this.albums.take=20;this.artists.take=20}return Object.defineProperty(t.prototype,"search",{get:function(){return this.searchText},set:function(n){this.searchText=n;this.fetchItemsForCurrentView()},enumerable:!0,configurable:!0}),t.prototype.$onInit=function(){this.songs.fetchNextChunk()},t.prototype.playSong=function(n){this.audioPlayer.playSongById(n.id);this.appNav.nowPlaying()},t.prototype.playAlbum=function(n){this.audioPlayer.playSongFromAlbumId(n.id);this.appNav.nowPlaying()},t.prototype.playArtist=function(n){this.audioPlayer.playSongFromArtist(n.name);this.appNav.nowPlaying()},t.prototype.loadMoreSongs=function(){this.songs.fetchNextChunk()},t.prototype.loadMoreAlbums=function(){this.albums.fetchNextChunk()},t.prototype.loadMoreArtists=function(){this.artists.fetchNextChunk()},t.prototype.setCategory=function(n){this.activeCategory!==n&&(this.activeCategory=n,this.fetchItemsForCurrentView())},t.prototype.fetchItemsForCurrentView=function(){switch(this.activeCategory){case"Songs":this.songs.resetAndFetch();break;case"Albums":this.albums.resetAndFetch();break;case"Artists":this.artists.resetAndFetch()}},t.$inject=["songApi","albumApi","artistApi","audioPlayer","appNav"],t}();n.MyLikesController=t;n.App.controller("MyLikesController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r,u,f,e,o,s){var h=this,c;this.songApi=n;this.songBatch=t;this.audioPlayer=i;this.albumCache=r;this.initConfig=u;this.appNav=f;this.accountApi=e;this.$q=o;this.sharing=s;this.songs=[];this.trending=[];this.recent=[];this.popular=[];this.likes=[];this.isFetchingAlbums=!1;this.disposed=new Rx.Subject;this.audioPlayer.song.takeUntil(this.disposed).subscribeOnNext(function(n){return h.nextSongBeginning(n)});this.audioPlayer.songCompleted.takeUntil(this.disposed).throttle(5e3).subscribe(function(n){return h.songCompleted(n)});this.songBatch.songsBatch.takeUntil(this.disposed).subscribeOnNext(function(){return h.songs=h.getSongs()});this.fetchRecentPlays();this.setupRecurringFetches();u.embed?(this.audioPlayer.playNewSong(this.initConfig.song),this.audioPlayer.pause()):(c=this.audioPlayer.song.getValue(),c||this.playSongInUrlQuery()||this.songBatch.playNext())}return Object.defineProperty(t.prototype,"currentArtistDonateUrl",{get:function(){var n=this.currentSong;return n&&n.artist?"#/donate/"+encodeURIComponent(n.artist):"#/donate"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSongShareUrl",{get:function(){return this.currentSong?this.currentSong.isShowingEmbedCode?this.sharing.getEmbedCode(this.currentSong.id):this.sharing.shareUrl(this.currentSong.id):""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSongTwitterShareUrl",{get:function(){return this.currentSong?this.sharing.twitterShareUrl(this.currentSong):"#"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSongFacebookShareUrl",{get:function(){return this.currentSong?this.sharing.facebookShareUrl(this.currentSong):"#"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSongGooglePlusShareUrl",{get:function(){return this.currentSong?this.sharing.googlePlusShareUrl(this.currentSong.id):"#"},enumerable:!0,configurable:!0}),t.prototype.getEditSongUrl=function(){return this.currentSong?this.accountApi.isSignedIn?this.appNav.getEditSongUrl(this.currentSong.id):this.appNav.promptSignInUrl:"#"},t.prototype.$onDestroy=function(){this.recurringFetchHandle&&clearTimeout(this.recurringFetchHandle);this.disposed.onNext(!0)},t.prototype.getSongs=function(){var n=[this.audioPlayer.song.getValue(),this.songBatch.songsBatch.getValue()[0],this.songBatch.songsBatch.getValue()[1],this.songBatch.songsBatch.getValue()[2],this.songBatch.songsBatch.getValue()[3]].filter(function(n){return!!n&&n.name});return this.fetchAlbumColors(n),n},t.prototype.getSongOrPlaceholder=function(t){return t||n.Song.empty()},t.prototype.fetchAlbumColors=function(n){var i=this,t=n.filter(function(n){return!n.hasSetAlbumArtColors&&n.id!=="songs/0"});t.length>0&&(this.isFetchingAlbums=!0,this.albumCache.getAlbumsForSongs(t).then(function(n){return i.populateSongsWithAlbumColors(n)}))},t.prototype.populateSongsWithAlbumColors=function(n){var t=this;n.forEach(function(n){var i=t.getAllSongsOnScreen().filter(function(t){return t.albumId&&t.albumId.toLowerCase()===n.id.toLowerCase()});i.forEach(function(t){return t.updateAlbumArtColors(n)})})},t.prototype.setupRecurringFetches=function(){var n=this,t=this.songApi.getTrendingSongs(0,3).then(function(t){return n.updateSongList(n.trending,t.items)}).then(function(){return n.songApi.getPopularSongs(3)}).then(function(t){return n.updateSongList(n.popular,t)}).then(function(){return n.songApi.getRandomLikedSongs(3)}).then(function(t){return n.updateSongList(n.likes,t)}).finally(function(){n.fetchAlbumColors(n.getAllSongsOnScreen());n.recurringFetchHandle=setTimeout(function(){return n.setupRecurringFetches()},6e4)})},t.prototype.fetchRecentPlays=function(){var n=this;this.songApi.getRecentPlays(3).then(function(t){t.forEach(function(t){return n.recent.push(t)});n.recent.length>3&&(n.recent.length=3)})},t.prototype.updateSongList=function(n,t){n.splice.apply(n,[0,n.length].concat(t));this.fetchAlbumColors(this.getAllSongsOnScreen())},t.prototype.getAllSongsOnScreen=function(){return this.songs.concat(this.recent,this.trending,this.likes,this.popular)},t.prototype.nextSongBeginning=function(n){this.songs=this.getSongs();n&&(this.currentSong&&(this.recent.splice(0,0,this.currentSong),this.recent.length>3&&(this.recent.length=3)),this.currentSong=n)},t.prototype.songCompleted=function(n){n&&this.songApi.songCompleted(n.id)},t.prototype.songClicked=function(t){if(t!==this.currentSong){t.setSolePickReason(n.SongPick.YouRequestedSong);var i=this.songBatch.songsBatch.getValue(),r=i.indexOf(t);r>=0&&(i.splice(r,1),i.splice(0,0,t),this.songBatch.playNext())}},t.prototype.playSongFromCurrentArtist=function(){this.currentSong&&this.audioPlayer.playSongFromArtist(this.currentSong.artist)},t.prototype.playSongFromCurrentAlbum=function(){this.currentSong&&this.audioPlayer.playSongFromAlbum(this.currentSong.album)},t.prototype.playSongWithTag=function(n){this.audioPlayer.playSongWithTag(n)},t.prototype.playSongInUrlQuery=function(){var i=this.getUrlQueryOrNull("song"),n,t;return i?(this.audioPlayer.playSongById(i),!0):(n=this.getUrlQueryOrNull("artist"),t=this.getUrlQueryOrNull("album"),n&&t)?(this.audioPlayer.playSongFromArtistAndAlbum(n,t),!0):t?(this.audioPlayer.playSongFromAlbum(t),!0):n?(this.audioPlayer.playSongFromArtist(n),!0):!1},t.prototype.copyShareUrl=function(){var n=document.querySelector("#currentSongShareLink"),f=navigator.userAgent.match(/ipad|iphone/i),r,u,t,i;f?(r=n.contentEditable,u=n.readOnly,n.contentEditable="true",n.readOnly=!1,t=document.createRange(),t.selectNodeContents(n),i=window.getSelection(),i.removeAllRanges(),i.addRange(t),n.setSelectionRange(0,999999),n.contentEditable=r,n.readOnly=u):n.select();document.execCommand("copy")},t.prototype.tryNativeShare=function(){this.currentSong&&this.currentSong.isShareExpanded&&this.sharing.nativeShareUrl(this.currentSong)},t.prototype.getUrlQueryOrNull=function(n){var r=window.location.search,i,f;if(r){var e=r.split("&"),u=n+"=",o="?"+u,t=e.find(function(n){return n.startsWith(u)||n.startsWith(o)});if(t&&(i=t.substr(t.indexOf("=")+1),i))return f=i.split("+").join(" "),decodeURIComponent(f)}return null},t.$inject=["songApi","songBatch","audioPlayer","albumCache","initConfig","appNav","accountApi","$q","sharing"],t}();n.NowPlayingController=t;n.App.controller("NowPlayingController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r,u){var f=this;this.accountApi=n;this.appNav=t;this.$timeout=r;this.email="";this.showPasswordError=!1;this.passwordError="";this.isBusy=!1;this.password="";this.staySignedIn=!0;this.signInSuccessful=!1;this.email=i.email;u.$watch(function(){return f.password},function(){return f.passwordChanged()})}return Object.defineProperty(t.prototype,"isPasswordValid",{get:function(){return this.password.length>=6},enumerable:!0,configurable:!0}),t.prototype.signIn=function(){var n=this;if(!this.isPasswordValid){this.showPasswordError=!0;this.passwordError="Passwords must be at least 6 characters long.";return}this.isBusy||(this.isBusy=!0,this.accountApi.signIn(this.email,this.password,this.staySignedIn).then(function(t){return n.signInCompleted(t)}).finally(function(){return n.isBusy=!1}))},t.prototype.signInCompleted=function(t){var i=this;t.status===n.SignInStatus.Success?(this.signInSuccessful=!0,this.$timeout(function(){return i.appNav.nowPlaying()},2e3)):t.status===n.SignInStatus.LockedOut?(this.showPasswordError=!0,this.passwordError="Your account is locked out. Please contact judahgabriel@gmail.com"):t.status===n.SignInStatus.RequiresVerification?(this.showPasswordError=!0,this.passwordError="Please check your email. We've sent you an email with a link to confirm your account."):t.status===n.SignInStatus.Failure&&(this.showPasswordError=!0,this.passwordError="Incorrect password")},t.prototype.passwordChanged=function(){this.showPasswordError=!1;this.passwordError=""},t.$inject=["accountApi","appNav","$routeParams","$timeout","$scope",],t}();n.PasswordController=t;n.App.controller("PasswordController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r){this.appNav=t;this.accountApi=i;this.userApi=r;this.profilePicUrl=null;this.isSaving=!1;this.isUploadingPhoto=!1;this.hasSavedSuccessfully=!1;this.user=new n.User(this.accountApi.currentUser);this.profilePicUrl=this.user.profilePicUrl;var u=moment(this.user.registrationDate);this.registrationDateAgo=u.fromNow()+" ("+u.format("dddd, MMMM Do YYYY, h:mm a")+")"}return Object.defineProperty(t.prototype,"isSavingOrUploading",{get:function(){return this.isSaving||this.isUploadingPhoto},enumerable:!0,configurable:!0}),t.prototype.$onInit=function(){},t.prototype.launchImagePicker=function(){$("#imagePicker").click()},t.prototype.profilePicChanged=function(n){return __awaiter(this,void 0,void 0,function(){var r,i,t,u;return __generator(this,function(f){switch(f.label){case 0:return!this.isSaving?(r=n.target.files,i=r.item(0),!i)?[3,5]:[4,this.appNav.cropImageModal(i).result]:[3,5];case 1:if(t=f.sent(),!(t&&t.image))return[3,5];t.imageBase64&&(this.profilePicUrl=t.imageBase64);this.isUploadingPhoto=!0;this.hasSavedSuccessfully=!1;f.label=2;case 2:return f.trys.push([2,,4,5]),[4,this.userApi.updateProfilePic(t.image)];case 3:return u=f.sent(),this.profilePicUrl=u,this.hasSavedSuccessfully=!0,[3,5];case 4:return this.isUploadingPhoto=!1,[7];case 5:return[2]}})})},t.prototype.save=function(){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(t){switch(t.label){case 0:if(!!this.isSaving)return[3,4];this.isSaving=!0;this.hasSavedSuccessfully=!1;t.label=1;case 1:return t.trys.push([1,,3,4]),[4,this.userApi.updateProfile(this.user)];case 2:return n=t.sent(),this.hasSavedSuccessfully=!0,this.profileSaved(n),[3,4];case 3:return this.isSaving=!1,[7];case 4:return[2]}})})},t.prototype.profileSaved=function(n){this.accountApi.currentUser&&this.accountApi.currentUser.updateFrom(n)},t.$inject=["appNav","accountApi","userApi"],t}();n.ProfileController=t;n.App.controller("ProfileController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.accountApi=n;this.email="";this.password="";this.showEmailError=!1;this.showPasswordError=!1;this.showRegisterSuccess=!1;this.showAlreadyRegistered=!1;this.showNeedsConfirmation=!1;this.registrationError="";this.isBusy=!1;var i=t.email;i&&(this.email=i)}return Object.defineProperty(n.prototype,"isValidEmail",{get:function(){return!!this.email&&this.email.lastIndexOf("@")>=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isValidPassword",{get:function(){return!!this.password&&this.password.length>=6},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"showRegisterForm",{get:function(){return!this.showAlreadyRegistered&&!this.showNeedsConfirmation&&!this.showRegisterSuccess},enumerable:!0,configurable:!0}),n.prototype.register=function(){var n=this;if(this.reset(),!this.isValidEmail){this.showEmailError=!0;return}if(!this.isValidPassword){this.showPasswordError=!0;return}this.isBusy||(this.isBusy=!0,this.accountApi.register(this.email,this.password).then(function(t){return n.registrationCompleted(t)}).finally(function(){return n.isBusy=!1}))},n.prototype.registrationCompleted=function(n){n.success?this.showRegisterSuccess=!0:n.needsConfirmation?this.showNeedsConfirmation=!0:n.isAlreadyRegistered?this.showAlreadyRegistered=!0:this.registrationError=n.errorMessage||"Unable to register your user. Please contact judahgabriel@gmail.com"},n.prototype.reset=function(){this.registrationError="";this.showAlreadyRegistered=!1;this.showEmailError=!1;this.showNeedsConfirmation=!1;this.showPasswordError=!1;this.showRegisterSuccess=!1},n.$inject=["accountApi","$routeParams",],n}();n.RegisterController=t;n.App.controller("RegisterController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.songApi=n;this.templatePaths=t;this.$uibModalInstance=i;this.$q=r;this.songRequestText="";this.songRequestResultView=t.songRequestResult}return n.prototype.getSongMatches=function(n){var i=10,t=this.$q.defer();return this.songApi.getSongMatches(n).then(function(n){return t.resolve(n.slice(0,i))}).catch(function(n){return t.reject(n)}),t.promise},n.prototype.songChosen=function(n){this.selectedSongRequest=n},n.prototype.requestSelectedSong=function(){this.selectedSongRequest&&this.$uibModalInstance.close(this.selectedSongRequest)},n.prototype.close=function(){this.$uibModalInstance.close(null)},n.$inject=["songApi","templatePaths","$uibModalInstance","$q",],n}();n.RequestSongController=t;n.App.controller("RequestSongController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.accountApi=n;this.$routeParams=t;this.email="";this.password="";this.showPasswordError=!1;this.isBusy=!1;this.passwordResetSucccessful=!1;this.passwordResetFailed=!1;this.passwordResetFailedMessage="";this.email=t.email;var r=t.confirmCode,i=t.confirmCode||"";this.confirmCode=i.replace(new RegExp("___","g"),"/")}return Object.defineProperty(n.prototype,"isValidPassword",{get:function(){return!!this.password&&this.password.length>=6&&!!this.password.match(n.regexContainsLetterAndNumber)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"showChangePasswordForm",{get:function(){return!this.passwordResetSucccessful&&!this.passwordResetFailed},enumerable:!0,configurable:!0}),n.prototype.changePassword=function(){var n=this;if(!this.isValidPassword){this.showPasswordError=!0;return}this.isBusy||(this.resetValidationStates(),this.isBusy=!0,this.accountApi.resetPassword(this.email,this.confirmCode,this.password).then(function(t){return n.passwordResetCompleted(t)}).finally(function(){return n.isBusy=!1}))},n.prototype.passwordResetCompleted=function(n){n.success?this.passwordResetSucccessful=!0:(this.passwordResetFailed=!0,this.passwordResetFailedMessage=n.errorMessage)},n.prototype.resetValidationStates=function(){this.passwordResetFailed=!1;this.passwordResetFailedMessage="";this.passwordResetSucccessful=!1;this.showPasswordError=!1},n.regexContainsLetterAndNumber=/^(?=.*[a-zA-Z])(?=.*[0-9])/,n.$inject=["accountApi","$routeParams"],n}();n.ResetPasswordController=t;n.App.controller("ResetPasswordController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.artist=n.artist}return Object.defineProperty(n.prototype,"donateUrl",{get:function(){return this.artist?"#/donate/"+encodeURIComponent(this.artist):"#/donate"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"donateText",{get:function(){return this.artist?"Donate to "+this.artist:"Donate to the artists"},enumerable:!0,configurable:!0}),n.$inject=["$routeParams",],n}();n.ShareThanksController=t;n.App.controller("ShareThanksController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.accountApi=n;this.appNav=t;this.email="";this.showEmailError=!1;this.showUserNotInSystem=!1;this.isBusy=!1;i.$watch(function(){return r.email},function(){return r.showUserNotInSystem=!1})}return Object.defineProperty(n.prototype,"registerUrl",{get:function(){return this.email&&this.email.indexOf("@")>=0?"#/register/"+this.email:"#/register"},enumerable:!0,configurable:!0}),n.prototype.checkEmail=function(){var n=this;this.email?this.isBusy||(this.resetValidationStates(),this.isBusy=!0,this.accountApi.getUserWithEmail(this.email).then(function(t){return n.userFetched(t)}).finally(function(){return n.isBusy=!1})):this.showEmailError=!0},n.prototype.userFetched=function(n){n==null?this.showUserNotInSystem=!0:n.requiresPasswordReset?this.appNav.createPassword(this.email):this.appNav.password(this.email)},n.prototype.resetValidationStates=function(){this.showUserNotInSystem=!1;this.showEmailError=!1},n.$inject=["accountApi","appNav","$scope",],n}();n.SignInController=t;n.App.controller("SignInController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.artist=n.artist;this.songName=n.songName}return n.$inject=["$routeParams",],n}();n.SongEditApprovedController=t;n.App.controller("SongEditApprovedController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.audioPlayer=n}return t.prototype.playSong=function(t){var i=new n.Song(t);i.setSolePickReason(n.SongPick.YouRequestedSong);this.audioPlayer.playNewSong(i)},t.$inject=["audioPlayer",],t}();n.SongListController=t;n.App.controller("SongListController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.accountApi=n;this.name="";this.email="";this.message="";this.isSaving=!1;this.state="unsubmitted";n.currentUser&&(this.email=n.currentUser.email)}return Object.defineProperty(n.prototype,"canSubmit",{get:function(){return!this.isSaving&&!!this.message&&this.message.length>0&&!!this.email&&this.email.length>0&&!!this.name&&this.name.length>0},enumerable:!0,configurable:!0}),n.prototype.submit=function(){var n=this;this.canSubmit&&(this.isSaving=!0,this.accountApi.sendSupportMessage(this.name,this.email,this.message,window.navigator.userAgent).then(function(){return n.state="success"},function(){return n.state="error"}).finally(function(){return n.isSaving=!1}))},n.$inject=["accountApi"],n}();n.SupportController=t;n.App.controller("SupportController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.tagApi=n;this.allTags=[];this.selectedTag=null;this.newTagName="";this.isSaving=!1;this.tagApi.getAll().then(function(n){return t.allTags=n.sort()})}return n.prototype.selectTag=function(n){this.newTagName=n||"";this.selectedTag=n},n.prototype.deleteTag=function(n){var t=this;this.isSaving||(this.isSaving=!0,this.tagApi.deleteTag(n).then(function(){_.pull(t.allTags,n);t.selectTag(null)}).finally(function(){return t.isSaving=!1}))},n.prototype.renameTag=function(n){var t=this,i=this.newTagName;this.isSaving||i===n||(this.isSaving=!0,this.tagApi.renameTag(n,i).then(function(r){var u=t.allTags.indexOf(n);u>=0&&(t.allTags[u]=r,t.allTags=_.uniq(t.allTags));t.selectTag(i)}).finally(function(){return t.isSaving=!1}))},n.$inject=["tagApi"],n}();n.TagEditorController=t;n.App.controller("TagEditorController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r){var u=this;this.songApi=t;this.albumCache=i;this.audioPlayer=r;this.songsList=new n.PagedList(function(n,t){return u.songApi.getTrendingSongs(n,t)},undefined,function(n){return u.calcVisibleSongs(n)});this.visibleSongs=[];this.visibleStart=0;this.songsList.fetchNextChunk()}return Object.defineProperty(t.prototype,"canGoPrevious",{get:function(){return this.visibleStart>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canGoNext",{get:function(){return this.songsList.itemsTotalCount!==null&&this.visibleStart<this.songsList.itemsTotalCount-1},enumerable:!0,configurable:!0}),t.prototype.calcVisibleSongs=function(n){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return this.visibleSongs=n.slice(this.visibleStart,this.visibleStart+t.maxVisibleSongs),this.visibleSongs.length<t.maxVisibleSongs&&this.songsList.fetchNextChunk(),[4,this.albumCache.getAlbumsForSongs(this.visibleSongs)];case 1:return i=r.sent(),this.visibleSongs.forEach(function(n){var t=i.find(function(t){return t.artist===n.artist&&t.name===n.album});t&&n.updateAlbumArtColors(t)}),[2]}})})},t.prototype.next=function(){this.canGoNext&&(this.visibleStart++,this.calcVisibleSongs(this.songsList.items))},t.prototype.previous=function(){this.canGoPrevious&&(this.visibleStart--,this.calcVisibleSongs(this.songsList.items))},t.prototype.playSong=function(n){this.audioPlayer.playSongById(n.id)},t.maxVisibleSongs=5,t.$inject=["songApi","albumCache","audioPlayer",],t}();n.TrendingController=t;n.App.controller("TrendingController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r,u,f){var e=this;this.albumApi=i;this.appNav=r;this.$scope=u;this.$sce=f;this.albumName="";this.songs=[];this.isUploading=!1;this.albumArt=null;this.purchaseUrl="";this.genre="";this.allGenres=["Messianic Jewish","Hebrew Roots","Jewish Christian","Jewish","Christian"];this.artist=null;this.allArtists=[];this.foreColor=n.Song.defaultSwatch.getBodyTextColor();this.backColor=n.Song.defaultSwatch.getHex();this.mutedColor=n.Song.defaultSwatch.getHex();this.textShadowColor=n.Song.defaultSwatch.getBodyTextColor();this.allAlbumSwatches=[];t.getAll().then(function(n){return e.allArtists=n.items})}return t.prototype.chooseSongs=function(){var i=this,n;filepicker.setKey(t.filePickerKey);n={extension:".mp3"};filepicker.pickMultiple(n,function(n){return i.songsChosen(n)},function(n){return console.log("Upload failed.",n)})},t.prototype.songsChosen=function(n){var i=this;n.forEach(function(n){n.trustedUrl=i.$sce.trustAsResourceUrl(n.url);n.friendlyName=t.songNameFromFileName(n.filename)});n.sort(function(n,t){return n.filename<t.filename?-1:n.filename>t.filename?1:0});this.songs=this.songs.concat(n);this.$scope.$applyAsync()},t.prototype.chooseAlbumArt=function(){var i=this,n;filepicker.setKey(t.filePickerKey);n={extensions:[".jpg",".png"]};filepicker.pick(n,function(n){return i.albumArtChosen(n)},function(n){return console.log("Album art pick failed.",n)})},t.prototype.albumArtChosen=function(n){this.albumArt=n;this.fetchAlbumColorSwatches(n);this.$scope.$applyAsync()},t.prototype.fetchAlbumColorSwatches=function(i){var r=this,u;i.url&&(u=document.createElement("img"),u.src="/api/albums/imageOnDomain?imageUrl="+encodeURIComponent(i.url),u.addEventListener("load",function(){var f=new Vibrant(u,64,5),i=f.swatches();i&&(r.allAlbumSwatches=t.getFriendlySwatches(i),r.backColor=(i.DarkVibrant||i.DarkMuted||n.Song.defaultSwatch).getHex(),r.foreColor=(i.LightVibrant||i.Vibrant||n.Song.defaultSwatch).getHex(),r.mutedColor=(i.DarkMuted||i.DarkVibrant||i.Vibrant||n.Song.defaultSwatch).getBodyTextColor(),r.textShadowColor=(i.DarkMuted||i.DarkVibrant||n.Song.defaultSwatch).getHex(),r.$scope.$applyAsync())}))},t.prototype.moveSongUp=function(n){var t=this.songs.indexOf(n),i;t>0&&(i=t-1,this.songs.splice(t,1),this.songs.splice(i,0,n))},t.prototype.moveSongDown=function(n){var t=this.songs.indexOf(n),i;t<this.songs.length-1&&(i=t+1,this.songs.splice(t,1),this.songs.splice(i,0,n))},t.prototype.removeSong=function(n){var t=this.songs.indexOf(n);t>=0&&this.songs.splice(t,1)},t.songNameFromFileName=function(n){var t=n,r=t.lastIndexOf("."),i;return r>0&&(t=t.substring(0,r)),i=t.lastIndexOf(" - "),i>=0&&(t=t.substr(i+3)),t},t.filePickerSongToAlbumSong=function(n){return{fileName:n.friendlyName,address:n.url}},t.getFriendlySwatches=function(n){return Object.getOwnPropertyNames(n).filter(function(t){return!!n[t]}).map(function(t){var i=n[t];return{name:t,color:i.getHex(),titleTextColor:i.getTitleTextColor(),bodyTextColor:i.getBodyTextColor()}})},t.prototype.hexToRgbString=function(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t&&t.length>=4?"rgb("+parseInt(t[1],16)+", "+parseInt(t[2],16)+", "+parseInt(t[3],16)+")":""},t.prototype.artistSelected=function(n){this.artist=angular.copy(n)},t.prototype.upload=function(){var i=this,n;if(!this.albumArt||!this.albumArt.url)throw new Error("Must have album art.");if(!this.albumName)throw new Error("Must have album name.");if(!this.artist)throw new Error("Must have an artist");this.isUploading||(n={albumArtUri:this.albumArt.url,artist:this.artist.name,backColor:this.backColor,foreColor:this.foreColor,genres:this.genre,mutedColor:this.mutedColor,name:this.albumName,purchaseUrl:this.purchaseUrl,songs:this.songs?this.songs.map(t.filePickerSongToAlbumSong):[],textShadowColor:this.textShadowColor},this.isUploading=!0,this.albumApi.upload(n).then(function(){return i.appNav.editAlbum(n.artist,n.name)}).finally(function(){return i.isUploading=!1}))},t.filePickerKey="AwdRIarCGT8COm0mkYX1Ez",t.$inject=["artistApi","albumApi","appNav","$scope","$sce",],t}();n.UploadAlbumController=t;n.App.controller("UploadAlbumController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={}));