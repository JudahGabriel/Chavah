var BitShuva;(function(n){var t;(function(n){"use strict";function i(n,t){return t===void 0&&(t=!1),{templateUrl:n,isAdmin:t}}var r,u,t;n.App=angular.module("ChavahApp",["ngRoute","ngAnimate","ui.bootstrap","ui.bootstrap.tpls","LocalStorageModule"]);r=window["BitShuva.Chavah.InitConfig"];n.App.constant("initConfig",r);u={artistList:"/App/Views/Templates/ArtistList.html",songList:"/App/Views/Templates/SongList.html",songRequestModal:"/App/Views/RequestSongModal.html",songRequestResult:"/App/Views/Templates/SongRequestResult.html",headerPartial:"/App/Views/Header.html",footerPartial:"/App/Views/Footer.html",adminSidebar:"/App/Views/Templates/AdminSidebar.html",goBack:"/App/Views/Templates/GoBack.html"};n.App.constant("templatePaths",u);t={nowPlaying:"/App/Views/NowPlaying.html",trending:"/App/Views/Trending.html",profile:"/App/Views/Profile.html",popular:"/App/Views/Popular.html",recent:"/App/Views/RecentSongs.html",myLikes:"/App/Views/MyLikes.html",editSong:"/App/Views/EditSong.html",shareThanks:"/App/Views/ShareThanks.html",about:"/App/Views/Legal.html",welcome:"/App/Views/Welcome.html",songEditApproved:"/App/Views/SongEditApproved.html",promptSignIn:"/App/Views/PromptSignIn.html",signIn:"/App/Views/SignIn.html",password:"/App/Views/Password.html",forgotPassword:"/App/Views/ForgotPassword.html",createPassword:"/App/Views/CreatePassword.html",register:"/App/Views/Register.html",confirmEmail:"/App/Views/ConfirmEmail.html",resetPassword:"/App/Views/ResetPassword.html",donate:"/App/Views/Donate.html",donateSuccess:"/App/Views/DonateSuccess.html",donateCancelled:"/App/Views/DonateCancelled.html",albums:"/App/Views/Albums.html",uploadAlbum:"/App/Views/UploadAlbum.html",createAlbum:"/App/Views/EditAlbum.html",editAlbum:"/App/Views/EditAlbum.html",editArtist:"/App/Views/EditArtist.html",songEdits:"/App/Views/ApproveSongEdits.html",tags:"/App/Views/TagEditor.html",logs:"/App/Views/LogEditor.html"};n.App.config(["$routeProvider","$locationProvider",function(n,r){n.caseInsensitiveMatch=!0;r.hashPrefix("");n.when("/",i(t.nowPlaying)).when("/nowplaying",i(t.nowPlaying)).when("/trending",i(t.trending)).when("/profile",i(t.profile)).when("/popular",i(t.popular)).when("/recent",i(t.recent)).when("/mylikes",i(t.myLikes)).when("/edit/songs/:id",i(t.editSong)).when("/sharethanks/:artist?",i(t.shareThanks)).when("/about",i(t.about)).when("/welcome",i(t.welcome)).when("/songeditapproved/:artist/:songName",i(t.songEditApproved)).when("/promptsignin",i(t.promptSignIn)).when("/signin",i(t.signIn)).when("/password/:email",i(t.password)).when("/forgotpassword",i(t.forgotPassword)).when("/createpassword/:email",i(t.createPassword)).when("/register/:email?",i(t.register)).when("/confirmemail/:email/:confirmCode",i(t.confirmEmail)).when("/resetpassword/:email/:confirmCode",i(t.resetPassword)).when("/donate/:artist?",i(t.donate)).when("/donatesuccess",i(t.donateSuccess)).when("/donatecancelled",i(t.donateCancelled)).when("/admin",i(t.albums,!0)).when("/admin/albums",i(t.albums,!0)).when("/admin/album/upload",i(t.uploadAlbum,!0)).when("/admin/album/create",i(t.createAlbum,!0)).when("/admin/album/:artist/:album",i(t.editAlbum,!0)).when("/admin/artists/:artistName?",i(t.editArtist,!0)).when("/admin/songedits",i(t.songEdits,!0)).when("/admin/tags",i(t.tags,!0)).when("/admin/logs",i(t.logs,!0)).otherwise({redirectTo:"/nowplaying"})}]);n.App.run(["templatePaths","accountApi","appNav","adminScripts","$rootScope","$location","$q",function(n,t,i,r,u,f,e){window.Promise=e;u.Partials=n;$(".splash").remove();u.$on("$routeChangeSuccess",function(){var n=window.ga;n&&n("send","pageview",f.path())});u.$on("$routeChangeStart",function(n,u){var f=u.$$route;f&&f.isAdmin&&(r.install(),t.isSignedIn||i.signIn())})}]);document.addEventListener("DOMContentLoaded",function(){return FastClick.attach(document.body)},!1)})(t=n.Chavah||(n.Chavah={}))})(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r,u){if(this.appNav=t,this.initConfig=i,this.httpApi=r,this.localStorageService=u,this.signedIn=new Rx.BehaviorSubject(!1),this.initConfig.userEmail){this.currentUser=new n.User(this.initConfig.userEmail,this.initConfig.userRoles);this.setAuthLocalStorage(this.initConfig.jwt);this.signedIn.onNext(!0)}}return Object.defineProperty(t.prototype,"hasSignedInOnThisDevice",{get:function(){return this.localStorageService.get(t.hasSignedInKey)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSignedIn",{get:function(){return!!this.currentUser},enumerable:!0,configurable:!0}),t.prototype.signOut=function(){var n=this,t=this.httpApi.post("/api/Accounts/SignOut",null);return t.then(function(){n.currentUser=null;n.setAuthLocalStorage(null);n.signedIn.onNext(!1)}),t},t.prototype.clearNotifications=function(){return this.httpApi.post("/api/accounts/clearNotifications",null)},t.prototype.register=function(n,t){var i=encodeURIComponent(n),r=encodeURIComponent(t);return this.httpApi.post("/api/Accounts/Register?email="+i+"&password="+r,null)},t.prototype.getUserWithEmail=function(n){var t={email:n};return this.httpApi.query("/api/Accounts/GetUserWithEmail",t)},t.prototype.createPassword=function(n,t){var i=encodeURIComponent(n),r=encodeURIComponent(t);return this.httpApi.post("/api/Accounts/CreatePassword?email="+i+"&password="+r,null)},t.prototype.signIn=function(t,i,r){var u=this,e=encodeURIComponent(t),o=encodeURIComponent(i),f=this.httpApi.post("/api/Accounts/SignIn?email="+e+"&password="+o+"&staySignedIn="+r,null);return f.then(function(t){if(t.status===n.SignInStatus.Success){u.setAuthLocalStorage(t.jsonWebToken);u.currentUser=new n.User(t.email,t.roles);u.signedIn.onNext(!0);var i=window.ga;i&&i("set","userId",t.email)}else{u.setAuthLocalStorage(t.jsonWebToken);u.currentUser=null;u.signedIn.onNext(!1)}}),f},t.prototype.confirmEmail=function(n,t){var i=encodeURIComponent(n),r=encodeURIComponent(t);return this.httpApi.post("/api/Accounts/ConfirmEmail?email="+i+"&confirmCode="+r,null)},t.prototype.sendPasswordResetEmail=function(n){return this.httpApi.post("/api/Accounts/SendResetPasswordEmail?email="+encodeURIComponent(n),null)},t.prototype.resetPassword=function(n,t,i){var r=encodeURIComponent(n),u=encodeURIComponent(t),f=encodeURIComponent(i);return this.httpApi.post("/api/Accounts/ResetPassword?email="+r+"&passwordResetCode="+u+"&newPassword="+f,null)},t.prototype.setAuthLocalStorage=function(n){this.localStorageService.set(t.jwtKey,n);n&&this.localStorageService.set(t.hasSignedInKey,!0)},t}();t.hasSignedInKey="hasSignedInSuccessfully";t.jwtKey="jwt";t.$inject=["appNav","initConfig","httpApi","localStorageService"];n.AccountService=t;n.App.service("accountApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(){this.hasInstalled=!1}return n.prototype.install=function(){if(!this.hasInstalled){this.hasInstalled=!0;["https://api.filepicker.io/v1/filepicker.js","https://cdnjs.cloudflare.com/ajax/libs/vibrant.js/1.0.0/Vibrant.min.js"].forEach(function(n){var t=document.createElement("script");t.type="text/javascript";t.src=n;document.body.appendChild(t)})}},n}();n.AdminScriptsService=t;n.App.service("adminScripts",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t){this.httpApi=n;this.$q=t}return t.prototype.upload=function(n){return this.httpApi.post("/api/albums/upload",n)},t.prototype.changeArt=function(n,i){var r={albumId:n,artUri:i};return this.httpApi.postUriEncoded("/api/albums/changeArt",r,t.albumSelector)},t.prototype.get=function(n){var i={id:n};return this.httpApi.query("/api/albums/get",i,t.albumSelector)},t.prototype.getAll=function(n,i,r){var u={skip:n,take:i,search:r};return this.httpApi.query("/api/albums/getAll",u,t.albumPagedListSelector)},t.prototype.getByArtistAndAlbumName=function(n,i){var r={artist:n,album:i};return this.httpApi.query("/api/albums/getByArtistAlbum",r,t.albumSelector)},t.prototype.save=function(n){return this.httpApi.post("/api/albums/save",n,t.albumSelector)},t.prototype.getAlbums=function(n){var i={albumIdsCsv:n.join(",")};return this.httpApi.query("/api/albums/getAlbums",i,t.albumArraySelector)},t.prototype.deleteAlbum=function(n){var t={albumId:n};return this.httpApi.postUriEncoded("/api/albums/delete",t)},t.albumSelector=function(t){return t?new n.Album(t):null},t.albumArraySelector=function(n){return n.map(function(n){return t.albumSelector(n)})},t.albumPagedListSelector=function(n){return{items:t.albumArraySelector(n.items),skip:n.skip,take:n.take,total:n.total}},t}();t.$inject=["httpApi","$q"];n.AlbumApiService=t;n.App.service("albumApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t){this.albumApi=n;this.$q=t;this.cache=[]}return t.prototype.getAlbumsForSongs=function(n){var e=this,i,o,f;t.hasAttemptedRehydratedCache||(i=t.tryRehydrateCache(),i&&(this.cache=i));var r=[],u=[],s=_.uniq(n.filter(function(n){return!!n.albumId}).map(function(n){return n.albumId}));return(s.forEach(function(n){var t=e.getCachedAlbum(n);t?u.push(t):r.push(n)}),o=r.length===0,o)?this.$q.resolve(u):(f=this.$q.defer(),this.albumApi.getAlbums(_.uniq(r)).then(function(n){e.addToCache(n);f.resolve(u.concat(n))}),f.promise)},t.prototype.getCachedAlbum=function(n){var t=n.toLowerCase();return this.cache.find(function(n){return n.id.toLowerCase()===t})},t.prototype.addToCache=function(n){var r=this,u=n.filter(function(n){return!r.cache.some(function(t){return t.id===n.id})}),i;(i=this.cache).push.apply(i,u);t.tryStoreCacheInLocalStorage(this.cache)},t.tryStoreCacheInLocalStorage=function(n){try{var i=JSON.stringify(n);localStorage.setItem(t.cacheKey,i)}catch(r){console.log("Unable to save album cache to local storage.")}},t.tryRehydrateCache=function(){var i,r;t.hasAttemptedRehydratedCache=!0;try{if(i=localStorage.getItem(t.cacheKey),i&&(r=JSON.parse(i),r))return r.map(function(t){return new n.Album(t)})}catch(u){console.log("Unable to rehydrate album art cache.",u)}return null},t}();t.cacheKey="album-art-cache";t.hasAttemptedRehydratedCache=!1;t.$inject=["albumApi","$q"];n.AlbumCacheService=t;n.App.service("albumCache",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){var u=this;this.audioPlayer=n;this.templatePaths=t;this.$location=i;this.$uibModal=r;this.promptSignInUrl="#/promptsignin";n.song.subscribe(function(n){return u.updateDocumentTitle(n)})}return n.prototype.signIn=function(){this.$location.url("/signin")},n.prototype.nowPlaying=function(){this.$location.url("/nowplaying")},n.prototype.promptSignIn=function(){this.$location.url(this.promptSignInUrl.replace("#",""))},n.prototype.register=function(n){n?this.$location.url("/register/"+encodeURIComponent(n)):this.$location.url("/register")},n.prototype.createPassword=function(n){this.$location.url("/createpassword/"+encodeURIComponent(n))},n.prototype.password=function(n){this.$location.url("/password/"+encodeURIComponent(n))},n.prototype.editAlbumById=function(n){this.$location.url("/admin/album/"+n)},n.prototype.editAlbum=function(n,t){var i=encodeURIComponent(n),r=encodeURIComponent(t);this.$location.url("/admin/album/"+i+"/"+r)},n.prototype.getEditSongUrl=function(n){return"/edit/"+n},n.prototype.showSongRequestDialog=function(){return this.$uibModal.open({controller:"RequestSongController as vm",templateUrl:this.templatePaths.songRequestModal,windowClass:"request-song-modal"})},n.prototype.createAlbum=function(){this.$location.url("/admin/album/create")},n.prototype.getQueryParams=function(){return this.$location.search()},n.prototype.updateDocumentTitle=function(n){document.title=n?n.name+" by "+n.artist+" on Chavah Messianic Radio":"Chavah Messianic Radio"},n}();t.$inject=["audioPlayer","templatePaths","$location","$uibModal"];n.AppNavService=t;n.App.service("appNav",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.httpApi=n}return t.prototype.getAll=function(n,t,i){n===void 0&&(n="");t===void 0&&(t=0);i===void 0&&(i=1024);var r={search:n,skip:t,take:i};return this.httpApi.query("/api/artists/all",r)},t.prototype.getByName=function(n){var i={artistName:n};return this.httpApi.query("/api/artists/getByName",i,t.artistSelector)},t.prototype.save=function(n){return this.httpApi.post("/api/artists/save",n,t.artistSelector)},t.artistSelector=function(t){return new n.Artist(t)},t}();t.$inject=["httpApi"];n.ArtistApiService=t;n.App.service("artistApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t){this.songApi=t;this.status=new Rx.BehaviorSubject(n.AudioStatus.Paused);this.song=new Rx.BehaviorSubject(null);this.songCompleted=new Rx.BehaviorSubject(null);this.playedTimeText=new Rx.BehaviorSubject("");this.remainingTimeText=new Rx.BehaviorSubject("");this.playedTimePercentage=new Rx.BehaviorSubject(0);this.duration=new Rx.BehaviorSubject(0);this.playedSongs=[];this.audioErrors=new Rx.Subject;this.lastPlayedTime=0}return t.prototype.initialize=function(t){var i=this,r=Modernizr.audio.mp3;r&&(this.audio=t,this.audio.addEventListener("ended",function(){return i.ended()}),this.audio.addEventListener("error",function(n){return i.erred(n)}),this.audio.addEventListener("pause",function(){return i.status.onNext(n.AudioStatus.Paused)}),this.audio.addEventListener("play",function(){return i.status.onNext(n.AudioStatus.Playing)}),this.audio.addEventListener("playing",function(){return i.status.onNext(n.AudioStatus.Playing)}),this.audio.addEventListener("waiting",function(){return i.status.onNext(n.AudioStatus.Buffering)}),this.audio.addEventListener("stalled",function(n){return i.stalled(n)}),this.audio.addEventListener("timeupdate",function(n){return i.playbackPositionChanged(n)}))},t.prototype.playNewSong=function(n){var t=this.song.getValue();t&&(this.playedSongs.unshift(t),this.playedSongs.length>3&&(this.playedSongs.length=3));this.song.onNext(n);this.playNewUri(n.uri)},t.prototype.playNewUri=function(n){if(this.audio&&(this.audio.src="",n)){this.audio.src=n;this.audio.load();try{this.audio.play()}catch(t){console.log("Unable to play audio",t)}}},t.prototype.playSongById=function(n){var t=this.songApi.getSongById(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongFromArtistAndAlbum=function(n,t){var i=this.songApi.getSongByArtistAndAlbum(n,t);this.playSongWhenFinishedLoading(i)},t.prototype.playSongFromArtist=function(n){var t=this.songApi.getSongByArtist(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongFromAlbum=function(n){var t=this.songApi.getSongByAlbum(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongWithTag=function(n){var t=this.songApi.getSongWithTag(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongWhenFinishedLoading=function(n){var t=this,i=this.song.getValue();this.pause();n.then(function(n){var r=t.song.getValue()===i;r&&(n?t.playNewSong(n):t.resume())})},t.prototype.pauseSongById=function(n){var t=this;this.pause();this.songApi.getSongById(n).then(function(n){if(!n){t.resume();return}var i=t.song.getValue();i&&t.playedSongs.unshift(i);t.song.onNext(n);t.audio&&(t.audio.src=n.uri,t.audio.load(),t.audio.pause())})},t.prototype.resume=function(){this.audio&&this.audio.play()},t.prototype.pause=function(){this.audio&&this.audio.pause()},t.prototype.aborted=function(t){this.status.onNext(n.AudioStatus.Aborted);console.log("Audio aborted",this.audio.currentSrc,t)},t.prototype.erred=function(t){this.status.onNext(n.AudioStatus.Erred);console.log("Audio erred. Error code: ",this.audio.error,"Audio source: ",this.audio.currentSrc,"Error event: ",t);var i=this.song.getValue();this.audioErrors.onNext({errorCode:this.audio.error,songId:i?i.id:"",trackPosition:this.audio.currentTime})},t.prototype.ended=function(){var t=this.song.getValue();if(this.audio&&t&&this.audio.src===encodeURI(t.uri))this.songCompleted.onNext(t);this.status.onNext(n.AudioStatus.Ended)},t.prototype.stalled=function(t){this.status.onNext(n.AudioStatus.Stalled);console.log("Audio stalled, unable to stream in audio data.",this.audio.currentSrc,t)},t.prototype.playbackPositionChanged=function(){var i=this.audio.currentTime,n=Math.floor(i),r=n!==this.lastPlayedTime,t;if(r){this.lastPlayedTime=n;t=this.audio.duration;this.duration.onNext(t);var u=(new Date).setMinutes(0,n),f=moment(u),e=(new Date).setMinutes(0,t-n),o=moment(e);this.playedTimeText.onNext(f.format("m:ss"));this.remainingTimeText.onNext(o.format("m:ss"));this.playedTimePercentage.onNext(100/t*n)}},t.prototype.submitAudioError=function(n){this.songApi.songFailed(n)},t}();t.$inject=["songApi"];n.AudioPlayerService=t;n.App.service("audioPlayer",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r){this.loadingProgress=n;this.$http=t;this.localStorageService=i;this.$q=r;this.apiBaseUrl=""}return t.prototype.query=function(n,t,i,r){var e=this,u,f;return t===void 0&&(t=null),r===void 0&&(r=!0),u=r?this.loadingProgress.start():this.$q.defer(),f={url:this.apiBaseUrl+n,method:"GET",params:t,headers:this.createHeaders()},this.$http(f).then(function(n){var t=i?i(n.data):n.data;u.resolve(t)},function(t){u.reject(t);e.onAjaxError(t,"Error loading "+n+".")}),u.promise},t.prototype.post=function(n,t,i,r){var e=this,u;r===void 0&&(r=!0);u=r?this.loadingProgress.start():this.$q.defer();var o=""+this.apiBaseUrl+n,s={headers:this.createHeaders()},f=this.$http.post(o,t,s);return f.then(function(n){var t=i?i(n.data):n.data;u.resolve(t)}),f.catch(function(t){e.onAjaxError(t,"Error saving "+n+".");u.reject(t)}),u.promise},t.prototype.postUriEncoded=function(n,t,i,r){var l=this,f,u,s,e,h,o;r===void 0&&(r=!0);f=r?this.loadingProgress.start():this.$q.defer();u=""+this.apiBaseUrl+n+"?";s={headers:this.createHeaders()};for(e in t){h=u.endsWith("?");u+=h?"":"&";var c=t[e],a=c?c.toString():"",v=encodeURIComponent(a);u+=e+"="+v}return o=this.$http.post(u,null,s),o.then(function(n){var t=i?i(n.data):n.data;f.resolve(t)}),o.catch(function(t){l.onAjaxError(t,"Error saving "+n+".");f.reject(t)}),f.promise},t.prototype.createHeaders=function(){var n=this.createJwtAuthHeader();return n?{Authorization:n}:{}},t.prototype.createJwtAuthHeader=function(){var t=this.localStorageService.get(n.AccountService.jwtKey);return t?"Bearer "+t:""},t.prototype.onAjaxError=function(){},t}();t.$inject=["loadingProgress","$http","localStorageService","$q"];n.HttpApiService=t;n.App.service("httpApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.dislikeSong=function(n){return this.httpApi.post("/api/likes/dislike?songId="+n,null)},n.prototype.likeSong=function(n){return this.httpApi.post("/api/likes/like?songId="+n,null)},n}();t.$inject=["httpApi"];n.LikeApiService=t;n.App.service("likeApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.$q=n;this.resultsInProgress=0}return n.prototype.start=function(){var t=this,n=this.$q.defer();return this.loadingStarted(),n.promise.finally(function(){return t.loadingEnded()}),n},Object.defineProperty(n.prototype,"isLoading",{get:function(){return this.resultsInProgress>0},enumerable:!0,configurable:!0}),n.prototype.loadingStarted=function(){this.resultsInProgress++;this.resultsInProgress===1&&NProgress.start()},n.prototype.loadingEnded=function(){this.resultsInProgress--;this.resultsInProgress===0&&NProgress.done()},n}();t.$inject=["$q"];n.LoadingProgressService=t;n.App.service("loadingProgress",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.getAll=function(n,t){var i={skip:n,take:t};return this.httpApi.query("/api/logs/getAll",i)},n.prototype.deleteLog=function(n){var t={id:n};return this.httpApi.postUriEncoded("/api/logs/delete",t)},n}();t.$inject=["httpApi"];n.LogService=t;n.App.service("logApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.httpApi=n}return t.prototype.chooseSong=function(){return this.httpApi.query("/api/songs/chooseSong",null,t.songConverter)},t.prototype.chooseSongBatch=function(){return this.httpApi.query("/api/songs/chooseSongBatch",null,t.songListConverter)},t.prototype.getSongById=function(n,i){var r=this.httpApi.query("/api/songs/getById",{songId:n},t.songOrNullConverter);return i!=null&&r.then(function(n){n&&n.setSolePickReason(i)}),r},t.prototype.getSongByArtistAndAlbum=function(n,i){var r={artist:n,album:i};return this.httpApi.query("/api/songs/getByArtistAndAlbum",r,t.songOrNullConverter)},t.prototype.getSongByAlbum=function(n){var i={album:n};return this.httpApi.query("/api/songs/getByAlbum/",i,t.songOrNullConverter)},t.prototype.getSongWithTag=function(n){var i={tag:n};return this.httpApi.query("/api/songs/getByTag",i,t.songOrNullConverter)},t.prototype.getSongByArtist=function(n){var i={artist:n};return this.httpApi.query("/api/songs/getByArtist",i,t.songOrNullConverter)},t.prototype.getSongMatches=function(n){var i={searchText:n};return this.httpApi.query("/api/songs/search",i,t.songListConverter)},t.prototype.getTrendingSongs=function(n,i){var r={skip:n,take:i};return this.httpApi.query("/api/songs/getTrending",r,t.songPagedListConverter)},t.prototype.getPopularSongs=function(n){var i={count:n};return this.httpApi.query("/api/songs/top",i,t.songListConverter)},t.prototype.getLikes=function(n){var i={count:n};return this.httpApi.query("/api/songs/getRandomLikedSongs",i,t.songListConverter)},t.prototype.getRecentPlays=function(n){var i={count:n};return this.httpApi.query("/api/songs/getRecentPlays",i,t.songListConverter)},t.prototype.songCompleted=function(n){return this.httpApi.post("/api/songs/completed?songId="+n,null)},t.prototype.songFailed=function(n){return this.httpApi.post("/api/songs/audiofailed",n)},t.songPagedListConverter=function(t){return{items:t.items.map(function(t){return new n.Song(t)}),skip:t.skip,take:t.take,total:t.total}},t.songListConverter=function(n){return n.map(function(n){return t.songConverter(n)})},t.songOrNullConverter=function(n){return n?t.songConverter(n):null},t.songConverter=function(t){return new n.Song(t)},t}();t.$inject=["httpApi"];n.SongApiService=t;n.App.service("songApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){var u=this;this.audioPlayer=n;this.songApi=t;this.songRequestApi=i;this.accountApi=r;this.songsBatch=new Rx.BehaviorSubject([]);r.signedIn.distinctUntilChanged().subscribe(function(n){return u.signedInChanged(n)})}return n.prototype.playNext=function(){var n=this,t,i;if(this.songsBatch.getValue().length>0){t=this.songsBatch.getValue().splice(0,1)[0];this.songsBatch.onNext(this.songsBatch.getValue());this.audioPlayer.playNewSong(t)}else this.songApi.chooseSong().then(function(t){n.audioPlayer.playNewSong(t);n.fetchSongBatch()});i=this.songsBatch.getValue().length<5;i&&this.fetchSongBatch()},n.prototype.fetchSongBatch=function(){var n=this;this.songApi.chooseSongBatch().then(function(t){var i=n.songsBatch.getValue(),r=t.filter(function(n){return i.map(function(n){return n.id}).indexOf(n.id)===-1}).filter(function(t){return!n.songRequestApi.isSongPendingRequest(t.id)});n.songsBatch.onNext(i.concat(r))})},n.prototype.signedInChanged=function(n){var t=this.songsBatch.getValue().length>0;if(n&&t){this.songsBatch.onNext([]);this.fetchSongBatch()}},n}();t.$inject=["audioPlayer","songApi","songRequestApi","accountApi"];n.SongBatchService=t;n.App.service("songBatch",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.submit=function(n){return this.httpApi.post("/api/songEdits/edit",n)},n.prototype.getPendingEdits=function(n){var t={take:n};return this.httpApi.query("/api/songEdits/getPendingEdits",t)},n.prototype.approve=function(n){return this.httpApi.post("/api/songEdits/approve",n)},n.prototype.reject=function(n){var t={songEditId:n};return this.httpApi.postUriEncoded("/api/songEdits/reject",t)},n}();t.$inject=["httpApi"];n.SongEditService=t;n.App.service("songEditApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i){this.httpApi=n;this.audioPlayer=t;this.songApi=i;this.pendingSongRequestIds=[];this.hasPlayedRequestAnnouncement=!1}return t.prototype.hasPendingRequest=function(){var n=this,t=this.pendingSongRequestIds.length>0;return this.pendingSongRequestIds.length===0&&setTimeout(function(){return n.fetchPendingSongRequests()},2e3),t},t.prototype.isSongPendingRequest=function(n){return this.pendingSongRequestIds.indexOf(n)!==-1},t.prototype.requestSong=function(n){this.pendingSongRequestIds.unshift(n.id);this.hasPlayedRequestAnnouncement=!1;var t="/api/requests/requestsong?songId="+n.id;return this.httpApi.post(t,null)},t.prototype.playRequest=function(){var t=this,r,u;if(!this.hasPendingRequest())throw"There was no pending song request.";if(this.hasPlayedRequestAnnouncement)this.hasPlayedRequestAnnouncement=!1,r=this.pendingSongRequestIds.splice(0,1)[0],u=this.audioPlayer.song.getValue(),this.songApi.getSongById(r,n.SongPick.SomeoneRequestedSong).then(function(n){var i=t.audioPlayer.song.getValue()===u;i&&n&&t.audioPlayer.playNewSong(n)});else{this.hasPlayedRequestAnnouncement=!0;var i=[1,3,4,5,6,7,8,9,10],f="SongRequest"+i[Math.floor(Math.random()*i.length)]+".mp3",e="https://bitshuvafiles01.com/chavah/soundEffects/"+f;this.audioPlayer.playNewUri(e)}},t.prototype.removePendingSongRequest=function(n){this.pendingSongRequestIds=this.pendingSongRequestIds.filter(function(t){return t!==n})},t.prototype.fetchPendingSongRequests=function(){var n=this;return this.httpApi.query("/api/requests/pending").then(function(t){t&&n.pendingSongRequestIds.indexOf(t)===-1&&n.pendingSongRequestIds.push(t)})},t}();t.$inject=["httpApi","audioPlayer","songApi"];n.SongRequestApiService=t;n.App.service("songRequestApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.audioPlayer=n;this.lastAnnouncementTime=new Date}return n.prototype.hasPendingAnnouncement=function(){var t=new Date,n=t.getMinutes(),i=n>55||n<5||n>25&&n<35,r=(t.valueOf()-this.lastAnnouncementTime.valueOf())/6e4,u=r>=15;return u&&i?(this.lastAnnouncementTime=t,!0):!1},n.prototype.playStationIdAnnouncement=function(){var n=[1,2,3,4,5,6],t="StationId"+n[Math.floor(Math.random()*n.length)]+".mp3",i="https://bitshuvafiles01.com/chavah/soundEffects/"+t;this.audioPlayer.playNewUri(i)},n}();t.$inject=["audioPlayer"];n.StationIdentifierService=t;n.App.service("stationIdentifier",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.getAll=function(){return this.httpApi.query("/api/tags/getAll")},n.prototype.renameTag=function(n,t){var i={oldTag:n,newTag:t};return this.httpApi.postUriEncoded("/api/tags/rename",i)},n.prototype.deleteTag=function(n){var t={tag:n};return this.httpApi.postUriEncoded("/api/tags/delete",t)},n.prototype.searchTags=function(n){var t={search:n};return this.httpApi.query("/api/tags/searchTags",t)},n}();t.$inject=["httpApi"];n.TagService=t;n.App.service("tagApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={}));Array.prototype.includes||(Array.prototype.includes=function(n){"use strict";var f=Object(this),u=parseInt(f.length)||0,i,t,r;if(u===0)return!1;for(i=parseInt(arguments[1])||0,i>=0?t=i:(t=u+i,t<0&&(t=0));t<u;){if(r=f[t],n===r||n!==n&&r!==r)return!0;t++}return!1});Array.prototype.find||(Array.prototype.find=function(n){var t;if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof n!="function")throw new TypeError("predicate must be a function");var i=Object(this),u=i.length>>>0,f=arguments[1],r;for(t=0;t<u;t++)if(r=i[t],n.call(f,r,t,i))return r;return undefined});String.prototype.includes||(String.prototype.includes=function(){"use strict";return String.prototype.indexOf.apply(this,arguments)!==-1});String.prototype.endsWith||(String.prototype.endsWith=function(n,t){var i=this.toString(),r;return(t===undefined||t>i.length)&&(t=i.length),t!==undefined&&t!==null&&(t-=n.length),r=i.indexOf(n,t),r!==-1&&r===t});String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return t=t||0,this.lastIndexOf(n,t)===t}),function(n){var t;(function(n){var t=function(){function n(n){this.isSaving=!1;angular.merge(this,n)}return n}();n.Album=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(t){this.isSaving=!1;t||(t=n.createDefaultServerObj());angular.merge(this,t)}return n.prototype.updateFrom=function(n){angular.merge(this,n)},n.createDefaultServerObj=function(){return{bio:"",images:[],name:""}},n}();n.Artist=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Paused=0]="Paused";n[n.Playing=1]="Playing";n[n.Ended=2]="Ended";n[n.Erred=3]="Erred";n[n.Stalled=4]="Stalled";n[n.Buffering=5]="Buffering";n[n.Aborted=6]="Aborted"})(t=n.AudioStatus||(n.AudioStatus={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Normal=0]="Normal";n[n.VeryPoor=1]="VeryPoor";n[n.Poor=2]="Poor";n[n.Good=3]="Good";n[n.Great=4]="Great";n[n.Best=5]="Best"})(t=n.CommunityRankStanding||(n.CommunityRankStanding={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.NowPlaying=0]="NowPlaying";n[n.Trending=1]="Trending";n[n.Top=2]="Top";n[n.Likes=3]="Likes";n[n.Other=4]="Other"})(t=n.HeaderRoute||(n.HeaderRoute={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.NotSpecified=0]="NotSpecified";n[n.Like=1]="Like";n[n.Love=2]="Love";n[n.Favorite=3]="Favorite"})(t=n.LikeLevel||(n.LikeLevel={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Error=0]="Error";n[n.Warn=1]="Warn";n[n.Info=2]="Info";n[n.Debug=3]="Debug"})(t=n.LogLevel||(n.LogLevel={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(){}return n}();n.SignInResult=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Success=0]="Success";n[n.LockedOut=1]="LockedOut";n[n.RequiresVerification=2]="RequiresVerification";n[n.Failure=3]="Failure"})(t=n.SignInStatus||(n.SignInStatus={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.albumArtOrArtistImage="";this.isCumulativeRank=!0;this.albumSwatchBackground="white";this.albumSwatchForeground="black";this.albumSwatchMuted="silver";this.albumSwatchTextShadow="white";this.albumSwatchDarker="black";this.albumSwatchLighter="white";this.hasSetAlbumArtColors=!1;this.isLyricsExpanded=!1;this.isSongStatusExpanded=!1;this.isSupportExpanded=!1;this.isShareExpanded=!1;this.isEditingLyrics=!1;this.isShowingEmbedCode=!1;angular.merge(this,n);this.clientId=n.id+"_"+((new Date).getTime()+Math.random())}return Object.defineProperty(t.prototype,"communityRankText",{get:function(){return this.communityRank>0?"+"+this.communityRank.toString():this.communityRank.toString()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"communityRankStandingText",{get:function(){switch(this.communityRankStanding){case n.CommunityRankStanding.Best:return"Best";case n.CommunityRankStanding.Good:return"Good";case n.CommunityRankStanding.Great:return"Great";case n.CommunityRankStanding.Poor:return"Poor";case n.CommunityRankStanding.VeryPoor:return"Very Poor";case n.CommunityRankStanding.Normal:default:return"Average"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nthSongText",{get:function(){return this.number===0?"1st":this.number===1?"1st":this.number===2?"2nd":this.number===3?"3rd":this.number>=4&&this.number<=19?this.number+"th":"#"+this.number},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reasonPlayedText",{get:function(){return this._reasonPlayedText||(this._reasonPlayedText=this.createReasonPlayedText()),this._reasonPlayedText},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"facebookShareUrl",{get:function(){if(!this._facebookShareUrl){var n=(this.artist+" - "+this.name).replace(new RegExp("&","g"),"and"),t="https://messianicradio.com?song="+this.id,i="https://messianicradio.com/api/albums/art/forSong?songId="+this.id;this._facebookShareUrl="https://www.facebook.com/dialog/feed?app_id=256833604430846&link="+t+("&picture="+encodeURIComponent(i))+("&name="+encodeURIComponent(n))+("&description="+encodeURIComponent("On "+this.album))+("&caption="+encodeURIComponent("Courtesy of Chavah Messianic Radio - The very best Messianic Jewish and Hebrew Roots music"))+("&redirect_uri="+encodeURIComponent("https://messianicradio.com/#/sharethanks"))}return this._facebookShareUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"twitterShareUrl",{get:function(){if(!this._twitterShareUrl){var n='Listening to "'+this.artist+" - "+this.name+'"',t="https://messianicradio.com/?song="+this.id;this._twitterShareUrl="https://twitter.com/share?text="+encodeURIComponent(n)+"&url="+encodeURIComponent(t)+"&via="+encodeURIComponent("messianicradio")}return this._twitterShareUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"googlePlusShareUrl",{get:function(){return this._googlePlusShareUrl||(this._googlePlusShareUrl="https://plus.google.com/share?url="+encodeURI("https://messianicradio.com/?song="+this.id)),this._googlePlusShareUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shareUrl",{get:function(){return"https://messianicradio.com/?song="+this.id},enumerable:!0,configurable:!0}),t.prototype.getEmbedCode=function(){return'<iframe style="border-top: medium none; height: 558px; border-right: medium none; width: 350px; border-bottom: medium none; border-left: medium none" src="https://messianicradio.com/home/embed?song='+this.id+'" scrolling="none"><\/iframe>'},t.prototype.updateFrom=function(n){angular.merge(this,n)},t.prototype.updateAlbumArtColors=function(n){this.hasSetAlbumArtColors=!0;this.albumSwatchBackground=n.backgroundColor||this.albumSwatchBackground;this.albumSwatchForeground=n.foregroundColor||this.albumSwatchForeground;this.albumSwatchMuted=n.mutedColor||this.albumSwatchMuted;this.albumSwatchTextShadow=n.textShadowColor||this.albumSwatchTextShadow;var i=tinycolor(this.albumSwatchBackground).getBrightness(),r=tinycolor(this.albumSwatchForeground).getBrightness(),t=r>=i;this.albumSwatchLighter=t?this.albumSwatchForeground:this.albumSwatchBackground;this.albumSwatchDarker=t?this.albumSwatchBackground:this.albumSwatchForeground},t.empty=function(){return new t({album:"",albumArtUri:"",artist:"",communityRank:0,communityRankStanding:0,id:"songs/0",artistImages:[],genres:[],lyrics:"",name:"",number:0,purchaseUri:"",songLike:0,tags:[],totalPlays:0,uri:"",reasonsPlayed:this.createEmptySongPickReasons("songs/0")})},t.prototype.setSolePickReason=function(n){this.reasonsPlayed=t.createEmptySongPickReasons(this.id);this.reasonsPlayed.soleReason=n},t.prototype.createReasonPlayedText=function(){var i="Chavah plays random songs from time to time to see what kind of music you like",t;if(this.reasonsPlayed){if(this.reasonsPlayed.soleReason!==null)switch(this.reasonsPlayed.soleReason){case n.SongPick.SomeoneRequestedSong:return"it was requested by a listener";case n.SongPick.SongFromAlbumRequested:return"you asked to hear another song from the "+this.album+" album";case n.SongPick.SongFromArtistRequested:return"you asked to hear another song from "+this.artist;case n.SongPick.SongWithTagRequested:return"you asked to hear another song with this tag";case n.SongPick.VeryPoorRank:return"...well, even the lowest-ranked songs will get played sometimes :-)";case n.SongPick.YouRequestedSong:return"you asked Chavah to play it";case n.SongPick.RandomSong:default:return i}return(t=[],this.reasonsPlayed.ranking===n.LikeLevel.Favorite?t.push("it's one of the highest ranked songs on Chavah"):this.reasonsPlayed.ranking===n.LikeLevel.Love?t.push("it's got a great community ranking"):this.reasonsPlayed.ranking===n.LikeLevel.Like&&t.push("it's got a good community ranking"),this.reasonsPlayed.artist===n.LikeLevel.Favorite?t.push(this.artist+" is one of your favorite artists"):this.reasonsPlayed.artist===n.LikeLevel.Love?t.push("you love "+this.artist+" and have thumbed-up an abundance of "+this.artist+" songs"):this.reasonsPlayed.artist===n.LikeLevel.Like&&t.push("you like "+this.artist),this.reasonsPlayed.album===n.LikeLevel.Favorite&&t.push("you like nearly all the songs on "+this.album),this.reasonsPlayed.album===n.LikeLevel.Love?t.push("you love "+this.album):this.reasonsPlayed.album===n.LikeLevel.Like&&t.push("you like "+this.album),this.reasonsPlayed.songThumbedUp&&t.push("you like this song"),this.reasonsPlayed.similar===n.LikeLevel.Favorite?t.push("it's similar to some of your favorite songs"):this.reasonsPlayed.similar===n.LikeLevel.Love?t.push("you love similiar songs"):this.reasonsPlayed.similar===n.LikeLevel.Like&&t.push("you like similiar songs"),t.length===0)?"you might like it":t.length===1?t[0]:t.length===2?t.join(" and "):(t[t.length-1]="and "+t[t.length-1],t.join(", "))}return i},t.shuffle=function(n){for(var t=n.length,r,i;0!==t;)i=Math.floor(Math.random()*t),t-=1,r=n[t],n[t]=n[i],n[i]=r;return n},t.createEmptySongPickReasons=function(t){return{album:n.LikeLevel.NotSpecified,artist:n.LikeLevel.NotSpecified,ranking:n.LikeLevel.NotSpecified,similar:n.LikeLevel.NotSpecified,songThumbedUp:!1,songId:t,soleReason:null}},t}();t.defaultSwatch={getBodyTextColor:function(){return"black"},getHex:function(){return"white"},getHsl:function(){return"black"},getPopulation:function(){return 0},getTitleTextColor:function(){return"black"},hsl:[255,255,255],rgb:[255,255,255]};n.Song=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Pending=0]="Pending";n[n.Rejected=1]="Rejected";n[n.Approved=2]="Approved"})(t=n.SongEditStatus||(n.SongEditStatus={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Unranked=0]="Unranked";n[n.Liked=1]="Liked";n[n.Disliked=2]="Disliked"})(t=n.SongLike||(n.SongLike={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.RandomSong=0]="RandomSong";n[n.VeryPoorRank=1]="VeryPoorRank";n[n.PoorRank=2]="PoorRank";n[n.NormalRank=3]="NormalRank";n[n.GoodRank=4]="GoodRank";n[n.GreatRank=5]="GreatRank";n[n.BestRank=6]="BestRank";n[n.LikedArtist=7]="LikedArtist";n[n.LikedAlbum=8]="LikedAlbum";n[n.LikedSong=9]="LikedSong";n[n.LikedTag=10]="LikedTag";n[n.SongFromAlbumRequested=11]="SongFromAlbumRequested";n[n.SongFromArtistRequested=12]="SongFromArtistRequested";n[n.SongWithTagRequested=13]="SongWithTagRequested";n[n.YouRequestedSong=14]="YouRequestedSong";n[n.SomeoneRequestedSong=15]="SomeoneRequestedSong"})(t=n.SongPick||(n.SongPick={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.email=n;this.roles=t;this.isAdmin=t&&t.includes("Admin")}return n}();n.User=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.scope=n;this.element=t;var u=r(i.enterHandler);t.on("keydown",function(t){t.keyCode===13&&(u(n),t.preventDefault&&t.preventDefault(),n.$applyAsync())});t.on("$destroy",function(){return t.off("keydown $destroy")})}return n}(),i=function(){function n(n){this.$parse=n;this.restrict="A";this.link=this.unboundLink.bind(this)}return n.prototype.unboundLink=function(n,i,r){new t(n,i,r,this.$parse)},n}();n.App.directive("enterHandler",["$parse",function(n){return new i(n)}])})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){this.scope=n;this.element=t;var f=u(i.triggerFocus);n.$watch(f,function(n){n&&r(function(){return t[0].focus()})});t.bind("blur",function(){return n.$apply(f.assign(n,!1))})}return n}(),i=function(){function n(n,t){this.$timeout=n;this.$parse=t;this.restrict="A";this.link=this.unboundLink.bind(this)}return n.prototype.unboundLink=function(n,i,r){new t(n,i,r,this.$timeout,this.$parse)},n}();n.App.directive("triggerFocus",["$timeout","$parse",function(n,t){return new i(n,t)}])})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i){var r=this;this.albumApi=t;this.appNav=i;this.search="";this.albums=new n.PagedList(function(n,t){return r.albumApi.getAll(n,t,r.search)});this.isSaving=!1;this.albums.take=50;this.albums.fetchNextChunk()}return t.prototype.searchChanged=function(){this.albums.resetAndFetch()},t.prototype.deleteAlbum=function(n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:this.isSaving=!0;t.label=1;case 1:return t.trys.push([1,,3,4]),[4,this.albumApi.deleteAlbum(n.id)];case 2:return t.sent(),_.pull(this.albums.items,n),[3,4];case 3:return this.isSaving=!1,[7];case 4:return[2]}})})},t}();t.$inject=["albumApi","appNav"];n.AlbumsController=t;n.App.controller("AlbumsController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.songApi=n;this.songEditApi=t;this.tagApi=i;this.pendingEdits=[];this.currentEdit=null;this.isSaving=!1;this.hasLoaded=!1;this.tagsInput="";this.songEditApi.getPendingEdits(20).then(function(n){return r.pendingEditsLoaded(n)})}return n.prototype.pendingEditsLoaded=function(n){this.pendingEdits=n;this.setCurrentEdit(n[0]);this.hasLoaded=!0},n.prototype.setCurrentEdit=function(n){this.currentEdit=n},n.prototype.approve=function(){var n=this,t=this.currentEdit;!this.isSaving&&t&&(this.isSaving=!0,this.songEditApi.approve(t).then(function(t){return n.removeSongEdit(t.id)}).finally(function(){return n.isSaving=!1}))},n.prototype.reject=function(){var n=this,t=this.currentEdit;!this.isSaving&&t&&(this.isSaving=!0,this.songEditApi.reject(t.id).then(function(t){t&&n.removeSongEdit(t.id)}).finally(function(){return n.isSaving=!1}))},n.prototype.removeSongEdit=function(n){this.pendingEdits=this.pendingEdits.filter(function(t){return t.id!==n});this.currentEdit&&this.currentEdit.id===n&&this.setCurrentEdit(this.pendingEdits[0])},n.prototype.removeTag=function(n){if(this.currentEdit){var t=this.currentEdit.newTags.indexOf(n);t>=0&&this.currentEdit.newTags.splice(t,1)}},n.prototype.autoCompleteTagSelected=function(n){this.addTag(n);this.tagsInput=""},n.prototype.addTag=function(n){if(this.currentEdit){var t=n.toLowerCase().trim();!this.currentEdit.newTags.includes(t)&&t.length>1&&this.currentEdit.newTags.push(t)}},n.prototype.tagsInputChanged=function(){var t=this,n;this.tagsInput.includes(",")&&(n=this.tagsInput.split(","),this.tagsInput="",n.filter(function(n){return n&&n.length>1}).forEach(function(n){return t.addTag(n)}))},n.prototype.tagsEnterKeyPressed=function(){this.tagsInput.length>1&&this.autoCompleteTagSelected(this.tagsInput)},n.prototype.searchTags=function(n){return this.tagApi.searchTags(n)},n}();t.$inject=["songApi","songEditApi","tagApi"];n.ApproveSongEditsController=t;n.App.controller("ApproveSongEditsController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){var r=this,i;this.accountApi=n;this.email="";this.confirmCode="";this.isConfirming=!0;this.confirmSucceeded=!1;this.confirmFailed=!1;this.confirmFailedErrorMessage="";this.email=t.email;i=t.confirmCode||"";this.confirmCode=i.replace(new RegExp("___","g"),"/");setTimeout(function(){return r.confirm()},1e3)}return n.prototype.confirm=function(){var n=this;this.accountApi.confirmEmail(this.email,this.confirmCode).then(function(t){return n.confirmEmailCompleted(t)}).catch(function(t){return n.confirmEmailCompleted({errorMessage:t&&t.data&&t.data.exceptionMessage?t.data.exceptionMessage:"Couldn't confirm email",success:!1})})},n.prototype.confirmEmailCompleted=function(n){this.isConfirming=!1;this.confirmSucceeded=n.success;this.confirmFailed=!this.confirmSucceeded;this.confirmFailedErrorMessage=n.errorMessage},n}();t.$inject=["accountApi","$routeParams"];n.ConfirmEmailController=t;n.App.controller("ConfirmEmailController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){this.accountApi=n;this.appNav=t;this.password="";this.showPasswordError=!1;this.isSaving=!1;this.hasCreatedPassword=!1;this.email=i.email;this.emailWithoutDomain=this.email.substr(0,this.email.indexOf("@"))}return Object.defineProperty(n.prototype,"isPasswordValid",{get:function(){return this.password.length>=6},enumerable:!0,configurable:!0}),n.prototype.createPassword=function(){var n=this;if(!this.isPasswordValid){this.showPasswordError=!0;return}this.isSaving||(this.isSaving=!0,this.accountApi.createPassword(this.email,this.password).then(function(){return n.hasCreatedPassword=!0}).finally(function(){return n.isSaving=!1}))},n}();t.minPasswordLength=6;t.$inject=["accountApi","appNav","$routeParams"];n.CreatePasswordController=t;n.App.controller("CreatePasswordController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){var i=this;this.desiredArtistName=null;this.donationTargetOptions=["Chavah Messianic Radio","All artists on Chavah Messianic Radio"];this.donationTarget=this.donationTargetOptions[0];this.selectedArtist=null;this.desiredArtistName=t.artist;this.desiredArtistName&&(this.donationTargetOptions.push(this.desiredArtistName),this.donationTarget=this.desiredArtistName);n.getAll("",0,1e3).then(function(n){return i.allArtistsFetched(n.items)})}return n.prototype.allArtistsFetched=function(n){var i=n.map(function(n){return n.name}),t;(t=this.donationTargetOptions).push.apply(t,i)},n}();t.$inject=["artistApi","$routeParams"];n.DonateController=t;n.App.controller("DonateController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r){var e=this,u,f,o;this.albumApi=n;this.appNav=t;this.$q=r;this.album=null;this.allAlbumSwatches=[];this.hasChangedAlbumArt=!1;u=i.artist;f=i.album;u&&f?(o=u.toLowerCase()==="albums",o?this.albumApi.get(u+"/"+f).then(function(n){return e.albumLoaded(n)}):this.albumApi.getByArtistAndAlbumName(u,f).then(function(n){return e.albumLoaded(n)})):this.createNewAlbum()}return t.prototype.createNewAlbum=function(){return new n.Album({albumArtUri:"",artist:"[new artist]",isVariousArtists:!1,backgroundColor:"",foregroundColor:"",mutedColor:"",name:"[new album]",id:"",textShadowColor:"",songCount:0})},t.prototype.albumLoaded=function(n){var t=this;n?(this.album=n,n.albumArtUri&&this.loadCanvasSafeAlbumArt(n.albumArtUri).then(function(n){return t.populateColorSwatches(n)})):this.appNav.createAlbum()},t.prototype.save=function(){var n=this;return this.album&&!this.album.isSaving&&(this.album.isSaving=!0,this.hasChangedAlbumArt?this.albumApi.save(this.album).then(function(t){return n.albumApi.changeArt(t.id,n.album.albumArtUri)}).then(function(t){n.album=t;n.hasChangedAlbumArt=!1}).finally(function(){return n.album.isSaving=!1}):this.albumApi.save(this.album).then(function(t){return n.album=t}).finally(function(){return n.album.isSaving=!1})),null},t.prototype.hexToRgbString=function(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t&&t.length>=4?"rgb("+parseInt(t[1],16)+", "+parseInt(t[2],16)+", "+parseInt(t[3],16)+")":""},t.prototype.resetColorSwatches=function(n){var t=this;this.loadCanvasSafeAlbumArt(n).then(function(n){return t.populateColorSwatches(n)})},t.prototype.chooseAlbumArt=function(){var i=this,t;filepicker.setKey(n.UploadAlbumController.filePickerKey);t={extensions:[".jpg",".png"]};filepicker.pick(t,function(n){return i.albumArtChosen(n)},function(n){return console.log("Album art pick failed.",n)})},t.prototype.albumArtChosen=function(n){var t=this;this.hasChangedAlbumArt=!0;this.album&&(this.album.albumArtUri=n.url);this.loadCanvasSafeAlbumArt(n.url).then(function(n){return t.populateColorSwatches(n)})},t.prototype.populateColorSwatches=function(t){if(this.album){var r=new Vibrant(t,64,5),i=r.swatches();i&&(this.allAlbumSwatches=n.UploadAlbumController.getFriendlySwatches(i),this.album.backgroundColor||(this.album.backgroundColor=(i.DarkVibrant||i.DarkMuted||n.Song.defaultSwatch).getHex(),this.album.foregroundColor=(i.LightVibrant||i.Vibrant||n.Song.defaultSwatch).getHex(),this.album.mutedColor=(i.DarkMuted||i.DarkVibrant||i.Vibrant||n.Song.defaultSwatch).getBodyTextColor(),this.album.textShadowColor=(i.DarkMuted||i.DarkVibrant||n.Song.defaultSwatch).getHex()))}},t.prototype.loadCanvasSafeAlbumArt=function(n){if(!n)throw new Error("imgUrl must not be null or undefined");var i=this.$q.defer(),t=document.createElement("img");return t.src="/api/albums/art/imageOnDomain?imageUrl="+encodeURIComponent(n),t.addEventListener("load",function(){i.resolve(t)}),t.addEventListener("error",function(){return i.reject()}),i.promise},t}();t.$inject=["albumApi","appNav","$routeParams","$q"];n.EditAlbumController=t;n.App.controller("EditAlbumController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r){var f=this,u;this.artistApi=t;this.$scope=r;u=i.artistName;u&&u.length>0?this.artistApi.getByName(u).then(function(n){return f.artist=n}):this.artist=new n.Artist}return t.prototype.removeImage=function(n){this.artist&&(this.artist.images=this.artist.images.filter(function(t){return t!==n}))},t.prototype.addImages=function(){var i=this,t;filepicker.setKey(n.UploadAlbumController.filePickerKey);t={extensions:[".jpg",".png"],maxFiles:100};filepicker.pickMultiple(t,function(n){return i.imagesAdded(n)},function(n){return console.log("Failed to add image.",n)})},t.prototype.imagesAdded=function(n){var t=this;n.forEach(function(n){return t.artist.images.push(n.url)});this.$scope.$applyAsync()},t.prototype.save=function(){var n=this;this.artist&&!this.artist.isSaving&&(this.artist.isSaving=!0,this.artistApi.save(this.artist).then(function(t){return n.artist.updateFrom(t)}).finally(function(){return n.artist.isSaving=!1}))},t}();t.$inject=["artistApi","$routeParams","$scope"];n.EditArtistController=t;n.App.controller("EditArtistController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f){var o=this,e;this.songApi=n;this.songEditApi=t;this.tagApi=i;this.song=null;this.tagsInput="";this.isSaving=!1;this.isSaveSuccess=!1;this.isSaveFail=!1;this.tags=[];this.isLyricsFocused=!0;this.tagPlaceholder="piano, violin, male vocal, hebrew, psalms";r.isSignedIn?(e="songs/"+f.id,e&&n.getSongById(e).then(function(n){return o.songLoaded(n)}),this.isAdmin=!!r.currentUser&&r.currentUser.isAdmin):u.promptSignIn()}return n.prototype.searchTags=function(n){return this.tagApi.searchTags(n)},n.prototype.songLoaded=function(n){this.song=n;n&&(this.tags=n.tags||[],this.tags.length>0&&(this.tagPlaceholder=""))},n.prototype.tagsInputChanged=function(){var t=this,n;this.tagsInput.includes(",")&&(n=this.tagsInput.split(","),this.tagsInput="",n.filter(function(n){return n&&n.length>1}).forEach(function(n){return t.addTag(n)}))},n.prototype.removeTag=function(n){var t=this.tags.indexOf(n);t>=0&&this.tags.splice(t,1)},n.prototype.autoCompleteTagSelected=function(n){this.addTag(n);this.tagsInput=""},n.prototype.addTag=function(n){var t=n.toLowerCase().trim();!this.tags.includes(t)&&t.length>1&&(this.tags.push(t),this.tagPlaceholder="")},n.prototype.tagsEnterKeyPressed=function(){this.tagsInput.length>1&&this.autoCompleteTagSelected(this.tagsInput)},n.prototype.submit=function(){var n=this;this.song&&!this.isSaving&&(this.song.tags=this.tags,this.isSaving=!0,this.songEditApi.submit(this.song).then(function(){return n.isSaveSuccess=!0}).catch(function(){return n.isSaveFail=!0}).finally(function(){return n.isSaving=!1}))},n}();t.$inject=["songApi","songEditApi","tagApi","accountApi","appNav","$routeParams"];n.EditSongController=t;n.App.controller("EditSongController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r,u,f,e,o){var s=this,h;this.audioPlayer=n;this.songBatch=t;this.likeApi=i;this.songRequestApi=r;this.accountApi=u;this.stationIdentifier=f;this.appNav=e;this.$scope=o;this.volumeShown=!1;this.volume=1;this.isBuffering=!1;h=document.querySelector("#audio");this.audioPlayer.initialize(h);this.volume=h.volume;this.audioPlayer.status.debounce(100).subscribe(function(n){return s.audioStatusChanged(n)});this.audioPlayer.playedTimeText.distinctUntilChanged().subscribe(function(n){return $(".footer .track-time").text(n)});this.audioPlayer.duration.distinctUntilChanged().subscribe(function(n){return $(".footer .track-duration").text(s.getFormattedTime(n))});this.audioPlayer.status.distinctUntilChanged().subscribe(function(n){return $(".footer .audio-status").text(s.getAudioStatusText(n))});this.audioPlayer.playedTimePercentage.distinctUntilChanged().subscribe(function(n){return $(".footer .trackbar").width(n+"%")});o.$watch(function(){return s.volume},function(){return h.volume=s.volume});"mediaSession"in navigator&&(this.setupMediaSessionHandlers(),this.audioPlayer.song.subscribe(function(n){return s.updateMediaSession(n)}))}return Object.defineProperty(t.prototype,"likesCurrentSong",{get:function(){var t=this.audioPlayer.song.getValue();return t?t.songLike===n.SongLike.Liked:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dislikesCurrentSong",{get:function(){var t=this.audioPlayer.song.getValue();return t?t.songLike===n.SongLike.Disliked:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"likeText",{get:function(){return this.likesCurrentSong?"You have already liked this song. Chavah is playing it more often.":"Like this song. Chavah will play this song, and others like it, more often."},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dislikeText",{get:function(){return this.dislikesCurrentSong?"You have already disliked this song. Chavah is playing it less often.":"Dislike this song. Chavah will play this song, and others like it, less often."},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volumeIconClass",{get:function(){return this.volume>.95?"fa-volume-up":this.volume<.05?"fa-volume-off":"fa-volume-down"},enumerable:!0,configurable:!0}),t.prototype.toggleVolumnShown=function(){this.volumeShown=!this.volumeShown},t.prototype.isPaused=function(){return this.audioPlayer.status.getValue()===n.AudioStatus.Paused},t.prototype.playPause=function(){this.audioPlayer.status.getValue()===n.AudioStatus.Playing?this.audioPlayer.pause():this.audioPlayer.resume()},t.prototype.dislikeSong=function(){if(this.requireSignIn()){var t=this.audioPlayer.song.getValue();t&&t.songLike!==n.SongLike.Disliked&&(t.songLike=n.SongLike.Disliked,this.likeApi.dislikeSong(t.id).then(function(n){return t.communityRank=n}),this.songBatch.playNext())}},t.prototype.likeSong=function(){if(this.requireSignIn()){var t=this.audioPlayer.song.getValue();t&&t.songLike!==n.SongLike.Liked&&(t.songLike=n.SongLike.Liked,this.likeApi.likeSong(t.id).then(function(n){return t.communityRank=n}))}},t.prototype.requestSong=function(){var n=this;this.requireSignIn()&&this.appNav.showSongRequestDialog().result.then(function(t){return n.songRequestDialogCompleted(t)})},t.prototype.requireSignIn=function(){return this.accountApi.isSignedIn?!0:(this.appNav.promptSignIn(),!1)},t.prototype.songRequestDialogCompleted=function(n){var t=this;n&&(this.audioPlayer.pause(),this.songRequestApi.requestSong(n).then(function(){return t.playNextSong()}))},t.prototype.playNextSong=function(){this.audioPlayer.pause();this.songRequestApi.hasPendingRequest()?this.songRequestApi.playRequest():this.stationIdentifier.hasPendingAnnouncement()?this.stationIdentifier.playStationIdAnnouncement():this.songBatch.playNext()},t.prototype.audioStatusChanged=function(t){t===n.AudioStatus.Ended&&this.playNextSong();this.isBuffering=t===n.AudioStatus.Buffering||t===n.AudioStatus.Stalled;this.$scope.$applyAsync()},t.prototype.getFormattedTime=function(n){if(isNaN(n))return"00";var t=Math.floor(n/60),i=Math.floor(n-t*60),r=i<10?"0":"";return t+":"+r+i},t.prototype.getAudioStatusText=function(t){switch(t){case n.AudioStatus.Aborted:return"Unable to play";case n.AudioStatus.Buffering:return"Buffering...";case n.AudioStatus.Ended:return"Ended...";case n.AudioStatus.Erred:return"Encountered an error";case n.AudioStatus.Paused:return"Paused";case n.AudioStatus.Playing:return"";case n.AudioStatus.Stalled:return"Stalled..."}},t.prototype.setupMediaSessionHandlers=function(){var t=this,n;try{n=navigator.mediaSession;n.setActionHandler("play",function(){return t.playPause()});n.setActionHandler("pause",function(){return t.playPause()});n.setActionHandler("nexttrack",function(){return t.playNextSong()})}catch(i){}},t.prototype.updateMediaSession=function(n){if(n){var t={album:n.album,artist:n.artist,title:n.name,artwork:[{src:n.albumArtUri,sizes:"300x300",type:"image/jpg"}]};try{navigator.mediaSession.metadata=new window.MediaMetadata(t)}catch(i){}}},t}();t.$inject=["audioPlayer","songBatch","likeApi","songRequestApi","accountApi","stationIdentifier","appNav","$scope"];n.FooterController=t;n.App.controller("FooterController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.accountApi=n;this.email="";this.resetPasswordSuccessfully=!1;this.couldNotFindEmail=!1;this.resetErrorMessage="";this.isBusy=!1}return Object.defineProperty(n.prototype,"registerUrl",{get:function(){return this.email&&this.email.indexOf("@")>=0?"#/register/"+encodeURIComponent(this.email):"#/register"},enumerable:!0,configurable:!0}),n.prototype.resetPassword=function(){var n=this,t=this.email&&this.email.includes("@");if(!t){this.resetErrorMessage="Please enter your email so we can reset your password";return}this.resetFields();this.isBusy||(this.isBusy=!0,this.accountApi.sendPasswordResetEmail(this.email).then(function(t){return n.passwordResetCompleted(t)}).finally(function(){return n.isBusy=!1}))},n.prototype.passwordResetCompleted=function(n){n.success?this.resetPasswordSuccessfully=!0:n.invalidEmail?this.couldNotFindEmail=!0:this.resetErrorMessage=n.errorMessage||"Unable to reset password"},n.prototype.resetFields=function(){this.couldNotFindEmail=!1;this.resetPasswordSuccessfully=!1;this.resetErrorMessage=""},n}();t.$inject=["accountApi"];n.ForgotPasswordController=t;n.App.controller("ForgotPasswordController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.initConfig=n;this.accountApi=t;this.$timeout=i;this.isNotificationPopoverOpened=!1;this.notifications=n.notifications;i(function(){return r.encourageUserToViewNotifications()},15e3)}return Object.defineProperty(n.prototype,"currentUserName",{get:function(){return this.accountApi.currentUser?this.accountApi.currentUser.email:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"unreadNotificationCount",{get:function(){return this.notifications.filter(function(n){return n.isUnread}).length},enumerable:!0,configurable:!0}),n.prototype.encourageUserToViewNotifications=function(){this.notifications.length>0&&this.notifications.some(function(n){return n.isUnread})&&(this.isNotificationPopoverOpened=!0)},n.prototype.markNotificationsAsRead=function(){this.notifications.some(function(n){return n.isUnread})&&(this.notifications.forEach(function(n){return n.isUnread=!1}),this.accountApi.clearNotifications());this.isNotificationPopoverOpened=!1},n.prototype.signOut=function(){this.accountApi.signOut().then(function(){return window.location.reload()})},n}();t.$inject=["initConfig","accountApi","$timeout"];n.HeaderController=t;n.App.controller("HeaderController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t){var i=this;this.logApi=t;this.logs=new n.PagedList(function(n,t){return i.logApi.getAll(n,t)});this.isSaving=!1;this.logs.fetchNextChunk()}return t.prototype.getTimeAgo=function(n){return moment(n).fromNow(!1)},t.prototype.getFriendlyDate=function(n){return moment(n).utcOffset(-6).format("dddd MMMM DD, YYYY h:mma")+" (CST)"},t.prototype.deleteLog=function(n){var t=this;this.isSaving||(this.isSaving=!0,this.logApi.deleteLog(n.id).then(function(){return t.logs.resetAndFetch()}).finally(function(){return t.isSaving=!1}))},t.prototype.getOccurrencesText=function(n){return n.occurrences&&n.occurrences.length?n.occurrences.map(function(n){return JSON.stringify(n,null,4)}):[]},t}();t.$inject=["logApi"];n.LogEditorController=t;n.App.controller("LogEditorController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r,u,f,e,o){var s=this,h;this.songApi=n;this.songBatch=t;this.audioPlayer=i;this.albumCache=r;this.initConfig=u;this.appNav=f;this.accountApi=e;this.$q=o;this.songs=[];this.trending=[];this.recent=[];this.popular=[];this.likes=[];this.isFetchingAlbums=!1;this.disposed=new Rx.Subject;this.audioPlayer.song.takeUntil(this.disposed).subscribeOnNext(function(n){return s.nextSongBeginning(n)});this.audioPlayer.songCompleted.takeUntil(this.disposed).throttle(5e3).subscribe(function(n){return s.songCompleted(n)});this.songBatch.songsBatch.takeUntil(this.disposed).subscribeOnNext(function(){return s.songs=s.getSongs()});this.fetchRecentPlays();this.setupRecurringFetches();u.embed||(h=this.audioPlayer.song.getValue(),h||this.playSongInUrlQuery()||this.songBatch.playNext())}return Object.defineProperty(t.prototype,"currentArtistDonateUrl",{get:function(){var n=this.currentSong;return n&&n.artist?"#/donate/"+encodeURIComponent(n.artist):"#/donate"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSongShareUrl",{get:function(){return this.currentSong?this.currentSong.isShowingEmbedCode?this.currentSong.getEmbedCode():this.currentSong.shareUrl:""},enumerable:!0,configurable:!0}),t.prototype.getEditSongUrl=function(){return this.currentSong?this.accountApi.isSignedIn?this.appNav.getEditSongUrl(this.currentSong.id):this.appNav.promptSignInUrl:"#"},t.prototype.$onDestroy=function(){this.recurringFetchHandle&&clearTimeout(this.recurringFetchHandle);this.disposed.onNext(!0)},t.prototype.getSongs=function(){var n=[this.audioPlayer.song.getValue(),this.songBatch.songsBatch.getValue()[0],this.songBatch.songsBatch.getValue()[1],this.songBatch.songsBatch.getValue()[2],this.songBatch.songsBatch.getValue()[3]].filter(function(n){return!!n&&n.name});return this.fetchAlbumColors(n),n},t.prototype.getSongOrPlaceholder=function(t){return t||n.Song.empty()},t.prototype.fetchAlbumColors=function(n){var i=this,t=n.filter(function(n){return!n.hasSetAlbumArtColors&&n.id!=="songs/0"});t.length>0&&(this.isFetchingAlbums=!0,this.albumCache.getAlbumsForSongs(t).then(function(n){return i.populateSongsWithAlbumColors(n)}))},t.prototype.populateSongsWithAlbumColors=function(n){var t=this;n.forEach(function(n){var i=t.getAllSongsOnScreen().filter(function(t){return t.albumId&&t.albumId.toLowerCase()===n.id.toLowerCase()});i.forEach(function(t){return t.updateAlbumArtColors(n)})})},t.prototype.setupRecurringFetches=function(){var n=this,t=this.songApi.getTrendingSongs(0,3).then(function(t){return n.updateSongList(n.trending,t.items)}).then(function(){return n.songApi.getPopularSongs(3)}).then(function(t){return n.updateSongList(n.popular,t)}).then(function(){return n.songApi.getLikes(3)}).then(function(t){return n.updateSongList(n.likes,t)}).finally(function(){n.fetchAlbumColors(n.getAllSongsOnScreen());n.recurringFetchHandle=setTimeout(function(){return n.setupRecurringFetches()},3e4)})},t.prototype.fetchRecentPlays=function(){var n=this;this.songApi.getRecentPlays(3).then(function(t){t.forEach(function(t){return n.recent.push(t)});n.recent.length>3&&(n.recent.length=3)})},t.prototype.updateSongList=function(n,t){n.splice.apply(n,[0,n.length].concat(t));this.fetchAlbumColors(this.getAllSongsOnScreen())},t.prototype.getAllSongsOnScreen=function(){return this.songs.concat(this.recent,this.trending,this.likes,this.popular)},t.prototype.nextSongBeginning=function(n){this.songs=this.getSongs();n&&(this.currentSong&&(this.recent.splice(0,0,this.currentSong),this.recent.length>3&&(this.recent.length=3)),this.currentSong=n)},t.prototype.songCompleted=function(n){n&&this.songApi.songCompleted(n.id)},t.prototype.songClicked=function(t){if(t!==this.currentSong){t.setSolePickReason(n.SongPick.YouRequestedSong);var i=this.songBatch.songsBatch.getValue(),r=i.indexOf(t);r>=0&&(i.splice(r,1),i.splice(0,0,t),this.songBatch.playNext())}},t.prototype.playSongFromCurrentArtist=function(){this.currentSong&&this.audioPlayer.playSongFromArtist(this.currentSong.artist)},t.prototype.playSongFromCurrentAlbum=function(){this.currentSong&&this.audioPlayer.playSongFromAlbum(this.currentSong.album)},t.prototype.playSongWithTag=function(n){this.audioPlayer.playSongWithTag(n)},t.prototype.playSongInUrlQuery=function(){var i=this.getUrlQueryOrNull("song"),n,t;return i?(this.audioPlayer.playSongById(i),!0):(n=this.getUrlQueryOrNull("artist"),t=this.getUrlQueryOrNull("album"),n&&t)?(this.audioPlayer.playSongFromArtistAndAlbum(n,t),!0):t?(this.audioPlayer.playSongFromAlbum(t),!0):n?(this.audioPlayer.playSongFromArtist(n),!0):!1},t.prototype.copyShareUrl=function(){var n=document.querySelector("#currentSongShareLink");n.select();document.execCommand("copy")},t.prototype.getUrlQueryOrNull=function(n){var r=window.location.search,i,f;if(r){var e=r.split("&"),u=n+"=",o="?"+u,t=e.find(function(n){return n.startsWith(u)||n.startsWith(o)});if(t&&(i=t.substr(t.indexOf("=")+1),i))return f=i.split("+").join(" "),decodeURIComponent(f)}return null},t}();t.$inject=["songApi","songBatch","audioPlayer","albumCache","initConfig","appNav","accountApi","$q"];n.NowPlayingController=t;n.App.controller("NowPlayingController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r,u){var f=this;this.accountApi=n;this.appNav=t;this.$timeout=r;this.email="";this.showPasswordError=!1;this.passwordError="";this.isBusy=!1;this.password="";this.staySignedIn=!0;this.signInSuccessful=!1;this.email=i.email;u.$watch(function(){return f.password},function(){return f.passwordChanged()})}return Object.defineProperty(t.prototype,"isPasswordValid",{get:function(){return this.password.length>=6},enumerable:!0,configurable:!0}),t.prototype.signIn=function(){var n=this;if(!this.isPasswordValid){this.showPasswordError=!0;this.passwordError="Passwords must be at least 6 characters long.";return}this.isBusy||(this.isBusy=!0,this.accountApi.signIn(this.email,this.password,this.staySignedIn).then(function(t){return n.signInCompleted(t)}).finally(function(){return n.isBusy=!1}))},t.prototype.signInCompleted=function(t){var i=this;t.status===n.SignInStatus.Success?(this.signInSuccessful=!0,this.$timeout(function(){return i.appNav.nowPlaying()},2e3)):t.status===n.SignInStatus.LockedOut?(this.showPasswordError=!0,this.passwordError="Your account is locked out. Please contact judahgabriel@gmail.com"):t.status===n.SignInStatus.RequiresVerification?(this.showPasswordError=!0,this.passwordError="Please check your email. We've sent you an email with a link to confirm your account."):t.status===n.SignInStatus.Failure&&(this.showPasswordError=!0,this.passwordError="Incorrect password")},t.prototype.passwordChanged=function(){this.showPasswordError=!1;this.passwordError=""},t}();t.$inject=["accountApi","appNav","$routeParams","$timeout","$scope"];n.PasswordController=t;n.App.controller("PasswordController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.accountApi=n;this.email="";this.password="";this.showEmailError=!1;this.showPasswordError=!1;this.showRegisterSuccess=!1;this.showAlreadyRegistered=!1;this.showNeedsConfirmation=!1;this.registrationError="";this.isBusy=!1;var i=t.email;i&&(this.email=i)}return Object.defineProperty(n.prototype,"isValidEmail",{get:function(){return!!this.email&&this.email.lastIndexOf("@")>=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isValidPassword",{get:function(){return!!this.password&&this.password.length>=6},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"showRegisterForm",{get:function(){return!this.showAlreadyRegistered&&!this.showNeedsConfirmation&&!this.showRegisterSuccess},enumerable:!0,configurable:!0}),n.prototype.register=function(){var n=this;if(this.reset(),!this.isValidEmail){this.showEmailError=!0;return}if(!this.isValidPassword){this.showPasswordError=!0;return}this.isBusy||(this.isBusy=!0,this.accountApi.register(this.email,this.password).then(function(t){return n.registrationCompleted(t)}).finally(function(){return n.isBusy=!1}))},n.prototype.registrationCompleted=function(n){n.success?this.showRegisterSuccess=!0:n.needsConfirmation?this.showNeedsConfirmation=!0:n.isAlreadyRegistered?this.showAlreadyRegistered=!0:this.registrationError=n.errorMessage||"Unable to register your user. Please contact judahgabriel@gmail.com"},n.prototype.reset=function(){this.registrationError="";this.showAlreadyRegistered=!1;this.showEmailError=!1;this.showNeedsConfirmation=!1;this.showPasswordError=!1;this.showRegisterSuccess=!1},n}();t.$inject=["accountApi","$routeParams"];n.RegisterController=t;n.App.controller("RegisterController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){this.songApi=n;this.$uibModalInstance=t;this.$q=i;this.songRequestText=""}return n.prototype.getSongMatches=function(n){var i=10,t=this.$q.defer();return this.songApi.getSongMatches(n).then(function(n){return t.resolve(n.slice(0,i))}).catch(function(n){return t.reject(n)}),t.promise},n.prototype.songChosen=function(n){this.selectedSongRequest=n},n.prototype.requestSelectedSong=function(){this.selectedSongRequest&&this.$uibModalInstance.close(this.selectedSongRequest)},n.prototype.close=function(){this.$uibModalInstance.close(null)},n}();t.$inject=["songApi","$uibModalInstance","$q"];n.RequestSongController=t;n.App.controller("RequestSongController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.accountApi=n;this.$routeParams=t;this.email="";this.password="";this.showPasswordError=!1;this.isBusy=!1;this.passwordResetSucccessful=!1;this.passwordResetFailed=!1;this.passwordResetFailedMessage="";this.email=t.email;var r=t.confirmCode,i=t.confirmCode||"";this.confirmCode=i.replace(new RegExp("___","g"),"/")}return Object.defineProperty(n.prototype,"isValidPassword",{get:function(){return!!this.password&&this.password.length>=6},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"showChangePasswordForm",{get:function(){return!this.passwordResetSucccessful&&!this.passwordResetFailed},enumerable:!0,configurable:!0}),n.prototype.changePassword=function(){var n=this;if(!this.isValidPassword){this.showPasswordError=!0;return}this.isBusy||(this.resetValidationStates(),this.isBusy=!0,this.accountApi.resetPassword(this.email,this.confirmCode,this.password).then(function(t){return n.passwordResetCompleted(t)}).finally(function(){return n.isBusy=!1}))},n.prototype.passwordResetCompleted=function(n){n.success?this.passwordResetSucccessful=!0:(this.passwordResetFailed=!0,this.passwordResetFailedMessage=n.errorMessage)},n.prototype.resetValidationStates=function(){this.passwordResetFailed=!1;this.passwordResetFailedMessage="";this.passwordResetSucccessful=!1;this.showPasswordError=!1},n}();t.$inject=["accountApi","$routeParams"];n.ResetPasswordController=t;n.App.controller("ResetPasswordController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.artist=n.artist}return Object.defineProperty(n.prototype,"donateUrl",{get:function(){return this.artist?"#/donate/"+encodeURIComponent(this.artist):"#/donate"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"donateText",{get:function(){return this.artist?"Donate to "+this.artist:"Donate to the artists"},enumerable:!0,configurable:!0}),n}();t.$inject=["$routeParams"];n.ShareThanksController=t;n.App.controller("ShareThanksController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.accountApi=n;this.appNav=t;this.email="";this.showEmailError=!1;this.showUserNotInSystem=!1;this.isBusy=!1;i.$watch(function(){return r.email},function(){return r.showUserNotInSystem=!1})}return Object.defineProperty(n.prototype,"registerUrl",{get:function(){return this.email&&this.email.indexOf("@")>=0?"#/register/"+this.email:"#/register"},enumerable:!0,configurable:!0}),n.prototype.checkEmail=function(){var n=this;this.email?this.isBusy||(this.resetValidationStates(),this.isBusy=!0,this.accountApi.getUserWithEmail(this.email).then(function(t){return n.userFetched(t)}).finally(function(){return n.isBusy=!1})):this.showEmailError=!0},n.prototype.userFetched=function(n){n==null?this.showUserNotInSystem=!0:n.requiresPasswordReset?this.appNav.createPassword(this.email):this.appNav.password(this.email)},n.prototype.resetValidationStates=function(){this.showUserNotInSystem=!1;this.showEmailError=!1},n}();t.$inject=["accountApi","appNav","$scope"];n.SignInController=t;n.App.controller("SignInController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.artist=n.artist;this.songName=n.songName}return n}();t.$inject=["$routeParams"];n.SongEditApprovedController=t;n.App.controller("SongEditApprovedController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.audioPlayer=n}return t.prototype.playSong=function(t){var i=new n.Song(t);i.setSolePickReason(n.SongPick.YouRequestedSong);this.audioPlayer.playNewSong(i)},t}();t.$inject=["audioPlayer"];n.SongListController=t;n.App.controller("SongListController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.tagApi=n;this.allTags=[];this.selectedTag=null;this.newTagName="";this.isSaving=!1;this.tagApi.getAll().then(function(n){return t.allTags=n.sort()})}return n.prototype.selectTag=function(n){this.newTagName=n||"";this.selectedTag=n},n.prototype.deleteTag=function(n){var t=this;this.isSaving||(this.isSaving=!0,this.tagApi.deleteTag(n).then(function(){_.pull(t.allTags,n);t.selectTag(null)}).finally(function(){return t.isSaving=!1}))},n.prototype.renameTag=function(n){var t=this,i=this.newTagName;this.isSaving||i===n||(this.isSaving=!0,this.tagApi.renameTag(n,i).then(function(r){var u=t.allTags.indexOf(n);u>=0&&(t.allTags[u]=r,t.allTags=_.uniq(t.allTags));t.selectTag(i)}).finally(function(){return t.isSaving=!1}))},n}();t.$inject=["tagApi"];n.TagEditorController=t;n.App.controller("TagEditorController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r){var u=this;this.songApi=t;this.albumCache=i;this.audioPlayer=r;this.songsList=new n.PagedList(function(n,t){return u.songApi.getTrendingSongs(n,t)},undefined,function(n){return u.calcVisibleSongs(n)});this.visibleSongs=[];this.visibleStart=0;this.songsList.fetchNextChunk()}return Object.defineProperty(t.prototype,"canGoPrevious",{get:function(){return this.visibleStart>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canGoNext",{get:function(){return this.songsList.itemsTotalCount!==null&&this.visibleStart<this.songsList.itemsTotalCount-1},enumerable:!0,configurable:!0}),t.prototype.calcVisibleSongs=function(n){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return this.visibleSongs=n.slice(this.visibleStart,this.visibleStart+t.maxVisibleSongs),this.visibleSongs.length<t.maxVisibleSongs&&this.songsList.fetchNextChunk(),[4,this.albumCache.getAlbumsForSongs(this.visibleSongs)];case 1:return i=r.sent(),this.visibleSongs.forEach(function(n){var t=i.find(function(t){return t.artist===n.artist&&t.name===n.album});t&&n.updateAlbumArtColors(t)}),[2]}})})},t.prototype.next=function(){this.canGoNext&&(this.visibleStart++,this.calcVisibleSongs(this.songsList.items))},t.prototype.previous=function(){this.canGoPrevious&&(this.visibleStart--,this.calcVisibleSongs(this.songsList.items))},t.prototype.playSong=function(n){this.audioPlayer.playSongById(n.id)},t}();t.maxVisibleSongs=5;t.$inject=["songApi","albumCache","audioPlayer"];n.TrendingController=t;n.App.controller("TrendingController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r,u,f){var e=this;this.albumApi=i;this.appNav=r;this.$scope=u;this.$sce=f;this.albumName="";this.songs=[];this.isUploading=!1;this.albumArt=null;this.purchaseUrl="";this.genre="";this.allGenres=["Messianic Jewish","Hebrew Roots","Jewish Christian","Jewish","Christian"];this.artist=null;this.allArtists=[];this.foreColor=n.Song.defaultSwatch.getBodyTextColor();this.backColor=n.Song.defaultSwatch.getHex();this.mutedColor=n.Song.defaultSwatch.getHex();this.textShadowColor=n.Song.defaultSwatch.getBodyTextColor();this.allAlbumSwatches=[];t.getAll().then(function(n){return e.allArtists=n.items})}return t.prototype.chooseSongs=function(){var i=this,n;filepicker.setKey(t.filePickerKey);n={extension:".mp3"};filepicker.pickMultiple(n,function(n){return i.songsChosen(n)},function(n){return console.log("Upload failed.",n)})},t.prototype.songsChosen=function(n){var i=this;n.forEach(function(n){n.trustedUrl=i.$sce.trustAsResourceUrl(n.url);n.friendlyName=t.songNameFromFileName(n.filename)});n.sort(function(n,t){return n.filename<t.filename?-1:n.filename>t.filename?1:0});this.songs=this.songs.concat(n);this.$scope.$applyAsync()},t.prototype.chooseAlbumArt=function(){var i=this,n;filepicker.setKey(t.filePickerKey);n={extensions:[".jpg",".png"]};filepicker.pick(n,function(n){return i.albumArtChosen(n)},function(n){return console.log("Album art pick failed.",n)})},t.prototype.albumArtChosen=function(n){this.albumArt=n;this.fetchAlbumColorSwatches(n);this.$scope.$applyAsync()},t.prototype.fetchAlbumColorSwatches=function(i){var r=this,u;i.url&&(u=document.createElement("img"),u.src="/api/albums/art/imageOnDomain?imageUrl="+encodeURIComponent(i.url),u.addEventListener("load",function(){var f=new Vibrant(u,64,5),i=f.swatches();i&&(r.allAlbumSwatches=t.getFriendlySwatches(i),r.backColor=(i.DarkVibrant||i.DarkMuted||n.Song.defaultSwatch).getHex(),r.foreColor=(i.LightVibrant||i.Vibrant||n.Song.defaultSwatch).getHex(),r.mutedColor=(i.DarkMuted||i.DarkVibrant||i.Vibrant||n.Song.defaultSwatch).getBodyTextColor(),r.textShadowColor=(i.DarkMuted||i.DarkVibrant||n.Song.defaultSwatch).getHex(),r.$scope.$applyAsync())}))},t.prototype.moveSongUp=function(n){var t=this.songs.indexOf(n),i;t>0&&(i=t-1,this.songs.splice(t,1),this.songs.splice(i,0,n))},t.prototype.moveSongDown=function(n){var t=this.songs.indexOf(n),i;t<this.songs.length-1&&(i=t+1,this.songs.splice(t,1),this.songs.splice(i,0,n))},t.prototype.removeSong=function(n){var t=this.songs.indexOf(n);t>=0&&this.songs.splice(t,1)},t.songNameFromFileName=function(n){var t=n,r=t.lastIndexOf("."),i;return r>0&&(t=t.substring(0,r)),i=t.lastIndexOf(" - "),i>=0&&(t=t.substr(i+3)),t},t.filePickerSongToAlbumSong=function(n){return{fileName:n.friendlyName,address:n.url}},t.getFriendlySwatches=function(n){return Object.getOwnPropertyNames(n).filter(function(t){return!!n[t]}).map(function(t){var i=n[t];return{name:t,color:i.getHex(),titleTextColor:i.getTitleTextColor(),bodyTextColor:i.getBodyTextColor()}})},t.prototype.hexToRgbString=function(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t&&t.length>=4?"rgb("+parseInt(t[1],16)+", "+parseInt(t[2],16)+", "+parseInt(t[3],16)+")":""},t.prototype.artistSelected=function(n){this.artist=angular.copy(n)},t.prototype.upload=function(){var i=this,n;if(!this.albumArt||!this.albumArt.url)throw new Error("Must have album art.");if(!this.albumName)throw new Error("Must have album name.");if(!this.artist)throw new Error("Must have an artist");this.isUploading||(n={albumArtUri:this.albumArt.url,artist:this.artist.name,backColor:this.backColor,foreColor:this.foreColor,genres:this.genre,mutedColor:this.mutedColor,name:this.albumName,purchaseUrl:this.purchaseUrl,songs:this.songs?this.songs.map(t.filePickerSongToAlbumSong):[],textShadowColor:this.textShadowColor},this.isUploading=!0,this.albumApi.upload(n).then(function(){return i.appNav.editAlbum(n.artist,n.name)}).finally(function(){return i.isUploading=!1}))},t}();t.filePickerKey="AwdRIarCGT8COm0mkYX1Ez";t.$inject=["artistApi","albumApi","appNav","$scope","$sce"];n.UploadAlbumController=t;n.App.controller("UploadAlbumController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.fetcher=n;this.cacheKey=t;this.cacheSelector=i;this.afterLoadProcessor=r;this.items=[];this.hasLoaded=!1;this.isLoading=!1;this.noItemsText="There are no results";t&&this.rehydrateCachedItems(t,i)}return n.prototype.reset=function(){this.items.length=0;this.isLoading=!1},n.prototype.resetAndFetch=function(){this.reset();this.fetch()},n.prototype.fetch=function(){var n=this,t;return this.isLoading?null:(this.isLoading=!0,this.hasLoaded=!1,t=this.fetcher(),t.then(function(t){n.isLoading&&(n.items=t,n.afterLoadProcessor&&n.afterLoadProcessor(t),n.cacheKey&&setTimeout(function(){return n.cacheItems(n.cacheKey,t)},0));n.hasLoaded=!0}).finally(function(){return n.isLoading=!1}),t)},n.prototype.remove=function(n){var t=this.items.length,i=_.pull(this.items,n);return t>i.length},n.prototype.cache=function(){this.cacheKey&&this.cacheItems(this.cacheKey,this.items)},n.prototype.rehydrateCachedItems=function(n,t){var i,r;try{i=window.localStorage.getItem(n);i&&(r=JSON.parse(i),this.items=t?r.map(function(n){return t(n)}):r,this.afterLoadProcessor&&this.afterLoadProcessor(this.items))}catch(u){console.log("Failed to rehydrated cached items for cacheKey",n,u)}},n.prototype.cacheItems=function(n,t){try{var i=JSON.stringify(t);window.localStorage.setItem(n,i)}catch(r){console.log("Unable to cache list of items with cache key",n,t,r)}},Object.defineProperty(n.prototype,"isLoadedWithData",{get:function(){return this.hasLoaded&&!this.isLoading&&this.itemsTotalCount>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoadedAndEmpty",{get:function(){return this.itemsTotalCount===0&&!this.isLoading},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"itemsTotalCount",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),n}();n.List=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){this.fetcher=n;this.cacheKey=t;this.afterFetch=i;this.skip=0;this.take=10;this.items=[];this.isLoading=!1;this.noItemsText="There are no results";t&&this.rehydrateCachedItems(t)}return n.prototype.reset=function(){this.skip=0;this.items.length=0;this.itemsTotalCount=null;this.isLoading=!1},n.prototype.resetAndFetch=function(){this.reset();this.fetchNextChunk()},n.prototype.fetchNextChunk=function(){var n=this,t;this.isLoading||(this.isLoading=!0,t=this.skip,this.fetcher(t,this.take).then(function(i){var r,u;n.isLoading&&(r=n.cacheKey,r&&t===0&&(n.items.length=0,n.cacheItems(r,i.items)),(u=n.items).push.apply(u,i.items),n.itemsTotalCount=i.total,n.skip+=i.items.length,n.afterFetch&&n.afterFetch(n.items))}).finally(function(){return n.isLoading=!1}))},n.prototype.rehydrateCachedItems=function(n){try{var t=window.localStorage.getItem(n);t&&(this.items=JSON.parse(t),this.afterFetch&&this.afterFetch(this.items))}catch(i){console.log("Failed to rehydrated cached items for cacheKey",n,i)}},n.prototype.cacheItems=function(n,t){try{var i=JSON.stringify(t);window.localStorage.setItem(n,i)}catch(r){console.log("Unable to cache list of items with cache key",n,t,r)}},Object.defineProperty(n.prototype,"isLoadedWithData",{get:function(){return this.itemsTotalCount!=null&&this.itemsTotalCount>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoadedAndEmpty",{get:function(){return this.itemsTotalCount===0&&!this.isLoading},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hasMoreItems",{get:function(){return this.itemsTotalCount!=null&&this.itemsTotalCount>this.items.length},enumerable:!0,configurable:!0}),n}();n.PagedList=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={}));