var BitShuva;Array.prototype.includes||(Array.prototype.includes=function(n){"use strict";var f=Object(this),u=parseInt(f.length)||0,i,t,r;if(u===0)return!1;for(i=parseInt(arguments[1])||0,i>=0?t=i:(t=u+i,t<0&&(t=0));t<u;){if(r=f[t],n===r||n!==n&&r!==r)return!0;t++}return!1});Array.prototype.find||(Array.prototype.find=function(n){var t;if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof n!="function")throw new TypeError("predicate must be a function");var i=Object(this),u=i.length>>>0,f=arguments[1],r;for(t=0;t<u;t++)if(r=i[t],n.call(f,r,t,i))return r;return undefined});window.Modernizr=function(n,t,i){function y(n){k.cssText=n}function u(n,t){return typeof n===t}function tt(n,t){return!!~(""+n).indexOf(t)}function p(n,t){var u,r;for(u in n)if(r=n[u],!tt(r,"-")&&k[r]!==i)return t=="pfx"?r:!0;return!1}function it(n,t,r){var e,f;for(e in n)if(f=t[n[e]],f!==i)return r===!1?n[e]:u(f,"function")?f.bind(r||t):f;return!1}function w(n,t,i){var r=n.charAt(0).toUpperCase()+n.slice(1),f=(n+" "+g.join(r+" ")+r).split(" ");return u(t,"string")||u(t,"undefined")?p(f,t):(f=(n+" "+nt.join(r+" ")+r).split(" "),it(f,t,i))}var r={},s=!0,h=t.documentElement,b=t.createElement("modernizr"),k=b.style,rt,ft={}.toString,d="Webkit Moz O ms",g=d.split(" "),nt=d.toLowerCase().split(" "),f={},c=[],l=c.slice,e,a={}.hasOwnProperty,v,o;v=!u(a,"undefined")&&!u(a.call,"undefined")?function(n,t){return a.call(n,t)}:function(n,t){return t in n&&u(n.constructor.prototype[t],"undefined")};Function.prototype.bind||(Function.prototype.bind=function(n){var t=this,i,r;if(typeof t!="function")throw new TypeError;return i=l.call(arguments,1),r=function(){var f,e,u;return this instanceof r?(f=function(){},f.prototype=t.prototype,e=new f,u=t.apply(e,i.concat(l.call(arguments))),Object(u)===u?u:e):t.apply(n,i.concat(l.call(arguments)))},r});f.csstransitions=function(){return w("transition")};f.audio=function(){var i=t.createElement("audio"),n=!1;try{(n=!!i.canPlayType)&&(n=new Boolean(n),n.ogg=i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),n.mp3=i.canPlayType("audio/mpeg;").replace(/^no$/,""),n.wav=i.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),n.m4a=(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(r){}return n};for(o in f)v(f,o)&&(e=o.toLowerCase(),r[e]=f[o](),c.push((r[e]?"":"no-")+e));return r.addTest=function(n,t){if(typeof n=="object")for(var u in n)v(n,u)&&r.addTest(u,n[u]);else{if(n=n.toLowerCase(),r[n]!==i)return r;t=typeof t=="function"?t():t;typeof s!="undefined"&&s&&(h.className+=" "+(t?"":"no-")+n);r[n]=t}return r},y(""),b=rt=null,function(n,t){function v(n,t){var i=n.createElement("p"),r=n.getElementsByTagName("head")[0]||n.documentElement;return i.innerHTML="x<style>"+t+"<\/style>",r.insertBefore(i.lastChild,r.firstChild)}function s(){var n=r.elements;return typeof n=="string"?n.split(" "):n}function u(n){var t=a[n[l]];return t||(t={},o++,n[l]=o,a[o]=t),t}function h(n,r,f){if(r||(r=t),i)return r.createElement(n);f||(f=u(r));var e;return e=f.cache[n]?f.cache[n].cloneNode():b.test(n)?(f.cache[n]=f.createElem(n)).cloneNode():f.createElem(n),e.canHaveChildren&&!w.test(n)&&!e.tagUrn?f.frag.appendChild(e):e}function y(n,r){if(n||(n=t),i)return n.createDocumentFragment();r=r||u(n);for(var e=r.frag.cloneNode(),f=0,o=s(),h=o.length;f<h;f++)e.createElement(o[f]);return e}function p(n,t){t.cache||(t.cache={},t.createElem=n.createElement,t.createFrag=n.createDocumentFragment,t.frag=t.createFrag());n.createElement=function(i){return r.shivMethods?h(i,n,t):t.createElem(i)};n.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+s().join().replace(/[\w\-]+/g,function(n){return t.createElem(n),t.frag.createElement(n),'c("'+n+'")'})+");return n}")(r,t.frag)}function c(n){n||(n=t);var f=u(n);return r.shivCSS&&!e&&!f.hasCSS&&(f.hasCSS=!!v(n,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),i||p(n,f),n}var f=n.html5||{},w=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,b=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,e,l="_html5shiv",o=0,a={},i,r;(function(){try{var n=t.createElement("a");n.innerHTML="<xyz><\/xyz>";e="hidden"in n;i=n.childNodes.length==1||function(){t.createElement("a");var n=t.createDocumentFragment();return typeof n.cloneNode=="undefined"||typeof n.createDocumentFragment=="undefined"||typeof n.createElement=="undefined"}()}catch(r){e=!0;i=!0}})();r={elements:f.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:"3.7.0",shivCSS:f.shivCSS!==!1,supportsUnknownElements:i,shivMethods:f.shivMethods!==!1,type:"default",shivDocument:c,createElement:h,createDocumentFragment:y};n.html5=r;c(t)}(this,t),r._version="2.7.1",r._domPrefixes=nt,r._cssomPrefixes=g,r.testProp=function(n){return p([n])},r.testAllProps=w,h.className=h.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(s?" js "+c.join(" "):""),r}(this,this.document),function(n,t,i){function h(n){return"[object Function]"==y.call(n)}function c(n){return"string"==typeof n}function l(){}function w(n){return!n||"loaded"==n||"complete"==n||"uninitialized"==n}function f(){var n=a.shift();v=1;n?n.t?s(function(){("c"==n.t?u.injectCss:u.injectJs)(n.s,0,n.a,n.x,n.e,1)},0):(n(),f()):v=0}function ut(n,i,o,h,c,l,y){function k(t){if(!nt&&w(p.readyState)&&(tt.r=nt=1,!v&&f(),p.onload=p.onreadystatechange=null,t)){"img"!=n&&s(function(){g.removeChild(p)},50);for(var u in r[i])r[i].hasOwnProperty(u)&&r[i][u].onload()}}var y=y||u.errorTimeout,p=t.createElement(n),nt=0,b=0,tt={t:o,s:i,e:c,a:l,x:y};1===r[i]&&(b=1,r[i]=[]);"object"==n?p.data=i:(p.src=i,p.type=n);p.width=p.height="0";p.onerror=p.onload=p.onreadystatechange=function(){k.call(this,b)};a.splice(h,0,tt);"img"!=n&&(b||2===r[i]?(g.insertBefore(p,d?null:e),s(k,y)):r[i].push(p))}function ft(n,t,i,r,u){return v=0,t=t||"j",c(n)?ut("c"==t?et:nt,n,t,this.i++,i,r,u):(a.splice(this.i++,0,n),1==a.length&&f()),this}function b(){var n=u;return n.loader={load:ft,i:0},n}var o=t.documentElement,s=n.setTimeout,e=t.getElementsByTagName("script")[0],y={}.toString,a=[],v=0,k="MozAppearance"in o.style,d=k&&!!t.createRange().compareNode,g=d?o:e.parentNode,o=n.opera&&"[object Opera]"==y.call(n.opera),o=!!t.attachEvent&&!o,nt=k?"object":o?"script":"img",et=o?"script":nt,tt=Array.isArray||function(n){return"[object Array]"==y.call(n)},p=[],r={},it={timeout:function(n,t){return t.length&&(n.timeout=t[0]),n}},rt,u;u=function(n){function a(n){for(var n=n.split("!"),f=p.length,i=n.pop(),e=n.length,i={url:i,origUrl:i,prefixes:n},u,r,t=0;t<e;t++)r=n[t].split("="),(u=it[r.shift()])&&(i=u(i,r));for(t=0;t<f;t++)i=p[t](i);return i}function f(n,t,u,f,e){var o=a(n),s=o.autoCallback;o.url.split(".").pop().split("?").shift();o.bypass||(t&&(t=h(t)?t:t[n]||t[f]||t[n.split("/").pop().split("?")[0]]),o.instead?o.instead(n,t,u,f,e):(r[o.url]?o.noexec=!0:r[o.url]=1,u.load(o.url,o.forceCSS||!o.forceJS&&"css"==o.url.split(".").pop().split("?").shift()?"c":i,o.noexec,o.attrs,o.timeout),(h(t)||h(s))&&u.load(function(){b();t&&t(o.origUrl,e,f);s&&s(o.origUrl,e,f);r[o.url]=2})))}function s(n,t){function a(n,o){if(n){if(c(n))o||(i=function(){var n=[].slice.call(arguments);s.apply(this,n);u()}),f(n,i,t,0,e);else if(Object(n)===n)for(r in v=function(){var t=0;for(var i in n)n.hasOwnProperty(i)&&t++;return t}(),n)n.hasOwnProperty(r)&&(!o&&!--v&&(h(i)?i=function(){var n=[].slice.call(arguments);s.apply(this,n);u()}:i[r]=function(n){return function(){var t=[].slice.call(arguments);n&&n.apply(this,t);u()}}(s[r])),f(n[r],i,t,r,e))}else o||u()}var e=!!n.test,o=n.load||n.both,i=n.callback||l,s=i,u=n.complete||l,v,r;a(e?n.yep:n.nope,!!o);o&&a(o)}var e,t,o=this.yepnope.loader;if(c(n))f(n,0,o,0);else if(tt(n))for(e=0;e<n.length;e++)t=n[e],c(t)?f(t,0,o,0):tt(t)?u(t):Object(t)===t&&s(t,o);else Object(n)===n&&s(n,o)};u.addPrefix=function(n,t){it[n]=t};u.addFilter=function(n){p.push(n)};u.errorTimeout=1e4;null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",rt=function(){t.removeEventListener("DOMContentLoaded",rt,0);t.readyState="complete"},0));n.yepnope=b();n.yepnope.executeStack=f;n.yepnope.injectJs=function(n,i,r,o,h,c){var a=t.createElement("script"),v,y,o=o||u.errorTimeout;a.src=n;for(y in r)a.setAttribute(y,r[y]);i=c?f:i||l;a.onreadystatechange=a.onload=function(){!v&&w(a.readyState)&&(v=1,i(),a.onload=a.onreadystatechange=null)};s(function(){v||(v=1,i(1))},o);h?a.onload():e.parentNode.insertBefore(a,e)};n.yepnope.injectCss=function(n,i,r,u,o,h){var u=t.createElement("link"),c,i=h?f:i||l;u.href=n;u.rel="stylesheet";u.type="text/css";for(c in r)u.setAttribute(c,r[c]);o||(e.parentNode.insertBefore(u,e),s(i,0))}}(this,document);Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};String.prototype.includes||(String.prototype.includes=function(){"use strict";return String.prototype.indexOf.apply(this,arguments)!==-1});String.prototype.endsWith||(String.prototype.endsWith=function(n,t){var i=this.toString(),r;return(t===undefined||t>i.length)&&(t=i.length),t!==undefined&&t!==null&&(t-=n.length),r=i.indexOf(n,t),r!==-1&&r===t});String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return t=t||0,this.lastIndexOf(n,t)===t});String.prototype.repeat||(String.prototype.repeat=function(n){"use strict";var t,i;if(this==null)throw new TypeError("can't convert "+this+" to object");if(t=""+this,n=+n,n!=n&&(n=0),n<0)throw new RangeError("repeat count must be non-negative");if(n==Infinity)throw new RangeError("repeat count must be less than infinity");if(n=Math.floor(n),t.length==0||n==0)return"";if(t.length*n>=268435456)throw new RangeError("repeat count must not overflow maximum string size");for(i=t.length*n,n=Math.floor(Math.log(n)/Math.log(2));n;)t+=t,n--;return t+t.substring(0,i-t.length)}),function(n){var t;(function(n){var t=function(){function n(){}return n.OneWay="<",n.TwoWay="=",n.Text="@",n.Output="&",n}();n.AngularBindings=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.fetcher=n;this.cacheKey=t;this.cacheSelector=i;this.afterLoadProcessor=r;this.items=[];this.hasLoaded=!1;this.isLoading=!1;this.noItemsText="There are no results";t&&this.rehydrateCachedItems(t,i)}return n.prototype.reset=function(){this.items.length=0;this.isLoading=!1},n.prototype.resetAndFetch=function(){this.reset();this.fetch()},n.prototype.fetch=function(){var n=this,t;return this.isLoading?null:(this.isLoading=!0,this.hasLoaded=!1,t=this.fetcher(),t.then(function(t){var i;n.isLoading&&(n.items.length=0,(i=n.items).push.apply(i,t),n.afterLoadProcessor&&n.afterLoadProcessor(t),n.cacheKey&&setTimeout(function(){return n.cacheItems(n.cacheKey,t)},0));n.hasLoaded=!0}).finally(function(){return n.isLoading=!1}),t)},n.prototype.remove=function(n){var t=this.items.length,i=_.pull(this.items,n);return t>i.length},n.prototype.cache=function(){this.cacheKey&&this.cacheItems(this.cacheKey,this.items)},n.prototype.rehydrateCachedItems=function(n,t){var i,r;try{i=window.localStorage.getItem(n);i&&(r=JSON.parse(i),this.items=t?r.map(function(n){return t(n)}):r,this.afterLoadProcessor&&this.afterLoadProcessor(this.items))}catch(u){console.log("Failed to rehydrated cached items for cacheKey",n,u)}},n.prototype.cacheItems=function(n,t){try{var i=JSON.stringify(t);window.localStorage.setItem(n,i)}catch(r){console.log("Unable to cache list of items with cache key",n,t,r)}},Object.defineProperty(n.prototype,"isLoadedWithData",{get:function(){return this.hasLoaded&&!this.isLoading&&this.itemsTotalCount>0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isLoadedAndEmpty",{get:function(){return this.itemsTotalCount===0&&!this.isLoading},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"itemsTotalCount",{get:function(){return this.items.length},enumerable:!1,configurable:!0}),n}();n.List=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){this.fetcher=n;this.cacheKey=t;this.afterFetch=i;this.skip=0;this.take=10;this.items=[];this.isLoading=!1;this.noItemsText="There are no results";t&&this.rehydrateCachedItems(t)}return n.prototype.reset=function(){this.skip=0;this.items.length=0;this.itemsTotalCount=null;this.isLoading=!1},n.prototype.resetAndFetch=function(){this.reset();this.fetchNextChunk()},n.prototype.refresh=function(){this.isLoading||(this.skip-=this.items.length,this.fetchNextChunk())},n.prototype.fetchNextChunk=function(){var n=this,t;this.isLoading||(this.isLoading=!0,t=this.skip,this.fetcher(t,this.take).then(function(i){var u,r;n.isLoading&&(r=n.cacheKey,r&&t===0&&(n.items.length=0,n.cacheItems(r,i.items)),(u=n.items).push.apply(u,i.items),n.itemsTotalCount=i.total,n.skip+=i.items.length,n.afterFetch&&n.afterFetch(n.items))}).finally(function(){return n.isLoading=!1}))},n.prototype.rehydrateCachedItems=function(n){try{var t=window.localStorage.getItem(n);t&&(this.items=JSON.parse(t),this.afterFetch&&this.afterFetch(this.items))}catch(i){console.log("Failed to rehydrated cached items for cacheKey",n,i)}},n.prototype.cacheItems=function(n,t){try{var i=JSON.stringify(t);window.localStorage.setItem(n,i)}catch(r){console.log("Unable to cache list of items with cache key",n,t,r)}},Object.defineProperty(n.prototype,"isLoadedWithData",{get:function(){return this.itemsTotalCount!=null&&this.itemsTotalCount>0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isLoadedAndEmpty",{get:function(){return this.itemsTotalCount===0&&!this.isLoading},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasMoreItems",{get:function(){return this.itemsTotalCount!=null&&this.itemsTotalCount>this.items.length},enumerable:!1,configurable:!0}),n}();n.PagedList=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Anonymous=0]="Anonymous";n[n.Authenticated=1]="Authenticated";n[n.Admin=2]="Admin"})(t=n.RouteAccess||(n.RouteAccess={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.isSaving=!1;angular.merge(this,n)}return n}();n.Album=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(t){this.isSaving=!1;t||(t=n.createDefaultServerObj());angular.merge(this,t)}return n.prototype.updateFrom=function(n){angular.merge(this,n)},n.createDefaultServerObj=function(){return{bio:"",images:[],name:""}},n}();n.Artist=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Paused=0]="Paused";n[n.Playing=1]="Playing";n[n.Ended=2]="Ended";n[n.Erred=3]="Erred";n[n.Stalled=4]="Stalled";n[n.Buffering=5]="Buffering";n[n.Aborted=6]="Aborted"})(t=n.AudioStatus||(n.AudioStatus={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Normal=0]="Normal";n[n.VeryPoor=1]="VeryPoor";n[n.Poor=2]="Poor";n[n.Good=3]="Good";n[n.Great=4]="Great";n[n.Best=5]="Best"})(t=n.CommunityRankStanding||(n.CommunityRankStanding={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.NowPlaying=0]="NowPlaying";n[n.Trending=1]="Trending";n[n.Top=2]="Top";n[n.Likes=3]="Likes";n[n.Other=4]="Other"})(t=n.HeaderRoute||(n.HeaderRoute={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.NotSpecified=0]="NotSpecified";n[n.Like=1]="Like";n[n.Love=2]="Love";n[n.Favorite=3]="Favorite"})(t=n.LikeLevel||(n.LikeLevel={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Trace=0]="Trace";n[n.Debug=1]="Debug";n[n.Information=2]="Information";n[n.Warning=3]="Warning";n[n.Error=4]="Error";n[n.Critical=5]="Critical";n[n.None=6]="None"})(t=n.LogLevel||(n.LogLevel={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Oldest=0]="Oldest";n[n.Newest=1]="Newest";n[n.OccurrenceCount=2]="OccurrenceCount"})(t=n.LogSort||(n.LogSort={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(){})(t=n.Server||(n.Server={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Success=0]="Success";n[n.LockedOut=1]="LockedOut";n[n.RequiresVerification=2]="RequiresVerification";n[n.Failure=3]="Failure";n[n.Pwned=4]="Pwned"})(t=n.SignInStatus||(n.SignInStatus={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.albumArtOrArtistImage="";this.isCumulativeRank=!0;this.albumSwatchDarker="black";this.albumSwatchLighter="white";this.isLyricsExpanded=!1;this.isSongStatusExpanded=!1;this.isSupportExpanded=!1;this.isShareExpanded=!1;this.isEditingLyrics=!1;this.isShowingEmbedCode=!1;this.areCommentsExpanded=!1;angular.merge(this,n);n.albumColors&&this.updateAlbumSwatchLighterDarker();this.clientId=n.id+"_"+((new Date).getTime()+Math.random())}return Object.defineProperty(t.prototype,"communityRankText",{get:function(){return this.communityRank>0?"+"+this.communityRank.toString():this.communityRank.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"communityRankStandingText",{get:function(){switch(this.communityRankStanding){case n.CommunityRankStanding.Best:return"Best";case n.CommunityRankStanding.Good:return"Good";case n.CommunityRankStanding.Great:return"Great";case n.CommunityRankStanding.Poor:return"Poor";case n.CommunityRankStanding.VeryPoor:return"Very Poor";case n.CommunityRankStanding.Normal:default:return"Average"}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nthSongText",{get:function(){return this.number===0?"1st":this.number===1?"1st":this.number===2?"2nd":this.number===3?"3rd":this.number>=4&&this.number<=19?this.number+"th":"#"+this.number},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reasonPlayedText",{get:function(){return this._reasonPlayedText||(this._reasonPlayedText=this.createReasonPlayedText()),this._reasonPlayedText},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return"/?song="+this.id.toLowerCase()},enumerable:!1,configurable:!0}),t.prototype.updateFrom=function(n){angular.merge(this,n)},t.prototype.updateAlbumSwatchLighterDarker=function(){var n=this.albumColors.background||"black",t=this.albumColors.foreground||"white",r=tinycolor(n).getBrightness(),u=tinycolor(t).getBrightness(),i=u>=r;this.albumSwatchLighter=i?t:n;this.albumSwatchDarker=i?n:t},t.empty=function(){return new t({album:"",albumId:"",albumArtUri:"",artist:"",artistId:"",communityRank:0,communityRankStanding:0,id:"songs/0",artistImages:[],genres:[],lyrics:"",name:"",number:0,purchaseUri:"",songLike:0,tags:[],totalPlays:0,uri:"",reasonsPlayed:this.createEmptySongPickReasons("songs/0"),albumColors:{background:"",foreground:"",muted:"",textShadow:""},commentCount:0})},t.prototype.setSolePickReason=function(n){this.reasonsPlayed=t.createEmptySongPickReasons(this.id);this.reasonsPlayed.soleReason=n},t.prototype.createReasonPlayedText=function(){var i="Chavah plays random songs from time to time to see what kind of music you like",t;if(this.reasonsPlayed){if(this.reasonsPlayed.soleReason!==null)switch(this.reasonsPlayed.soleReason){case n.SongPick.SomeoneRequestedSong:return"it was requested by a listener";case n.SongPick.SongFromAlbumRequested:return"you asked to hear another song from the "+this.album+" album";case n.SongPick.SongFromArtistRequested:return"you asked to hear another song from "+this.artist;case n.SongPick.SongWithTagRequested:return"you asked to hear another song with this tag";case n.SongPick.VeryPoorRank:return"...well, even the lowest-ranked songs will get played sometimes :-)";case n.SongPick.YouRequestedSong:return"you asked Chavah to play it";case n.SongPick.RandomSong:default:return i}return(t=[],this.reasonsPlayed.ranking===n.LikeLevel.Favorite?t.push("it's one of the highest ranked songs on Chavah"):this.reasonsPlayed.ranking===n.LikeLevel.Love?t.push("it's got a great community ranking"):this.reasonsPlayed.ranking===n.LikeLevel.Like&&t.push("it's got a good community ranking"),this.reasonsPlayed.artist===n.LikeLevel.Favorite?t.push(this.artist+" is one of your favorite artists"):this.reasonsPlayed.artist===n.LikeLevel.Love?t.push("you love "+this.artist+" and have thumbed-up an abundance of "+this.artist+" songs"):this.reasonsPlayed.artist===n.LikeLevel.Like&&t.push("you like "+this.artist),this.reasonsPlayed.album===n.LikeLevel.Favorite&&t.push("you like nearly all the songs on "+this.album),this.reasonsPlayed.album===n.LikeLevel.Love?t.push("you love "+this.album):this.reasonsPlayed.album===n.LikeLevel.Like&&t.push("you like "+this.album),this.reasonsPlayed.songThumbedUp&&t.push("you like this song"),this.reasonsPlayed.similar===n.LikeLevel.Favorite?t.push("it's similar to some of your favorite songs"):this.reasonsPlayed.similar===n.LikeLevel.Love?t.push("you love similiar songs"):this.reasonsPlayed.similar===n.LikeLevel.Like&&t.push("you like similiar songs"),t.length===0)?"you might like it":t.length===1?t[0]:t.length===2?t.join(" and "):(t[t.length-1]="and "+t[t.length-1],t.join(", "))}return i},t.createEmptySongPickReasons=function(t){return{album:n.LikeLevel.NotSpecified,artist:n.LikeLevel.NotSpecified,ranking:n.LikeLevel.NotSpecified,similar:n.LikeLevel.NotSpecified,songThumbedUp:!1,songId:t,soleReason:null}},t.defaultSwatch={getBodyTextColor:function(){return"black"},getHex:function(){return"white"},getHsl:function(){return"black"},getPopulation:function(){return 0},getTitleTextColor:function(){return"black"},hsl:[255,255,255],rgb:[255,255,255]},t}();n.Song=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Pending=0]="Pending";n[n.Rejected=1]="Rejected";n[n.Approved=2]="Approved"})(t=n.SongEditStatus||(n.SongEditStatus={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.Unranked=0]="Unranked";n[n.Liked=1]="Liked";n[n.Disliked=2]="Disliked"})(t=n.SongLike||(n.SongLike={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t;(function(n){n[n.RandomSong=0]="RandomSong";n[n.VeryPoorRank=1]="VeryPoorRank";n[n.PoorRank=2]="PoorRank";n[n.NormalRank=3]="NormalRank";n[n.GoodRank=4]="GoodRank";n[n.GreatRank=5]="GreatRank";n[n.BestRank=6]="BestRank";n[n.LikedArtist=7]="LikedArtist";n[n.LikedAlbum=8]="LikedAlbum";n[n.LikedSong=9]="LikedSong";n[n.LikedTag=10]="LikedTag";n[n.SongFromAlbumRequested=11]="SongFromAlbumRequested";n[n.SongFromArtistRequested=12]="SongFromArtistRequested";n[n.SongWithTagRequested=13]="SongWithTagRequested";n[n.YouRequestedSong=14]="YouRequestedSong";n[n.SomeoneRequestedSong=15]="SomeoneRequestedSong"})(t=n.SongPick||(n.SongPick={}))})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.activeOccurrenceIndex=0;this.activeCategory="Message";this.isExpanded=!1;angular.merge(this,n)}return n}();n.StructuredLog=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){angular.merge(this,n)}return Object.defineProperty(n.prototype,"isAdmin",{get:function(){return this.roles===undefined?!1:this.roles.map(function(n){return n.toLowerCase()}).includes(n.roles.admin.toLowerCase())},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"displayName",{get:function(){return this.firstName&&this.lastName?this.firstName+" "+this.lastName:this.email.substring(0,this.email.indexOf("@"))},enumerable:!1,configurable:!0}),n.prototype.updateFrom=function(n){angular.merge(this,n)},n.roles={admin:"admin"},n}();n.User=t})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){"use strict";function i(n){var t=r.cacheBustedAngularViews.find(function(t){return t.search(new RegExp(n,"i"))!==-1});if(!t)throw new Error("Unable to find cache-busted Angular view "+n);return t}function t(t,r){r===void 0&&(r=n.RouteAccess.Anonymous);var u=i(t);return{templateUrl:u,access:r}}var r,u;n.App=angular.module("ChavahApp",["ngRoute","ngAnimate","ui.bootstrap","ui.bootstrap.tpls","LocalStorageModule",]);r=window["BitShuva.Chavah.HomeViewModel"];n.App.constant("homeViewModel",r);n.App.constant("initialUser",r.user);n.FindAppView=i;u={artistList:i("/partials/ArtistList.html"),songRequestModal:i("/modals/RequestSongModal.html"),confirmDeleteSongModal:i("/modals/ConfirmDeleteSongModal.html"),songRequestResult:i("/partials/SongRequestResult.html"),headerPartial:i("/partials/Header.html"),footerPartial:i("/partials/Footer.html"),adminSidebar:i("/partials/AdminSidebar.html"),cropImageModal:i("/modals/CropImageModal.html"),pushSubscriptionSuccessful:i("/modals/PushSubscriptionSuccessful.html"),errorPlayingAudioModal:i("/modals/ErrorPlayingAudioModal.html")};n.App.constant("templatePaths",u);n.App.config(["$routeProvider","$locationProvider","$compileProvider",function(i,u,f){i.caseInsensitiveMatch=!0;u.hashPrefix("");f.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|sms|javascript):/);f.debugInfoEnabled(r.debug);i.when("/",t("/NowPlaying.html")).when("/nowplaying",{redirectTo:"/"}).when("/trending",t("/Trending.html")).when("/profile",t("/Profile.html",n.RouteAccess.Authenticated)).when("/popular",t("/Popular.html")).when("/recent",t("/Recent.html")).when("/mylikes",t("/MyLikes.html",n.RouteAccess.Authenticated)).when("/edit/songs/:id",t("/EditSong.html",n.RouteAccess.Authenticated)).when("/sharethanks/:artist?",t("/ShareThanks.html")).when("/about",t("/Legal.html")).when("/welcome",t("/Welcome.html")).when("/songeditapproved/:artist/:songName",t("/SongEditApproved.html")).when("/privacy",t("/PrivacyPolicy.html")).when("/support",t("/Support.html")).when("/maintenance",t("/Maintenance.html")).when("/promptsignin",t("/PromptSignIn.html")).when("/signin",t("/SignIn.html")).when("/password/:email",t("/Password.html")).when("/forgotpassword/:email?/:pwned?",t("/ForgotPassword.html")).when("/createpassword/:email",t("/CreatePassword.html")).when("/register/:email?",t("/Register.html")).when("/confirmemail/:email/:confirmCode",t("/ConfirmEmail.html")).when("/resetpassword/:email/:confirmCode",t("/ResetPassword.html")).when("/donate/:artist?",t("/Donate.html")).when("/donatesuccess",t("/DonateSuccess.html")).when("/donatecancelled",t("/DonateCancelled.html")).when("/admin",t("/EditSongs.html",n.RouteAccess.Admin)).when("/admin/albums",t("/Albums.html",n.RouteAccess.Admin)).when("/admin/album/upload",t("/UploadAlbum.html",n.RouteAccess.Admin)).when("/admin/album/create",t("/EditAlbum.html",n.RouteAccess.Admin)).when("/admin/album/:artist/:album",t("/EditAlbum.html",n.RouteAccess.Admin)).when("/admin/artists/:artistName?",t("/EditArtist.html",n.RouteAccess.Admin)).when("/admin/songedits",t("/ApproveSongEdits.html",n.RouteAccess.Admin)).when("/admin/tags",t("/TagEditor.html",n.RouteAccess.Admin)).when("/admin/logs",t("/LogEditor.html",n.RouteAccess.Admin)).when("/admin/songs",{redirectTo:"/admin"}).when("/admin/donations",t("/AdminDonations.html",n.RouteAccess.Admin)).when("/admin/users",t("/AdminUsers.html",n.RouteAccess.Admin)).otherwise({redirectTo:"/nowplaying"});r.isDownForMaintenance&&i.when("/",{redirectTo:"/maintenance"})}]);n.App.run(["templatePaths","accountApi","appNav","adminScripts","navigatorMediaSession","uwpNativeAudio","iOSMediaSession","$rootScope","$location","$window","$q",function(t,i,r,u,f,e,o,s,h,c,l){c.Promise=l;o.install();f.install();e.install();s.Partials=t;$(".splash").remove();s.$on("$routeChangeSuccess",function(){var n=window.ga;n&&n("send","pageview",h.path())});s.$on("$routeChangeStart",function(t,f){var e=f.$$route,o,s;if(e&&e.access!==undefined){if(o=!i.isSignedIn&&e.access!==n.RouteAccess.Anonymous,s=e.access===n.RouteAccess.Admin&&i.currentUser&&!i.currentUser.isAdmin,o||s){r.signIn();return}e.access===n.RouteAccess.Admin&&u.install()}})}]);document.addEventListener("DOMContentLoaded",function(){return FastClick.attach(document.body)},!1)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.scope=n;this.element=t;this.baseScrollHeight=0;this.textAreaElement=t[0];this.minRows=i.autoExpandingTextAreaMinRows?parseInt(i.autoExpandingTextAreaMinRows,10):1;this.applyCss(t);t.one("focus",function(){return r.storeBaseScrollHeight()});t.on("input",function(){return r.sizeHeightToContents()});t.on("$destroy",function(){return t.off("input","focus")})}return n.prototype.sizeHeightToContents=function(){var n,t;this.textAreaElement.rows=this.minRows;n=Math.ceil((this.textAreaElement.scrollHeight-this.baseScrollHeight)/16);console.log("input changed. scrollHeight, baseScrollHeight, calc:",this.textAreaElement.scrollHeight,this.baseScrollHeight,n);t=n;this.textAreaElement.rows=this.minRows+t},n.prototype.storeBaseScrollHeight=function(){var n=this.textAreaElement.value;this.textAreaElement.value="";this.baseScrollHeight=this.textAreaElement.scrollHeight;console.log("base scroll height is...",this.baseScrollHeight);this.textAreaElement.value=n},n.prototype.applyCss=function(n){n.css({display:"block","box-sizing":"padding-box",overflow:"hidden",border:"0","font-family":"sans-serif","line-height":"16.1px"})},n}(),i=function(){function n(n){this.$parse=n;this.restrict="A";this.link=this.unboundLink.bind(this)}return n.prototype.unboundLink=function(n,i,r){new t(n,i,r,this.$parse)},n}();n.App.directive("autoExpandingTextArea",["$parse",function(n){return new i(n)}])})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var i=function(){function n(n,t,i){var r=this,u;this.element=t;u=n.$eval(i.backgroundImage);n.$watch(i.backgroundImage,function(n){return r.applyBackgroundImage(n)})}return n.prototype.applyBackgroundImage=function(n){if(n){var t='url("'+n+'")';this.element.css("background-image",t)}else this.element.css("background-image","none")},n}(),t=function(){function n(){this.restrict="A";this.priority=99;this.link=this.unboundLink.bind(this)}return n.prototype.unboundLink=function(n,t,r,u){new i(n,t,r,u)},n}();n.BackgroundImageBinder=t;n.App.directive("backgroundImage",function(){return new t})})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.scope=n;this.element=t;var u=r(i.enterHandler);t.on("keydown",function(t){t.keyCode===13&&(u(n),t.preventDefault&&t.preventDefault(),n.$applyAsync())});t.on("$destroy",function(){return t.off("keydown $destroy")})}return n}(),i=function(){function n(n){this.$parse=n;this.restrict="A";this.link=this.unboundLink.bind(this)}return n.prototype.unboundLink=function(n,i,r){new t(n,i,r,this.$parse)},n}();n.App.directive("enterHandler",["$parse",function(n){return new i(n)}])})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.scope=n;this.element=t;var u=r(i.fileUploadChanged);t.on("change",function(t){u(n,{e:t});n.$applyAsync()})}return n}(),i=function(){function n(n){this.parse=n;this.restrict="A";this.link=this.unboundLink.bind(this)}return n.prototype.unboundLink=function(n,i,r){new t(n,i,r,this.parse)},n}();n.App.directive("fileUploadChanged",["$parse",function(n){return new i(n)}])})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){n.App.directive("imageCropper",function(){return{restrict:"E",scope:{src:"=",ngModel:"=",base64:"="},link:function(n,t){function u(){if(n.src&&window.Croppie){var i=new Croppie(t[0],{viewport:{width:200,height:200,type:"circle"},boundary:{width:300,height:300}});i.bind({url:n.src});t.on("update.croppie",function(){i.result("blob").then(function(t){return n.$applyAsync(function(){return n.ngModel=t})});i.result("base64").then(function(t){return n.$applyAsync(function(){return n.base64=t})})})}}var f,e,r;if(n.$watch("src",function(n){n&&u()}),window.Croppie)u();else if(f="croppieScriptInitForImageCropper",e=$("#"+f).length>0,e)$(document).on("croppieLoaded",u);else{var i=document.createElement("script");i.async=!0;i.id=f;$("body").append(i);i.onload=function(){$(document).trigger("croppieLoaded");u()};i.src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.2/croppie.min.js";r=document.createElement("link");r.setAttribute("href","https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.2/croppie.min.css");r.setAttribute("rel","stylesheet");r.setAttribute("type","text/css");document.body.appendChild(r)}}}})})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){this.scope=n;this.element=t;var f=u(i.triggerFocus);n.$watch(f,function(n){n&&r(function(){return t[0].focus()})});t.bind("blur",function(){return n.$apply(f.assign(n,!1))})}return n}(),i=function(){function n(n,t){this.$timeout=n;this.$parse=t;this.restrict="A";this.link=this.unboundLink.bind(this)}return n.prototype.unboundLink=function(n,i,r){new t(n,i,r,this.$timeout,this.$parse)},n}();n.App.directive("triggerFocus",["$timeout","$parse",function(n,t){return new i(n,t)}])})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i){this.httpApi=t;this.apiUri="/api/account";this.signedInState=new Rx.BehaviorSubject(!!i);this.currentUser=i?new n.User(i):null}return Object.defineProperty(t.prototype,"isSignedIn",{get:function(){return!!this.currentUser&&!!this.currentUser.email},enumerable:!1,configurable:!0}),t.prototype.signOut=function(){var n=this,t=this.httpApi.post(this.apiUri+"/signOut",null);return t.then(function(){n.currentUser=null;n.signedInState.onNext(!1)}),t},t.prototype.clearNotifications=function(){return this.httpApi.post(this.apiUri+"/clearNotifications",null)},t.prototype.register=function(n){return this.httpApi.post(this.apiUri+"/register",n)},t.prototype.getUserWithEmail=function(n){var t={email:n};return this.httpApi.query(this.apiUri+"/getUserWithEmail",t)},t.prototype.createPassword=function(n,t){var i={email:n,password:t};return this.httpApi.postUriEncoded(this.apiUri+"/createPassword",i)},t.prototype.signIn=function(t){var i=this,r=this.httpApi.post(this.apiUri+"/signIn",t);return r.then(function(t){if(t.status===n.SignInStatus.Success&&t.user){i.currentUser=new n.User(t.user);i.signedInState.onNext(!0);var r=window.ga;r&&r("set","userId",t.user.email)}else{i.currentUser=null;i.signedInState.onNext(!1)}}),r},t.prototype.confirmEmail=function(n,t){var i={email:n,confirmCode:t};return this.httpApi.postUriEncoded(this.apiUri+"/confirmEmail",i)},t.prototype.sendPasswordResetEmail=function(n){var t={email:n};return this.httpApi.postUriEncoded(this.apiUri+"/sendResetPasswordEmail",t)},t.prototype.resetPassword=function(n,t,i){var r={email:n,passwordResetCode:t,newPassword:i};return this.httpApi.postUriEncoded(this.apiUri+"/resetPassword",r)},t.prototype.sendSupportMessage=function(n,t,i){var r={name:n,email:t,message:i,date:(new Date).toISOString(),userAgent:window.navigator.userAgent};return this.httpApi.post(this.apiUri+"/sendSupportMessage",r)},t.prototype.resendConfirmationEmail=function(n){var t={email:n};return this.httpApi.post(this.apiUri+"/resendConfirmationEmail",t)},t.$inject=["httpApi","initialUser"],t}();n.AccountService=t;n.App.service("accountApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.audioPlayer=n;this.homeViewModel=t;this.lastAnnouncementTime=new Date}return n.prototype.hasPendingAnnouncement=function(){var n=new Date,t=n.getMinutes(),f=n.getHours(),i=t>=42&&t<=47,r=(n.valueOf()-this.lastAnnouncementTime.valueOf())/6e4,u=r>=20;return u&&i?(this.lastAnnouncementTime=n,!0):!1},n.prototype.playAdAnnouncement=function(){var n=[1,2,3,4,5],t="ad"+n[Math.floor(Math.random()*n.length)]+"x.mp3",i=this.homeViewModel.soundEffects+"/"+t;this.audioPlayer.playNewUri(i)},n.$inject=["audioPlayer","homeViewModel"],n}();n.AdAnnouncerService=t;n.App.service("adAnnouncer",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(){this.hasInstalled=!1}return n.prototype.install=function(){if(!this.hasInstalled){this.hasInstalled=!0;["https://cdnjs.cloudflare.com/ajax/libs/vibrant.js/1.0.0/Vibrant.min.js"].forEach(function(n){var t=document.createElement("script");t.type="text/javascript";t.src=n;document.body.appendChild(t)})}},n.prototype.installScript=function(n,t){return new Promise(function(i,r){t()&&i();var u=document.createElement("script");u.type="text/javascript";u.async=!0;u.src=n;u.onload=function(){return i()};u.onerror=function(n){return r(n)};document.body.appendChild(u)})},n}();n.AdminScriptsService=t;n.App.service("adminScripts",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t){this.httpApi=n;this.$q=t}return t.prototype.upload=function(n){return this.httpApi.post("/api/albums/upload",n)},t.prototype.uploadTempFile=function(n){var t=new FormData;return t.set("file",n),this.httpApi.postFormData("/api/albums/uploadTempFile",t)},t.prototype.changeArt=function(n,i){var r={albumId:n,artUri:i};return this.httpApi.postUriEncoded("/api/albums/changeArt",r,t.albumSelector)},t.prototype.get=function(n){var i={id:n};return this.httpApi.query("/api/albums/get",i,t.albumSelector)},t.prototype.getAll=function(n,i,r){var u={skip:n,take:i,search:r};return this.httpApi.query("/api/albums/getAll",u,t.albumPagedListSelector)},t.prototype.getByArtistAndAlbumName=function(n,i){var r={artist:n,album:i};return this.httpApi.query("/api/albums/getByArtistAlbum",r,t.albumSelector)},t.prototype.save=function(t){return this.httpApi.post("/api/albums/save",t,function(t){return new n.Album(t)})},t.prototype.getAlbums=function(n){var i={albumIdsCsv:n.join(",")};return this.httpApi.query("/api/albums/getAlbums",i,t.albumArraySelector)},t.prototype.getLikedAlbums=function(n,t,i){var r={skip:n,take:t,search:i};return this.httpApi.query("/api/albums/getLikedAlbums",r)},t.prototype.deleteAlbum=function(n){var t={albumId:n};return this.httpApi.postUriEncoded("/api/albums/delete",t)},t.albumSelector=function(t){return t?new n.Album(t):null},t.albumArraySelector=function(n){return n.map(function(n){return t.albumSelector(n)})},t.albumPagedListSelector=function(n){return{items:t.albumArraySelector(n.items),skip:n.skip,take:n.take,total:n.total}},t.$inject=["httpApi","$q",],t}();n.AlbumApiService=t;n.App.service("albumApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){this.templatePaths=n;this.$location=t;this.$uibModal=i;this.promptSignInUrl="#/promptsignin"}return n.prototype.signIn=function(){this.$location.url("/signin")},n.prototype.signOut=function(){this.$location.url("/nowplaying")},n.prototype.nowPlaying=function(){this.$location.url("/nowplaying")},n.prototype.promptSignIn=function(){this.$location.url("/signin")},n.prototype.register=function(n){n?this.$location.url("/register/"+encodeURIComponent(n)):this.$location.url("/register")},n.prototype.createPassword=function(n){this.$location.url("/createpassword/"+encodeURIComponent(n))},n.prototype.password=function(n){this.$location.url("/password/"+encodeURIComponent(n))},n.prototype.resetPwnedPassword=function(n){this.$location.url("/forgotpassword/"+encodeURIComponent(n)+"/true")},n.prototype.editAlbumById=function(n){this.$location.url("/admin/album/"+n)},n.prototype.editAlbum=function(n,t){var i=encodeURIComponent(n),r=encodeURIComponent(t);this.$location.url("/admin/album/"+i+"/"+r)},n.prototype.getEditSongUrl=function(n){return"/edit/"+n},n.prototype.songRequestModal=function(){return this.$uibModal.open({controller:"RequestSongController as vm",templateUrl:this.templatePaths.songRequestModal,windowClass:"request-song-modal"})},n.prototype.cropImageModal=function(n){return this.$uibModal.open({controller:"CropImageController as vm",templateUrl:this.templatePaths.cropImageModal,windowClass:"crop-image-modal",resolve:{imageFile:function(){return n}}})},n.prototype.confirmDeleteSong=function(n){return this.$uibModal.open({controller:"ConfirmDeleteSongController as vm",templateUrl:this.templatePaths.confirmDeleteSongModal,windowClass:"confirm-delete-song-modal",resolve:{song:function(){return n}}})},n.prototype.pushSubscriptionSuccessful=function(){return this.$uibModal.open({templateUrl:this.templatePaths.pushSubscriptionSuccessful})},n.prototype.showErrorPlayingAudio=function(n,t){return this.$uibModal.open({controller:"ErrorPlayingAudioController as vm",templateUrl:this.templatePaths.errorPlayingAudioModal,windowClass:"error-playing-audio-modal",resolve:{song:function(){return t},error:function(){return n}}})},n.prototype.createAlbum=function(){this.$location.url("/admin/album/create")},n.prototype.getQueryParams=function(){return this.$location.search()},n.$inject=["templatePaths","$location","$uibModal",],n}();n.AppNavService=t;n.App.service("appNav",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.httpApi=n}return t.prototype.getAll=function(n,t,i){n===void 0&&(n="");t===void 0&&(t=0);i===void 0&&(i=1024);var r={search:n,skip:t,take:i};return this.httpApi.query("/api/artists/getAll",r)},t.prototype.getByName=function(n){var i={artistName:n};return this.httpApi.query("/api/artists/getByName",i,t.artistSelector)},t.prototype.save=function(n){return this.httpApi.post("/api/artists/save",n,t.artistSelector)},t.prototype.getLikedArtists=function(n,t,i){var r={skip:n,take:t,search:i};return this.httpApi.query("/api/artists/getLikedArtists",r)},t.prototype.getDueDonations=function(n){var t={minimum:n};return this.httpApi.query("/api/artists/getDueDonations",t)},t.prototype.markDueDonationAsPaid=function(n){return this.httpApi.post("/api/artists/markDueDonationAsPaid",n)},t.prototype.recordMessiahsMusicFundMonthlyDisbursement=function(n,t,i){var r={year:n,month:t,donations:i};return this.httpApi.postUriEncoded("/api/artists/RecordMessiahsMusicFundMonthlyDisbursement",r)},t.artistSelector=function(t){return new n.Artist(t)},t.$inject=["httpApi"],t}();n.ArtistApiService=t;n.App.service("artistApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i){var r=this;this.songApi=t;this.homeViewModel=i;this.status=new Rx.BehaviorSubject(n.AudioStatus.Paused);this.song=new Rx.BehaviorSubject(null);this.songCompleted=new Rx.BehaviorSubject(null);this.playedTime=new Rx.BehaviorSubject(0);this.playedTimeText=new Rx.BehaviorSubject("");this.remainingTimeText=new Rx.BehaviorSubject("");this.playedTimePercentage=new Rx.BehaviorSubject(0);this.duration=new Rx.BehaviorSubject(0);this.playedSongs=[];this.error=new Rx.Subject;this.lastPlayedTime=0;this.song.subscribe(function(n){return r.updateDocumentTitle(n)})}return t.prototype.initialize=function(t){var i=this,r=Modernizr.audio.mp3;r&&(this.audio=t,this.audio.addEventListener("ended",function(){return i.ended()}),this.audio.addEventListener("error",function(n){return i.erred(n)}),this.audio.addEventListener("pause",function(){return i.status.onNext(n.AudioStatus.Paused)}),this.audio.addEventListener("play",function(){return i.status.onNext(n.AudioStatus.Playing)}),this.audio.addEventListener("playing",function(){return i.status.onNext(n.AudioStatus.Playing)}),this.audio.addEventListener("waiting",function(){return i.status.onNext(n.AudioStatus.Buffering)}),this.audio.addEventListener("stalled",function(n){return i.stalled(n)}),this.audio.addEventListener("timeupdate",function(n){return i.playbackPositionChanged(n)}))},t.prototype.playNewSong=function(n){var t=this.song.getValue();t&&(this.playedSongs.unshift(t),this.playedSongs.length>3&&(this.playedSongs.length=3));this.song.onNext(n);this.playNewUri(n.uri)},t.prototype.playNewUri=function(t){var r=this,i;if(this.audio&&(this.audio.src===t&&(this.audio.currentTime=0),t)){this.audio.src=t;this.audio.load();try{i=this.audio.play();i&&i.catch&&i.catch(function(t){console.log("Unable to play audio due to task error",t);r.status.onNext(n.AudioStatus.Paused)})}catch(u){console.log("Unable to play audio",u);this.status.onNext(n.AudioStatus.Paused)}}},t.prototype.playSongById=function(n){var t=this.songApi.getSongById(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongAtTrackPosition=function(n,t){var r=this,i;n&&(i=this.songApi.getSongById(n),this.playSongWhenFinishedLoading(i).then(function(i){i&&i.id===n&&(r.audio.currentTime=t)}))},t.prototype.playSongFromArtistAndAlbum=function(n,t){var i=this.songApi.getSongByArtistAndAlbum(n,t);this.playSongWhenFinishedLoading(i)},t.prototype.playSongFromArtist=function(n){var t=this.songApi.getSongByArtist(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongFromArtistId=function(n){var t=this.songApi.getSongByArtistId(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongFromAlbum=function(n){var t=this.songApi.getSongByAlbum(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongFromAlbumId=function(n){var t=this.songApi.getSongByAlbumId(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongWithTag=function(n){var t=this.songApi.getSongWithTag(n);this.playSongWhenFinishedLoading(t)},t.prototype.playSongWhenFinishedLoading=function(n){var t=this,i=this.song.getValue();return this.pause(),n.then(function(n){var r=t.song.getValue()===i;if(r){if(n)return t.playNewSong(n),n;t.resume()}return t.song.getValue()})},t.prototype.pauseSongById=function(n){var t=this;this.pause();this.songApi.getSongById(n).then(function(n){if(!n){t.resume();return}var i=t.song.getValue();i&&t.playedSongs.unshift(i);t.song.onNext(n);t.audio&&(t.audio.src=n.uri,t.audio.load(),t.audio.pause())})},t.prototype.resume=function(){this.audio&&this.audio.play()},t.prototype.pause=function(){this.audio&&this.audio.pause()},t.prototype.setVolume=function(){this.audio&&(this.audio.volume=0)},t.prototype.skipToEnd=function(){this.audio&&this.audio.duration&&(this.audio.currentTime=this.audio.duration-1)},t.prototype.aborted=function(t){this.status.onNext(n.AudioStatus.Aborted);console.log("Audio aborted",this.audio.currentSrc,t)},t.prototype.erred=function(){var t,i,r;this.status.onNext(n.AudioStatus.Erred);i=this.song.getValue();r={errorCode:((t=this.audio.error)===null||t===void 0?void 0:t.code)||null,songId:i?i.id:"",trackPosition:this.audio.currentTime,mp3Url:this.audio.src||""};this.error.onNext(r)},t.prototype.ended=function(){var t=this.song.getValue();if(this.audio&&t&&(this.audio.src===t.uri||this.audio.src===encodeURI(t.uri)))this.songCompleted.onNext(t);this.status.onNext(n.AudioStatus.Ended)},t.prototype.stalled=function(t){this.status.onNext(n.AudioStatus.Stalled);console.warn("Audio stalled, unable to stream in audio data.",this.audio.currentSrc,t)},t.prototype.playbackPositionChanged=function(){var i=this.audio.currentTime,n=isNaN(i)||!isFinite(i)?0:Math.round(i),r=n!==this.lastPlayedTime,t;if(r){this.lastPlayedTime=n;t=this.audio.duration;this.duration.onNext(isNaN(t)||!isFinite(t)?0:t);this.playedTime.onNext(n);var u=(new Date).setMinutes(0,n),f=moment(u),e=(new Date).setMinutes(0,t-n),o=moment(e);this.playedTimeText.onNext(f.format("m:ss"));this.remainingTimeText.onNext(o.format("m:ss"));this.playedTimePercentage.onNext(100/t*n)}},t.prototype.updateDocumentTitle=function(n){document.title=n?n.name+" by "+n.artist+" on "+this.homeViewModel.pageTitle:this.homeViewModel.pageTitle},t.$inject=["songApi","homeViewModel"],t}();n.AudioPlayerService=t;n.App.service("audioPlayer",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.get=function(n){var t={id:n};return this.httpApi.query("/api/commentThreads/get",t)},n.prototype.addComment=function(n,t){var i={content:n,songId:t};return this.httpApi.post("/api/commentThreads/addComment",i)},n.$inject=["httpApi"],n}();n.CommentThreadService=t;n.App.service("commentThreadApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.loadingProgress=n;this.appNav=t;this.$http=i;this.$q=r;this.apiBaseUrl=""}return n.prototype.query=function(n,t,i,r){var e=this,u,f;return t===void 0&&(t=null),r===void 0&&(r=!0),u=r?this.loadingProgress.start():this.$q.defer(),f={url:this.apiBaseUrl+n,method:"GET",params:t,headers:this.createHeaders()},this.$http(f).then(function(n){var t=i?i(n.data):n.data;u.resolve(t)},function(t){u.reject(t);e.onAjaxError(t,"Error loading "+n+".")}),u.promise},n.prototype.post=function(n,t,i,r){var e=this,u;r===void 0&&(r=!0);u=r?this.loadingProgress.start():this.$q.defer();var o=""+this.apiBaseUrl+n,s={headers:this.createHeaders()},f=this.$http.post(o,t,s);return f.then(function(n){var t=i?i(n.data):n.data;u.resolve(t)}),f.catch(function(t){e.onAjaxError(t,"Error saving "+n+".");u.reject(t)}),u.promise},n.prototype.postUriEncoded=function(n,t,i,r){var l=this,f,u,s,e,h,o;r===void 0&&(r=!0);f=r?this.loadingProgress.start():this.$q.defer();u=""+this.apiBaseUrl+n+"?";s={headers:this.createHeaders()};for(e in t){h=u.endsWith("?");u+=h?"":"&";var c=t[e],a=c?c.toString():"",v=encodeURIComponent(a);u+=e+"="+v}return o=this.$http.post(u,null,s),o.then(function(n){var t=i?i(n.data):n.data;f.resolve(t)}),o.catch(function(t){l.onAjaxError(t,"Error saving "+n+".");f.reject(t)}),f.promise},n.prototype.postFormData=function(n,t,i){var f=this,r=this.loadingProgress.start(),e=n.indexOf("?")!==-1?"&":"?",o=""+this.apiBaseUrl+n+e,s={method:"POST",url:o,data:t,headers:{"Content-Type":undefined}},u=this.$http(s);return u.then(function(n){var t=i?i(n.data):n.data;r.resolve(t)}),u.catch(function(t){f.onAjaxError(t,"Error saving "+n+".");r.reject(t)}),r.promise},n.prototype.createHeaders=function(){return{}},n.prototype.onAjaxError=function(n){n&&n.status===401&&this.appNav.signIn()},n.$inject=["loadingProgress","appNav","$http","$q",],n}();n.HttpApiService=t;n.App.service("httpApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.audioPlayer=n;this.nowPlayingInfo=null}return n.prototype.install=function(){var n=this;document.addEventListener("deviceready",function(){return n.cordovaLoaded()},!1)},n.prototype.cordovaLoaded=function(){try{this.nowPlaying=window.NowPlaying;this.nowPlaying&&this.listenForAudioEvents();this.remoteCommand=window.RemoteCommand;this.remoteCommand&&(this.setInitialNativeUIState(),this.listenForNativeUIEvents())}catch(n){console.log("Error installing iOS Cordova hooks for media session",n)}},n.prototype.listenForAudioEvents=function(){var n=this;this.nowPlaying&&(this.audioPlayer.song.distinctUntilChanged().subscribe(function(t){return n.songChanged(t)}),this.audioPlayer.status.distinctUntilChanged().subscribe(function(t){return n.songStatusChanged(t)}),this.audioPlayer.playedTime.distinctUntilChanged().subscribe(function(t){return n.songCurrentTimeChanged(t)}),this.audioPlayer.duration.distinctUntilChanged().subscribe(function(t){return n.songDurationChanged(t)}))},n.prototype.setInitialNativeUIState=function(){this.remoteCommand&&(this.remoteCommand.enabled("play",!0),this.remoteCommand.enabled("pause",!0),this.remoteCommand.enabled("nextTrack",!0),this.remoteCommand.enabled("previousTrack",!1))},n.prototype.listenForNativeUIEvents=function(){var n=this;if(this.remoteCommand){this.remoteCommand.on("play",function(){return n.audioPlayer.resume()});this.remoteCommand.on("pause",function(){return n.audioPlayer.pause()});this.remoteCommand.on("nextTrack",function(){return n.audioPlayer.skipToEnd()})}},n.prototype.songChanged=function(n){if(this.nowPlaying){var t={};n&&(t.albumTitle=n.album,t.artist=n.artist,t.title=n.hebrewName?n.name+" "+n.hebrewName:n.name,t.trackNumber=n.number,t.artwork="https://messianicradio.com/api/albums/getAlbumArtBySongId?songId="+n.id);this.nowPlayingInfo=t;this.nowPlaying.set(t)}},n.prototype.songCurrentTimeChanged=function(n){this.nowPlaying&&this.nowPlayingInfo&&(this.nowPlayingInfo.elapsedPlaybackTime=n,this.nowPlaying.set(this.nowPlayingInfo))},n.prototype.songDurationChanged=function(n){this.nowPlaying&&this.nowPlayingInfo&&(this.nowPlayingInfo.playbackDuration=n,this.nowPlaying.set(this.nowPlayingInfo))},n.prototype.songStatusChanged=function(){this.nowPlaying&&this.nowPlayingInfo&&this.nowPlaying.set(this.nowPlayingInfo)},n.$inject=["audioPlayer"],n}();n.IOSMediaSessionService=t;n.App.service("iOSMediaSession",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.dislikeSong=function(n){return this.httpApi.postUriEncoded("/api/likes/dislike",{songId:n})},n.prototype.likeSong=function(n){return this.httpApi.postUriEncoded("/api/likes/like",{songId:n})},n.prototype.setSongAsUnranked=function(n){var t={songId:n};return this.httpApi.postUriEncoded("/api/likes/setAsUnranked",t)},n.$inject=["httpApi"],n}();n.LikeApiService=t;n.App.service("likeApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.$q=n;this.resultsInProgress=0}return n.prototype.start=function(){var t=this,n=this.$q.defer();return this.loadingStarted(),n.promise.finally(function(){return t.loadingEnded()}),n},Object.defineProperty(n.prototype,"isLoading",{get:function(){return this.resultsInProgress>0},enumerable:!1,configurable:!0}),n.prototype.loadingStarted=function(){this.resultsInProgress++;this.resultsInProgress===1&&NProgress.start()},n.prototype.loadingEnded=function(){this.resultsInProgress--;this.resultsInProgress===0&&NProgress.done()},n.$inject=["$q"],n}();n.LoadingProgressService=t;n.App.service("loadingProgress",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.httpApi=n}return t.prototype.getAll=function(n,i,r,u){var f={skip:n,take:i,level:r,sort:u};return this.httpApi.query("/api/logs/getAll",f,t.pagedListSelector)},t.prototype.deleteLog=function(n){var t={id:n};return this.httpApi.postUriEncoded("/api/logs/delete",t)},t.pagedListSelector=function(t){return{skip:t.skip,take:t.take,total:t.total,items:t.items.map(function(t){return new n.StructuredLog(t)})}},t.$inject=["httpApi"],t}();n.LogService=t;n.App.service("logApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.audioPlayer=n}return t.prototype.install=function(){try{var n="mediaSession"in navigator;n&&(this.mediaSession=navigator.mediaSession,this.listenForUIEvents(),this.listenForAudioEvents())}catch(t){console.log("Unable to install navigator media session",t)}},t.prototype.listenForUIEvents=function(){var n=this;this.mediaSession&&(this.mediaSession.setActionHandler("play",function(){return n.audioPlayer.resume()}),this.mediaSession.setActionHandler("pause",function(){return n.audioPlayer.pause()}),this.mediaSession.setActionHandler("nexttrack",function(){return n.audioPlayer.skipToEnd()}))},t.prototype.listenForAudioEvents=function(){var n=this;this.mediaSession&&(this.audioPlayer.song.distinctUntilChanged().subscribe(function(t){return n.songChanged(t)}),this.audioPlayer.status.distinctUntilChanged().subscribe(function(t){return n.audioStatusChanged(t)}))},t.prototype.audioStatusChanged=function(t){if(this.mediaSession)try{switch(t){case n.AudioStatus.Paused:this.mediaSession.playbackState="paused";break;case n.AudioStatus.Playing:this.mediaSession.playbackState="playing";break;default:this.mediaSession.playbackState="none"}}catch(i){console.log("Unable to set media session playback state",i)}},t.prototype.songChanged=function(n){if(this.mediaSession){var t={title:"",artist:"",album:"",artwork:[]};n&&(t.album=n.album,t.artist=n.artist,t.title=n.hebrewName?n.name+" "+n.hebrewName:n.name,t.artwork.push({src:n.albumArtUri,sizes:"any",type:"image/jpeg"}));try{this.mediaSession.metadata=new window.MediaMetadata(t)}catch(i){console.log("unable to set mediaSession metadata",i)}}},t.$inject=["audioPlayer"],t}();n.NavigatorMediaSessionService=t;n.App.service("navigatorMediaSession",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){this.homeViewModel=n;this.httpApi=t;this.$q=i}return n.prototype.isSupported=function(){var n=this.$q.defer();return this.getPushManager().then(function(t){return n.resolve(!!t)}).catch(function(){return n.resolve(!1)}),n.promise},n.prototype.getStatus=function(){var n=this;return this.getPushManager().then(function(t){return n.getPermissionStateFromManager(t)})},n.prototype.canSubscribe=function(){var n=this.$q.defer();return this.$q.all([this.getStatus(),this.getExistingPushSubscription()]).then(function(t){return n.resolve(t[0]!=="denied"&&!t[1])}).catch(function(){return n.resolve(!1)}),n.promise},n.prototype.isSubscribed=function(){return this.getExistingPushSubscription().then(function(n){return!!n})},n.prototype.askPermission=function(){var n=this.$q.defer(),t=Notification.requestPermission(function(t){return n.resolve(t)});return t&&t.then(function(t){return n.resolve(t)}).catch(function(t){return n.reject(t)}),n.promise},n.prototype.subscribe=function(){var n=this;return this.getSvcWorkerRegistration().then(function(t){return n.createSubscription(t)}).then(function(t){return n.storePushNotificationSubscription(t)})},n.prototype.unsubscribe=function(){var n=this;return this.getExistingPushSubscription().then(function(t){return n.unsubscribeAndDelete(t)})},n.prototype.getExistingPushSubscription=function(){var n=this;return this.getPushManager().then(function(t){return n.getSubscriptionFromPushManager(t)})},n.prototype.unsubscribeAndDelete=function(n){var i=this,t=this.$q.defer();return n?n.unsubscribe().then(function(r){t.resolve(r);i.deleteSubscription(n)}).catch(function(n){return t.reject(n)}):t.reject("No subscription"),t.promise},n.prototype.deleteSubscription=function(n){this.httpApi.post("/api/pushnotifications/delete",n)},n.prototype.getSubscriptionFromPushManager=function(n){var t=this.$q.defer();return n?n.getSubscription().then(function(n){return t.resolve(n)}).catch(function(n){return t.resolve(n)}):t.reject("No push manager"),t.promise},n.prototype.storePushNotificationSubscription=function(n){if(n)return this.httpApi.post("/api/pushnotifications/store",n);return this.$q.reject("No subscription")},n.prototype.createSubscription=function(n){var t=this.$q.defer(),i;return n?(i={userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.homeViewModel.pushNotificationsPublicKey)},n.pushManager.subscribe(i).then(function(n){return t.resolve(n)}).catch(function(n){return t.reject(["Unable to subscribe to push notifications",n,Notification?Notification.permission:""])})):t.reject("No registration"),t.promise},n.prototype.getSvcWorkerRegistration=function(){var n=this.$q.defer();return navigator.serviceWorker?navigator.serviceWorker.ready.then(function(t){return n.resolve(t||null)}).catch(function(t){return n.reject(t)}):n.reject("No service worker"),n.promise},n.prototype.getPushManager=function(){var n=this.$q.defer();return this.getSvcWorkerRegistration().then(function(t){return n.resolve(t&&t.pushManager?t.pushManager:null)}).catch(function(t){return n.reject(t)}),n.promise},n.prototype.getPermissionStateFromManager=function(n){var t=this.$q.defer();return n?n.permissionState().then(function(n){return t.resolve(n)}).catch(function(){return t.resolve("prompt")}):t.reject("No push manager"),t.promise},n.prototype.urlBase64ToUint8Array=function(n){for(var u="=".repeat((4-n.length%4)%4),f=(n+u).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(f),r=new Uint8Array(i.length),t=0;t<i.length;++t)r[t]=i.charCodeAt(t);return r},n.$inject=["homeViewModel","httpApi","$q"],n}();n.PushNotificationService=t;n.App.service("pushNotifications",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(){var n=this;this.deferredInstallPrompt=null;this.hasShownPrompt=!1;window.addEventListener("beforeinstallprompt",function(t){t.preventDefault();n.deferredInstallPrompt=t})}return Object.defineProperty(n.prototype,"canInstall",{get:function(){return!!this.deferredInstallPrompt&&!this.hasShownPrompt},enumerable:!1,configurable:!0}),n.prototype.install=function(){return this.canInstall&&!!this.deferredInstallPrompt?(this.deferredInstallPrompt.prompt(),this.deferredInstallPrompt.userChoice):null},n}();n.PwaInstallService=t;n.App.service("pwaInstall",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.homeViewModel=n}return n.prototype.shareUrl=function(n){return this.homeViewModel.defaultUrl+"/?song="+n},n.prototype.getEmbedCode=function(n){return'<iframe loading="lazy" style="border-top: medium none; height: 558px; border-right: medium none; width: 350px; border-bottom: medium none; border-left: medium none" src="'+this.homeViewModel.defaultUrl+"/home/embed?song="+n+'" scrolling="none"><\/iframe>'},n.prototype.facebookShareUrl=function(n){var t=this.getSongName(n),i=(t+" by "+n.artist).replace(new RegExp("&","g"),"and"),r=this.homeViewModel.defaultUrl+"/?song="+n.id,u=this.homeViewModel.defaultUrl+"/api/albums/getAlbumArtBySongId?songId="+n.id;return"https://www.facebook.com/dialog/feed?app_id=256833604430846&link="+r+("&picture="+encodeURIComponent(u))+("&name="+encodeURIComponent(i))+("&description="+encodeURIComponent("On "+n.album))+("&caption="+encodeURIComponent("Courtesy of Chavah Messianic Radio - The very best Messianic Jewish and Hebrew Roots music"))+("&redirect_uri="+encodeURIComponent(this.homeViewModel.defaultUrl+"/#/sharethanks"))},n.prototype.twitterShareUrl=function(n){var t=this.getSongName(n),i="Listening to "+t+" by "+n.artist,r=this.homeViewModel.defaultUrl+"/?song="+n.id;return"https://twitter.com/share?text="+encodeURIComponent(i)+"&url="+encodeURIComponent(r)+"&via="+encodeURIComponent("messianicradio")},n.prototype.smsShareUrl=function(n){var i=this.getSongName(n),r=this.homeViewModel.defaultUrl+"/?song="+n.id,t=encodeURIComponent(i+" by "+n.artist+" "+r);return this.isOnIOS()?"sms:&body="+t:"sms:?body="+t},n.prototype.whatsAppShareUrl=function(n){var t=this.getSongName(n),i=this.homeViewModel.defaultUrl+"/?song="+n.id,r=encodeURIComponent(t+" by "+n.artist+" "+i);return"https://wa.me/?text="+r},Object.defineProperty(n.prototype,"canNativeShare",{get:function(){return!!navigator.share},enumerable:!1,configurable:!0}),n.prototype.nativeShare=function(n){navigator.share&&this.tryShareWeb(n)},n.prototype.tryShareWeb=function(n){if(navigator.share){var t=this.getSongName(n);try{navigator.share({title:t+" by "+n.artist,text:"on Chavah Messianic Radio",url:this.homeViewModel.defaultUrl+"/?song="+n.id}).catch(function(n){return console.log("Native shared failed",n)})}catch(i){console.log("Unable to trigger navigator.share",i)}}},n.prototype.getShareData=function(n){return{title:this.getSongName(n)+" by "+n.artist,text:"via "+this.homeViewModel.pageTitle,url:this.homeViewModel.defaultUrl+"/?song="+n.id}},n.prototype.getSongName=function(n){return[n.hebrewName,n.name].filter(function(n){return!!n}).join(" ")},n.prototype.isOnIOS=function(){var n=navigator.userAgent.toLowerCase();return n.indexOf("iphone")>-1||n.indexOf("ipad")>-1},n.$inject=["homeViewModel"],n}();n.SharingService=t;n.App.service("sharing",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t){this.httpApi=n;this.$q=t}return t.prototype.chooseSong=function(){return this.httpApi.query("/api/songs/chooseSong",null,t.songConverter)},t.prototype.chooseSongBatch=function(){return this.httpApi.query("/api/songs/chooseSongBatch",null,t.songListConverter)},t.prototype.getSongById=function(n,i){var r=this.httpApi.query("/api/songs/getById",{songId:n},t.songOrNullConverter);return i!=null&&r.then(function(n){n&&n.setSolePickReason(i)}),r},t.prototype.getSongByArtistAndAlbum=function(n,i){var r={artist:n,album:i};return this.httpApi.query("/api/songs/getByArtistAndAlbum",r,t.songOrNullConverter)},t.prototype.getSongByAlbum=function(n){var i={album:n};return this.httpApi.query("/api/songs/getByAlbum/",i,t.songOrNullConverter)},t.prototype.getSongByAlbumId=function(n){var i={albumId:n};return this.httpApi.query("/api/songs/getByAlbumId/",i,t.songOrNullConverter)},t.prototype.getSongWithTag=function(n){var i={tag:n};return this.httpApi.query("/api/songs/getByTag",i,t.songOrNullConverter)},t.prototype.getSongByArtist=function(n){var i={artist:n};return this.httpApi.query("/api/songs/getByArtist",i,t.songOrNullConverter)},t.prototype.getSongByArtistId=function(n){var i={artistId:n};return this.httpApi.query("/api/songs/getByArtistId/",i,t.songOrNullConverter)},t.prototype.getSongMatches=function(n){var i={searchText:n};return this.httpApi.query("/api/songs/search",i,t.songListConverter)},t.prototype.getTrendingSongs=function(n,i){var r={skip:n,take:i};return this.httpApi.query("/api/songs/getTrending",r,t.songPagedListConverter)},t.prototype.getRandomPopular=function(n){var i={count:n};return this.httpApi.query("/api/songs/getRandomPopular",i,t.songListConverter)},t.prototype.getPopular=function(n,i){var r={skip:n,take:i};return this.httpApi.query("/api/songs/getpopular",r,t.songPagedListConverter)},t.prototype.getRandomLikedSongs=function(n){var i={count:n};return this.httpApi.query("/api/songs/getRandomLikedSongs",i,t.songListConverter)},t.prototype.getLikes=function(n,i,r){var u={skip:n,take:i,search:r};return this.httpApi.query("/api/songs/getLikedSongs",u,t.songPagedListConverter)},t.prototype.getRecentPlays=function(n){var i={count:n};return this.httpApi.query("/api/songs/getRecentPlays",i,t.songListConverter)},t.prototype.songCompleted=function(n){var t={songId:n};return this.httpApi.postUriEncoded("/api/songs/songCompleted",t)},t.prototype.songFailed=function(n){return this.httpApi.postUriEncoded("/api/songs/recordAudioError",n)},t.prototype.getSongsAdmin=function(n,t,i){var r={skip:n,take:t,search:i};return this.httpApi.query("/api/songs/getSongsAdmin",r)},t.prototype.deleteSong=function(n){return this.httpApi.post("/api/songs/deleteSong",n)},t.prototype.getRandomNewSongs=function(n){var i={count:n};return this.httpApi.query("/api/songs/getRandomNewSongs",i,t.songListConverter)},t.songPagedListConverter=function(t){return{items:t.items.map(function(t){return new n.Song(t)}),skip:t.skip,take:t.take,total:t.total}},t.songListConverter=function(n){return n.map(function(n){return t.songConverter(n)})},t.songOrNullConverter=function(n){return n?t.songConverter(n):null},t.songConverter=function(t){return new n.Song(t)},t.$inject=["httpApi","$q"],t}();n.SongApiService=t;n.App.service("songApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r,u){var f=this;this.audioPlayer=t;this.songApi=i;this.songRequestApi=r;this.songsBatch=new Rx.BehaviorSubject([]);this.songsList=new n.List(function(){return f.fetchSongBatch()},"songsbatchV2",n.SongApiService.songConverter,function(n){return f.songsBatch.onNext(n)});window.localStorage.removeItem("songsbatch");u.signedInState.skip(1).distinctUntilChanged().subscribe(function(n){return f.signedInChanged(n)})}return t.prototype.playNext=function(){var r=this,n=this.songsList.items[0],t,i;n?(t=this.songsList.items.slice(1),this.updateSongBatch(t),this.audioPlayer.playNewSong(n)):this.songApi.chooseSong().then(function(n){return r.audioPlayer.playNewSong(n)});i=this.songsList.items.length<3;i&&this.songsList.fetch()},t.prototype.playQueuedSong=function(n){var t=this.songsBatch.getValue(),i=t.indexOf(n);i>=0&&t.splice(i,1);t.splice(0,0,n);this.updateSongBatch(t);this.playNext()},t.prototype.fetchSongBatch=function(){var n=this;return this.songApi.chooseSongBatch().then(function(t){var i=n.songsList.items.concat(t).filter(function(t){return!n.songRequestApi.isSongPendingRequest(t.id)});n.songsBatch.onNext(i);return i})},t.prototype.signedInChanged=function(n){var t=this.songsBatch.getValue().length>0;n&&t&&(this.updateSongBatch([]),this.songsList.fetch())},t.prototype.updateSongBatch=function(n){var t;this.songsList.items.length=0;(t=this.songsList.items).push.apply(t,n);this.songsList.cache();this.songsBatch.onNext(n)},t.$inject=["audioPlayer","songApi","songRequestApi","accountApi",],t}();n.SongBatchService=t;n.App.service("songBatch",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.getSongEdit=function(n){var t={songId:n};return this.httpApi.query("/api/songEdits/get",t)},n.prototype.submit=function(n){return this.httpApi.post("/api/songEdits/editSong",n)},n.prototype.getPendingEdits=function(n){var t={take:n};return this.httpApi.query("/api/songEdits/getPendingEdits",t)},n.prototype.approve=function(n){return this.httpApi.post("/api/songEdits/approve",n)},n.prototype.reject=function(n){var t={songEditId:n};return this.httpApi.postUriEncoded("/api/songEdits/reject",t)},n.$inject=["httpApi",],n}();n.SongEditService=t;n.App.service("songEditApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r,u){var f=this;this.httpApi=n;this.audioPlayer=t;this.songApi=i;this.homeViewModel=r;this.accountApi=u;this.pendingSongRequestIds=[];this.hasPlayedRequestAnnouncement=!1;this.anonUserPlayedSongIds=null;this.lastFetchRequestsTime=null;this.accountApi.signedInState.distinctUntilChanged().where(function(n){return n===!0}).subscribe(function(){return f.userSignedIn()});localStorage.removeItem("album-art-cache")}return t.prototype.hasPendingRequest=function(){var n=this,t=this.pendingSongRequestIds.length>0;return this.pendingSongRequestIds.length===0&&setTimeout(function(){return n.fetchPendingSongRequests()},5e3),t},t.prototype.isSongPendingRequest=function(n){return this.pendingSongRequestIds.indexOf(n)!==-1},t.prototype.requestSong=function(n){this.pendingSongRequestIds.unshift(n.id);this.hasPlayedRequestAnnouncement=!1;var t={songId:n.id};return this.httpApi.postUriEncoded("/api/songRequests/requestsong",t)},t.prototype.playRequest=function(){var t=this,r,u;if(!this.hasPendingRequest())throw new Error("There was no pending song request.");if(this.hasPlayedRequestAnnouncement)this.hasPlayedRequestAnnouncement=!1,r=this.pendingSongRequestIds.splice(0,1)[0],u=this.audioPlayer.song.getValue(),this.songApi.getSongById(r,n.SongPick.SomeoneRequestedSong).then(function(n){var i=t.audioPlayer.song.getValue()===u;i&&n&&(t.audioPlayer.playNewSong(n),t.addAnonUserPlayedSong(n.id))});else{this.hasPlayedRequestAnnouncement=!0;var i=[1,3,4,5,6,7,8,9,10,11,12],f="SongRequest"+i[Math.floor(Math.random()*i.length)]+".mp3",e=this.homeViewModel.soundEffects+"/"+f;this.audioPlayer.playNewUri(e)}},t.prototype.getRandomRecentlyRequestedSongs=function(t){var i={count:t};return this.httpApi.query("/api/songRequests/getRandomRecentlyRequestedSongs",i,n.SongApiService.songListConverter)},t.prototype.fetchPendingSongRequests=function(){var n=Date.now(),t=this.lastFetchRequestsTime===null||n-this.lastFetchRequestsTime>3e4;t&&(this.lastFetchRequestsTime=n,this.accountApi.isSignedIn?this.fetchRequestForCurrentUser():this.fetchRequestForAnonymous())},t.prototype.fetchRequestForCurrentUser=function(){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(t){switch(t.label){case 0:return[4,this.httpApi.query("/api/songRequests/getPending")];case 1:return n=t.sent(),n&&this.pendingSongRequestIds.indexOf(n)===-1&&this.pendingSongRequestIds.push(n),[2]}})})},t.prototype.fetchRequestForAnonymous=function(){return __awaiter(this,void 0,void 0,function(){var t,i,r,u,n;return __generator(this,function(f){switch(f.label){case 0:return[4,this.httpApi.query("/api/songRequests/getRecentRequestedSongIds")];case 1:return t=f.sent(),i=this.getAnonUserPlayedSongIds(),r=_.without.apply(_,__spreadArray([t],i)),u=_.without.apply(_,__spreadArray([r],this.pendingSongRequestIds)),n=_.last(u),n&&this.pendingSongRequestIds.push(n),[2]}})})},t.prototype.getAnonUserPlayedSongIds=function(){if(!this.anonUserPlayedSongIds)try{var n=localStorage.getItem(t.anonUserPlayedSongIdsKey);n&&(this.anonUserPlayedSongIds=JSON.parse(n))}catch(i){console.log("failed to rehydrate anonymous user's played song IDs",i);this.anonUserPlayedSongIds=[]}return this.anonUserPlayedSongIds||(this.anonUserPlayedSongIds=[]),this.anonUserPlayedSongIds},t.prototype.addAnonUserPlayedSong=function(n){if(!this.accountApi.isSignedIn){var t=this.getAnonUserPlayedSongIds();t.unshift(n);this.updateAnonymousUserPlayedSongIds(this.getAnonUserPlayedSongIds())}},t.prototype.updateAnonymousUserPlayedSongIds=function(n){n||(n=[]);n.length>10&&(n.length=10);try{localStorage.setItem(t.anonUserPlayedSongIdsKey,JSON.stringify(n))}catch(i){console.log("Unable to store anonymous user song IDs",i)}this.anonUserPlayedSongIds=n},t.prototype.userSignedIn=function(){var n=this.getAnonUserPlayedSongIds();n&&n.length&&this.httpApi.post("/api/songRequests/markAsPlayed",n)},t.anonUserPlayedSongIdsKey="songrequests-anonUserPlayedSongIds",t.$inject=["httpApi","audioPlayer","songApi","homeViewModel","accountApi"],t}();n.SongRequestApiService=t;n.App.service("songRequestApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.audioPlayer=n;this.lastAnnouncementTime=new Date}return n.prototype.hasPendingAnnouncement=function(){var t=new Date,n=t.getMinutes(),i=n>55||n<5||n>25&&n<35,r=(t.valueOf()-this.lastAnnouncementTime.valueOf())/6e4,u=r>=15;return u&&i?(this.lastAnnouncementTime=t,!0):!1},n.prototype.playStationIdAnnouncement=function(){this.audioPlayer.playNewUri("/api/cdn/getstationid")},n.$inject=["audioPlayer"],n}();n.StationIdentifierService=t;n.App.service("stationIdentifier",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.getAll=function(){return this.httpApi.query("/api/tags/getAll")},n.prototype.renameTag=function(n,t){var i={oldTag:n,newTag:t};return this.httpApi.postUriEncoded("/api/tags/rename",i)},n.prototype.deleteTag=function(n){var t={tag:n};return this.httpApi.postUriEncoded("/api/tags/delete",t)},n.prototype.searchTags=function(n){var t={search:n};return this.httpApi.query("/api/tags/searchTags",t)},n.$inject=["httpApi"],n}();n.TagService=t;n.App.service("tagApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.httpApi=n}return n.prototype.updateProfile=function(n){return this.httpApi.post("/api/users/updateProfile",n)},n.prototype.updateProfilePic=function(n){var t=new FormData;return t.append("photo",n),this.httpApi.postFormData("/api/users/uploadProfilePicture",t)},n.prototype.saveVolume=function(n){var t={volume:n};return this.httpApi.postUriEncoded("/api/users/saveVolume",t)},n.prototype.getProfilePicForEmailAddress=function(n){var t={email:n,v:"1.0"};return this.httpApi.query("/api/users/getProfilePicForEmailAddress",t)},n.prototype.getRegistrations=function(n){var t={fromDate:n};return this.httpApi.query("/api/users/getRegistrations",t)},n.$inject=["httpApi"],n}();n.UserApiService=t;n.App.service("userApi",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n){this.audioPlayer=n;this.systemMedia=null}return t.prototype.install=function(){try{var n=typeof Windows!="undefined";n&&(this.systemMedia=this.tryGetSmtc(),this.systemMedia&&(this.setInitialSmtcState(),this.listenForAudioEvents()))}catch(t){console.log("Unable to install Windows native audio hooks",t)}},t.prototype.setInitialSmtcState=function(){this.systemMedia&&(this.systemMedia.isNextEnabled=!0,this.systemMedia.isPreviousEnabled=!1,this.systemMedia.isFastForwardEnabled=!1,this.systemMedia.isRewindEnabled=!1,this.systemMedia.isStopEnabled=!0,this.systemMedia.isPlayEnabled=!0,this.systemMedia.isPauseEnabled=!0,this.systemMedia.playbackStatus=Windows.Media.MediaPlaybackStatus.changing,this.systemMedia.isEnabled=!0)},t.prototype.tryGetSmtc=function(){try{return Windows.Media.SystemMediaTransportControls.getForCurrentView()}catch(n){return console.log("Unable to get SMTC",n),null}},t.prototype.listenForAudioEvents=function(){var n=this;this.audioPlayer.status.distinctUntilChanged().subscribe(function(t){return n.audioStatusChanged(t)});this.audioPlayer.song.distinctUntilChanged().subscribe(function(t){return n.songChanged(t)});this.systemMedia&&(this.systemMedia.addEventListener("buttonpressed",function(t){return n.windowsMediaButtonPressed(t)}),this.systemMedia.addEventListener("propertychanged",function(t){return n.windowsMediaPropertyChanged(t)}))},t.prototype.windowsMediaButtonPressed=function(n){var t=Windows.Media.SystemMediaTransportControlsButton;switch(n.button){case t.play:this.audioPlayer.resume();break;case t.pause:this.audioPlayer.pause();break;case t.next:this.audioPlayer.skipToEnd()}},t.prototype.windowsMediaPropertyChanged=function(){},t.prototype.audioStatusChanged=function(t){if(this.systemMedia)switch(t){case n.AudioStatus.Playing:this.systemMedia.playbackStatus=Windows.Media.MediaPlaybackStatus.playing;break;case n.AudioStatus.Paused:this.systemMedia.playbackStatus=Windows.Media.MediaPlaybackStatus.paused;break;case n.AudioStatus.Buffering:case n.AudioStatus.Stalled:this.systemMedia.playbackStatus=Windows.Media.MediaPlaybackStatus.paused;break;case n.AudioStatus.Ended:this.systemMedia.playbackStatus=Windows.Media.MediaPlaybackStatus.changing}},t.prototype.songChanged=function(n){var t,i;if(this.systemMedia){if(!n){this.systemMedia.displayUpdater.clearAll();return}this.systemMedia.displayUpdater.type=Windows.Media.MediaPlaybackType.music;t=this.systemMedia.displayUpdater.musicProperties;t.artist=n.artist;t.albumTitle=n.album;t.trackNumber=n.number;t.title=n.hebrewName?n.name+" "+n.hebrewName:n.name;n.albumArtUri&&(i=new Windows.Foundation.Uri(n.albumArtUri),this.systemMedia.displayUpdater.thumbnail=Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(i));this.systemMedia.displayUpdater.update()}},t.$inject=["audioPlayer"],t}();n.UwpNativeAudioService=t;n.App.service("uwpNativeAudio",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t){var i=this;this.artistApi=t;this.minimum=5;this.dueDonations=new n.List(function(){return i.artistApi.getDueDonations(i.minimum)});this.currentTab="pending";this.donationAmount=0;this.donationDisbursementMonth=new Date;this.disburseDonationButtonText="Disburse";this.isDisbursing=!1;this.hasDisbursed=!1}return t.prototype.$onInit=function(){this.dueDonations.fetch()},t.prototype.friendlyDate=function(n){return moment(n).local().format("MMM D YYYY")},t.prototype.markAsPaid=function(n){var t=this;this.artistApi.markDueDonationAsPaid(n).then(function(){return t.dueDonations.remove(n)})},t.prototype.disburseDonations=function(){var n=this,t;this.canDisburse&&(this.disburseDonationButtonText==="Disburse"?this.disburseDonationButtonText="Are you sure?":(t=this.donationDisbursementMonth.getMonth()+1,this.isDisbursing=!0,this.artistApi.recordMessiahsMusicFundMonthlyDisbursement(this.donationDisbursementMonth.getFullYear(),t,this.donationAmount).finally(function(){n.isDisbursing=!1;n.disburseDonationButtonText="Disburse"})))},Object.defineProperty(t.prototype,"canDisburse",{get:function(){return this.donationAmount>0&&this.donationDisbursementMonth<=new Date&&!this.isDisbursing},enumerable:!1,configurable:!0}),t.$inject=["artistApi"],t}();n.AdminDonationsController=t;n.App.controller("AdminDonationsController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.userApi=n;this.adminScripts=t;this.timeframes=[{title:"Last week",value:7},{title:"Last month",value:30},{title:"Last 3 months",value:90},{title:"Last 6 months",value:180},{title:"Last year",value:365},{title:"Last 5 years",value:1825}];this.activeTimeframe=this.timeframes[0]}return n.prototype.$onInit=function(){var n=this;this.loadGoogleCharts().then(function(){return n.changeTimeframe(n.timeframes[0])})},n.prototype.loadGoogleCharts=function(){var n=this;return new Promise(function(t,i){var r=function(){return!!window.google&&!!window.google.charts};return n.adminScripts.installScript("https://www.gstatic.com/charts/loader.js",r).then(function(){google.charts.load("current",{packages:["line"]});google.charts.setOnLoadCallback(function(){return t()})},function(n){return i(n)})})},n.prototype.drawChart=function(n){var t=this.usersToChartData(n),i={chart:{title:n.items.length+" new users",subtitle:"in the "+this.activeTimeframe.title.toLowerCase()},width:900,height:700},r=new google.charts.Line(document.querySelector("#adminUsersChart"));r.draw(t,google.charts.Line.convertOptions(i))},n.prototype.changeTimeframe=function(n){var r=this,t,i;this.activeTimeframe=n;t=moment.utc().subtract(n.value,"days");i=this.userApi.getRegistrations(t.toISOString());i.then(function(n){return r.drawChart(n)})},n.prototype.usersToChartData=function(n){var t=new google.visualization.DataTable,i;return t.addColumn("date","Date"),t.addColumn("number","Users"),i=n.items.map(function(t,i){var r=n.total-n.items.length+i,u=new Date(t.registrationDate);return[u,r]}),t.addRows(i),t},n.$inject=["userApi","adminScripts"],n}();n.AdminUsersController=t;n.App.controller("AdminUsersController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i){var r=this;this.albumApi=t;this.appNav=i;this.search="";this.albums=new n.PagedList(function(n,t){return r.albumApi.getAll(n,t,r.search)});this.isSaving=!1;this.albums.take=50;this.albums.fetchNextChunk()}return t.prototype.searchChanged=function(){this.albums.resetAndFetch()},t.prototype.deleteAlbum=function(n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:this.isSaving=!0;t.label=1;case 1:return t.trys.push([1,,3,4]),[4,this.albumApi.deleteAlbum(n.id)];case 2:return t.sent(),_.pull(this.albums.items,n),[3,4];case 3:return this.isSaving=!1,[7];case 4:return[2]}})})},t.$inject=["albumApi","appNav",],t}();n.AlbumsController=t;n.App.controller("AlbumsController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.songEditApi=n;this.accountApi=t;this.tagApi=i;this.pendingEdits=[];this.currentEdit=null;this.isSaving=!1;this.hasLoaded=!1;this.tagsInput="";this.user=null;this.accountApi.signedInState.select(function(){return r.accountApi.currentUser}).subscribe(function(n){return r.signedInUserChanged(n)});this.songEditApi.getPendingEdits(20).then(function(n){return r.pendingEditsLoaded(n)})}return n.prototype.pendingEditsLoaded=function(n){this.pendingEdits=n;this.setCurrentEdit(n[0]);this.hasLoaded=!0},n.prototype.setCurrentEdit=function(n){this.currentEdit=n},n.prototype.approve=function(){var t=this,n;this.user&&(n=this.currentEdit,!this.isSaving&&n&&(this.isSaving=!0,this.songEditApi.approve(n).then(function(n){return t.removeSongEdit(n.id)}).finally(function(){return t.isSaving=!1})))},n.prototype.reject=function(){var t=this,n;this.user&&(n=this.currentEdit,!this.isSaving&&n&&(this.isSaving=!0,this.songEditApi.reject(n.id).then(function(n){n&&t.removeSongEdit(n.id)}).finally(function(){return t.isSaving=!1})))},n.prototype.removeSongEdit=function(n){this.pendingEdits=this.pendingEdits.filter(function(t){return t.id!==n});this.currentEdit&&this.currentEdit.id===n&&this.setCurrentEdit(this.pendingEdits[0])},n.prototype.removeTag=function(n){if(this.currentEdit){var t=this.currentEdit.newTags.indexOf(n);t>=0&&this.currentEdit.newTags.splice(t,1)}},n.prototype.autoCompleteTagSelected=function(n){this.addTag(n);this.tagsInput=""},n.prototype.addTag=function(n){if(this.currentEdit){var t=n.toLowerCase().trim();!this.currentEdit.newTags.includes(t)&&t.length>1&&this.currentEdit.newTags.push(t)}},n.prototype.tagsInputChanged=function(){var t=this,n;this.tagsInput.includes(",")&&(n=this.tagsInput.split(","),this.tagsInput="",n.filter(function(n){return n&&n.length>1}).forEach(function(n){return t.addTag(n)}))},n.prototype.tagsEnterKeyPressed=function(){this.tagsInput.length>1&&this.autoCompleteTagSelected(this.tagsInput)},n.prototype.searchTags=function(n){return this.tagApi.searchTags(n)},n.prototype.signedInUserChanged=function(n){this.user=n},n.$inject=["songEditApi","accountApi","tagApi"],n}();n.ApproveSongEditsController=t;n.App.controller("ApproveSongEditsController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){this.song=n;this.songApi=t;this.$uibModalInstance=i;this.saving=!1}return n.prototype.close=function(){this.$uibModalInstance.close(!1)},n.prototype.deleteSong=function(){var n=this;this.saving||(this.saving=!0,this.songApi.deleteSong(this.song).then(function(){return n.$uibModalInstance.close(!0)}).finally(function(){return n.saving=!1}))},n.$inject=["song","songApi","$uibModalInstance"],n}();n.ConfirmDeleteSongController=t;n.App.controller("ConfirmDeleteSongController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){var r=this,i;this.accountApi=n;this.email="";this.confirmCode="";this.isConfirming=!0;this.confirmSucceeded=!1;this.confirmFailed=!1;this.confirmFailedErrorMessage="";this.email=t.email;i=t.confirmCode||"";this.confirmCode=i.replace(new RegExp("___","g"),"/");setTimeout(function(){return r.confirm()},1e3)}return n.prototype.confirm=function(){var n=this;this.accountApi.confirmEmail(this.email,this.confirmCode).then(function(t){return n.confirmEmailCompleted(t)}).catch(function(t){return n.confirmEmailCompleted({errorMessage:t&&t.data&&t.data.exceptionMessage?t.data.exceptionMessage:"Couldn't confirm email",success:!1})})},n.prototype.confirmEmailCompleted=function(n){this.isConfirming=!1;this.confirmSucceeded=n.success;this.confirmFailed=!this.confirmSucceeded;this.confirmFailedErrorMessage=n.errorMessage},n.$inject=["accountApi","$routeParams",],n}();n.ConfirmEmailController=t;n.App.controller("ConfirmEmailController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t){this.accountApi=n;this.password="";this.showPasswordError=!1;this.isSaving=!1;this.hasCreatedPassword=!1;this.email=t.email;this.emailWithoutDomain=this.email.substr(0,this.email.indexOf("@"))}return Object.defineProperty(t.prototype,"isPasswordValid",{get:function(){return!!this.password&&this.password.length>=6&&!!this.password.match(n.ResetPasswordController.regexContainsLetterAndNumber)},enumerable:!1,configurable:!0}),t.prototype.createPassword=function(){var n=this;if(!this.isPasswordValid){this.showPasswordError=!0;return}this.isSaving||(this.isSaving=!0,this.accountApi.createPassword(this.email,this.password).then(function(){return n.hasCreatedPassword=!0}).finally(function(){return n.isSaving=!1}))},t.minPasswordLength=6,t.$inject=["accountApi","$routeParams",],t}();n.CreatePasswordController=t;n.App.controller("CreatePasswordController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var f=this,r,u;this.$uibModalInstance=t;this.$q=i;this.rawImage=null;this.croppedImage=null;this.croppedBase64=null;r=this.loadRawImage(n);u=t.rendered;i.all([r,u]).then(function(n){return f.rawImage=n[0]})}return n.prototype.loadRawImage=function(n){var i=this.$q.defer(),t=new FileReader;return t.addEventListener("load",function(){return i.resolve(t.result)},!1),t.readAsDataURL(n),i.promise},n.prototype.close=function(){this.$uibModalInstance.close()},n.prototype.apply=function(){var n={image:this.croppedImage,imageBase64:this.croppedBase64};this.$uibModalInstance.close(n)},n.$inject=["imageFile","$uibModalInstance","$q"],n}();n.CropImageController=t;n.App.controller("CropImageController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.homeViewModel=t;this.desiredArtistName=null;this.selectedArtist=null;this.donationTargetOptions=[this.homeViewModel.pageTitle,"All artists on "+this.homeViewModel.pageTitle,];this.donationTarget=this.donationTargetOptions[0];this.desiredArtistName=i.artist;this.desiredArtistName&&(this.donationTargetOptions.push(this.desiredArtistName),this.donationTarget=this.desiredArtistName);n.getAll("",0,1e3).then(function(n){return r.allArtistsFetched(n.items)})}return n.prototype.allArtistsFetched=function(n){var t,i=n.map(function(n){return n.name});(t=this.donationTargetOptions).push.apply(t,i)},n.$inject=["artistApi","homeViewModel","$routeParams"],n}();n.DonateController=t;n.App.controller("DonateController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r,u){var o=this,f,e,s;this.albumApi=n;this.appNav=t;this.$q=r;this.homeViewModel=u;this.album=null;this.allAlbumSwatches=[];this.hasChangedAlbumArt=!1;f=i.artist;e=i.album;f&&e?(s=f.toLowerCase()==="albums",s?this.albumApi.get(f+"/"+e).then(function(n){return o.albumLoaded(n)}):this.albumApi.getByArtistAndAlbumName(f,e).then(function(n){return o.albumLoaded(n)})):this.createNewAlbum()}return t.prototype.createNewAlbum=function(){return new n.Album({albumArtUri:"",artist:"[new artist]",isVariousArtists:!1,backgroundColor:"",foregroundColor:"",mutedColor:"",name:"[new album]",id:"",textShadowColor:"",songCount:0})},t.prototype.albumLoaded=function(n){var t=this;n?(this.album=n,n.albumArtUri&&this.loadCanvasSafeAlbumArt(n.albumArtUri).then(function(n){return t.populateColorSwatches(n)})):this.appNav.createAlbum()},t.prototype.save=function(){var n=this,t;return this.album&&!this.album.isSaving&&(this.album.isSaving=!0,t=void 0,this.hasChangedAlbumArt?this.albumApi.save(this.album).then(function(t){return n.albumApi.changeArt(t.id,n.album.albumArtUri)}).then(function(t){n.album=t;n.hasChangedAlbumArt=!1}).finally(function(){return n.album.isSaving=!1}):this.albumApi.save(this.album).then(function(t){return n.album=t}).finally(function(){return n.album.isSaving=!1})),null},t.prototype.hexToRgbString=function(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t&&t.length>=4?"rgb("+parseInt(t[1],16)+", "+parseInt(t[2],16)+", "+parseInt(t[3],16)+")":""},t.prototype.resetColorSwatches=function(n){var t=this;this.loadCanvasSafeAlbumArt(n).then(function(n){return t.populateColorSwatches(n)})},t.prototype.chooseAlbumArt=function(){var t=this,n;filepicker.setKey(this.homeViewModel.filePickrKey);n={extensions:[".jpg",".png"]};filepicker.pick(n,function(n){return t.albumArtChosen(n)},function(n){return console.log("Album art pick failed.",n)})},t.prototype.albumArtChosen=function(n){var t=this;this.hasChangedAlbumArt=!0;this.album&&(this.album.albumArtUri=n.url);this.loadCanvasSafeAlbumArt(n.url).then(function(n){return t.populateColorSwatches(n)})},t.prototype.populateColorSwatches=function(t){if(this.album){var r=new Vibrant(t,64,5),i=r.swatches();i&&(this.allAlbumSwatches=n.UploadAlbumController.getFriendlySwatches(i),this.album.backgroundColor||(this.album.backgroundColor=(i.DarkVibrant||i.DarkMuted||n.Song.defaultSwatch).getHex(),this.album.foregroundColor=(i.LightVibrant||i.Vibrant||n.Song.defaultSwatch).getHex(),this.album.mutedColor=(i.DarkMuted||i.DarkVibrant||i.Vibrant||n.Song.defaultSwatch).getBodyTextColor(),this.album.textShadowColor=(i.DarkMuted||i.DarkVibrant||n.Song.defaultSwatch).getHex()))}},t.prototype.loadCanvasSafeAlbumArt=function(n){if(!n)throw new Error("imgUrl must not be null or undefined");var i=this.$q.defer(),t=document.createElement("img");return t.src="/api/albums/imageOnDomain?imageUrl="+encodeURIComponent(n),t.addEventListener("load",function(){i.resolve(t)}),t.addEventListener("error",function(){return i.reject()}),i.promise},t.$inject=["albumApi","appNav","$routeParams","$q","homeViewModel"],t}();n.EditAlbumController=t;n.App.controller("EditAlbumController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r,u){var e=this,f;this.artistApi=t;this.$scope=r;this.homeViewModel=u;f=i.artistName;f&&f.length>0?this.artistApi.getByName(f).then(function(n){return e.artist=n}):this.artist=new n.Artist}return t.prototype.removeImage=function(n){this.artist&&(this.artist.images=this.artist.images.filter(function(t){return t!==n}))},t.prototype.addImages=function(){var t=this,n;filepicker.setKey(this.homeViewModel.filePickrKey);n={extensions:[".jpg",".png"],maxFiles:100};filepicker.pickMultiple(n,function(n){return t.imagesAdded(n)},function(n){return console.log("Failed to add image.",n)})},t.prototype.imagesAdded=function(n){var t=this;n.forEach(function(n){return t.artist.images.push(n.url)});this.$scope.$applyAsync()},t.prototype.save=function(){var n=this;this.artist&&!this.artist.isSaving&&(this.artist.isSaving=!0,this.artistApi.save(this.artist).then(function(t){return n.artist.updateFrom(t)}).finally(function(){return n.artist.isSaving=!1}))},t.$inject=["artistApi","$routeParams","$scope","homeViewModel"],t}();n.EditArtistController=t;n.App.controller("EditArtistController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r){this.songEditApi=n;this.tagApi=t;this.song=null;this.tagsInput="";this.isSaving=!1;this.isSaveSuccess=!1;this.isSaveFail=!1;this.tags=[];this.isLyricsFocused=!0;this.tagPlaceholder="piano, violin, male vocal, hebrew, psalms";this.contributingArtistsInput="";this.songId="songs/"+r.id;this.isAdmin=!!i.currentUser&&i.currentUser.isAdmin}return t.prototype.$onInit=function(){var n=this;this.songId&&this.songEditApi.getSongEdit(this.songId).then(function(t){return n.songEditLoaded(t)})},t.prototype.searchTags=function(n){return this.tagApi.searchTags(n)},t.prototype.songEditLoaded=function(t){this.song=n.Song.empty();this.song.id=t.songId;this.song.name=t.newName;this.song.hebrewName=t.newHebrewName;this.song.album=t.newAlbum;this.song.artist=t.newArtist;this.song.lyrics=t.newLyrics;this.song.albumArtUri="/api/albums/getAlbumArtBySongId?songId="+t.songId;this.tags=t.newTags;this.tags.length>0&&(this.tagPlaceholder="");this.contributingArtistsInput=t.newContributingArtists.join(", ")},t.prototype.tagsInputChanged=function(){var t=this,n;this.tagsInput.includes(",")&&(n=this.tagsInput.split(","),this.tagsInput="",n.filter(function(n){return n&&n.length>1}).forEach(function(n){return t.addTag(n)}))},t.prototype.removeTag=function(n){var t=this.tags.indexOf(n);t>=0&&this.tags.splice(t,1)},t.prototype.autoCompleteTagSelected=function(n){this.addTag(n);this.tagsInput=""},t.prototype.addTag=function(n){var t=n.toLowerCase().trim();!this.tags.includes(t)&&t.length>1&&(this.tags.push(t),this.tagPlaceholder="")},t.prototype.tagsEnterKeyPressed=function(){this.tagsInput.length>1&&this.autoCompleteTagSelected(this.tagsInput)},t.prototype.submit=function(){var n=this;this.song&&!this.isSaving&&(this.song.tags=this.tags,this.song.contributingArtists=this.contributingArtistsInput.split(",").map(function(n){return n.trim()}).filter(function(n){return!!n}),this.isSaving=!0,this.songEditApi.submit(this.song).then(function(){return n.isSaveSuccess=!0}).catch(function(){return n.isSaveFail=!0}).finally(function(){return n.isSaving=!1}))},t.$inject=["songEditApi","tagApi","accountApi","$routeParams",],t}();n.EditSongController=t;n.App.controller("EditSongController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i){var r=this;this.songApi=t;this.appNav=i;this.songs=new n.PagedList(function(n,t){return r.songApi.getSongsAdmin(n,t,r.search)});this.search=""}return t.prototype.$onInit=function(){this.songs.fetchNextChunk()},t.prototype.searchChanged=function(){this.songs.resetAndFetch()},t.prototype.deleteSong=function(n){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(r){switch(r.label){case 0:return t=this.appNav.confirmDeleteSong(n),[4,t.result];case 1:return i=r.sent(),i&&_.pull(this.songs.items,n),[2]}})})},t.$inject=["songApi","appNav"],t}();n.EditSongsController=t;n.App.controller("EditSongsController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){this.song=n;this.error=t;this.audioPlayer=i;this.songBatch=r;this.$uibModalInstance=u;this.songName=this.song?this.song.name:"song"}return n.prototype.playDifferentSong=function(){this.$uibModalInstance.close();this.songBatch.playNext()},n.prototype.trySongAgain=function(){this.$uibModalInstance.close();this.song?this.error.trackPosition?this.audioPlayer.playSongAtTrackPosition(this.song.id,this.error.trackPosition):this.audioPlayer.playSongById(this.song.id):this.songBatch.playNext()},n.prototype.close=function(){this.$uibModalInstance.close()},n.$inject=["song","error","audioPlayer","songBatch","$uibModalInstance"],n}();n.ErrorPlayingAudioController=t;n.App.controller("ErrorPlayingAudioController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t,i,r,u,f,e,o,s,h,c){var l=this;this.audioPlayer=n;this.songBatch=t;this.likeApi=i;this.songRequestApi=r;this.accountApi=u;this.userApi=f;this.songApi=e;this.stationIdentifier=o;this.adAnnouncer=s;this.appNav=h;this.$scope=c;this.volumeShown=!1;this.volumeVal=new Rx.Subject;this.isBuffering=!1;this.lastAudioErrorTime=null;this.stalledTimerHandle=null;this.audio=null;this.isShowingAudioError=!1;this.wakeLock=null;this.isThumbingUpOrDown=!1;this.audioPlayer.status.debounce(1e3).subscribe(function(n){return l.audioStatusChanged(n)});this.audioPlayer.playedTimeText.distinctUntilChanged().subscribe(function(n){return $(".footer .track-time").text(n)});this.audioPlayer.duration.distinctUntilChanged().subscribe(function(n){return $(".footer .track-duration").text(l.getFormattedTime(n))});this.audioPlayer.status.distinctUntilChanged().subscribe(function(n){return $(".footer .audio-status").text(l.getAudioStatusText(n))});this.audioPlayer.playedTimePercentage.distinctUntilChanged().subscribe(function(n){return $(".footer .trackbar").width(n+"%")});this.audioPlayer.error.debounce(2e3).subscribe(function(n){return l.onAudioError(n)});this.accountApi.signedInState.distinctUntilChanged().where(function(n){return n}).subscribe(function(){return l.restoreVolumeFromSignedInUser()})}return Object.defineProperty(t.prototype,"likesCurrentSong",{get:function(){var t=this.audioPlayer.song.getValue();return t?t.songLike===n.SongLike.Liked:!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dislikesCurrentSong",{get:function(){var t=this.audioPlayer.song.getValue();return t?t.songLike===n.SongLike.Disliked:!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"likeText",{get:function(){return this.likesCurrentSong?"You have already liked this song. Chavah is playing it more often. Tap to undo your like.":"Like this song. Chavah will play this song, and others like it, more often."},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dislikeText",{get:function(){return this.dislikesCurrentSong?"You have already disliked this song. Chavah is playing it less often. Tap to undo your dislike.":"Dislike this song. Chavah will play this song, and others like it, less often."},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volumeIconClass",{get:function(){return this.volume>.95?"fa-volume-up":this.volume<.05?"fa-volume-off":"fa-volume-down"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this.audio?this.audio.volume:1},set:function(n){isNaN(n)&&(n=1);this.audio&&(this.audio.volume=n);this.volumeVal.onNext(n)},enumerable:!1,configurable:!0}),t.prototype.$onInit=function(){var n=this;if(this.audio=document.querySelector("#audio"),!this.audio)throw new Error("Couldn't locate #audio element");this.audioPlayer.initialize(this.audio);this.restoreVolumeFromSignedInUser();this.volumeVal.distinctUntilChanged().debounce(2e3).where(function(t){return!!n.accountApi.currentUser&&n.accountApi.currentUser.volume!==t}).subscribe(function(t){return n.saveVolumePreference(t)});this.tryAcquireWakeLock()},t.prototype.tryAcquireWakeLock=function(){return __awaiter(this,void 0,void 0,function(){var n,t,i,r,u=this;return __generator(this,function(f){switch(f.label){case 0:if(!("wakeLock"in navigator))return[3,4];n=!this.wakeLock;n&&document.addEventListener("visibilitychange",function(){u.wakeLock&&document.visibilityState==="visible"&&u.tryAcquireWakeLock()});t=navigator.wakeLock;f.label=1;case 1:return f.trys.push([1,3,,4]),i=this,[4,t.request("screen")];case 2:return i.wakeLock=f.sent(),[3,4];case 3:return r=f.sent(),console.warn("Unable to acquire wake lock.",r),[3,4];case 4:return[2]}})})},t.prototype.toggleVolumnShown=function(){this.volumeShown=!this.volumeShown},t.prototype.isPaused=function(){return this.audioPlayer.status.getValue()===n.AudioStatus.Paused},t.prototype.playPause=function(){this.audioPlayer.status.getValue()===n.AudioStatus.Playing?this.audioPlayer.pause():this.audioPlayer.resume()},t.prototype.thumbDownClicked=function(){if(this.ensureSignedIn()){var t=this.audioPlayer.song.getValue();t&&(t.songLike!==n.SongLike.Disliked?(this.dislikeSong(t),this.songBatch.playNext()):this.setSongAsUnranked(t))}},t.prototype.thumbUpClicked=function(){if(this.ensureSignedIn()){var t=this.audioPlayer.song.getValue();t&&(t.songLike!==n.SongLike.Liked?this.likeSong(t):this.setSongAsUnranked(t))}},t.prototype.setSongAsUnranked=function(t){var i=this;return t.songLike=n.SongLike.Unranked,this.isThumbingUpOrDown=!0,this.likeApi.setSongAsUnranked(t.id).then(function(n){return t.communityRank=n}).finally(function(){return i.isThumbingUpOrDown=!1})},t.prototype.likeSong=function(t){var i=this;t.songLike=n.SongLike.Liked;this.isThumbingUpOrDown=!0;this.likeApi.likeSong(t.id).then(function(n){return t.communityRank=n}).finally(function(){return i.isThumbingUpOrDown=!1})},t.prototype.dislikeSong=function(t){var i=this;t.songLike=n.SongLike.Disliked;this.isThumbingUpOrDown=!0;this.likeApi.dislikeSong(t.id).then(function(n){return t.communityRank=n}).finally(function(){return i.isThumbingUpOrDown=!1})},t.prototype.requestSong=function(){var n=this;this.ensureSignedIn()&&this.appNav.songRequestModal().result.then(function(t){return n.songRequestDialogCompleted(t)})},t.prototype.ensureSignedIn=function(){return this.accountApi.isSignedIn?!0:(this.appNav.promptSignIn(),!1)},t.prototype.songRequestDialogCompleted=function(n){var t=this;n&&(this.audioPlayer.pause(),this.songRequestApi.requestSong(n).then(function(){return t.playNextSong()}))},t.prototype.playNextSong=function(){this.audioPlayer.pause();this.songRequestApi.hasPendingRequest()?this.songRequestApi.playRequest():this.stationIdentifier.hasPendingAnnouncement()?this.stationIdentifier.playStationIdAnnouncement():this.adAnnouncer.hasPendingAnnouncement()?this.adAnnouncer.playAdAnnouncement():this.songBatch.playNext()},t.prototype.audioStatusChanged=function(t){var i=this,r,u;t===n.AudioStatus.Ended&&this.playNextSong();t===n.AudioStatus.Erred?(r=30,u=this.lastAudioErrorTime===null||moment().diff(moment(this.lastAudioErrorTime),"seconds")>r,u&&this.playNextSong(),this.lastAudioErrorTime=new Date):t===n.AudioStatus.Stalled&&this.stalledTimerHandle&&(clearTimeout(this.stalledTimerHandle),this.stalledTimerHandle=setTimeout(function(){i.audioPlayer.status.getValue()===n.AudioStatus.Stalled&&i.playNextSong()},5e3));this.isBuffering=t===n.AudioStatus.Buffering||t===n.AudioStatus.Stalled;this.$scope.$applyAsync()},t.prototype.getFormattedTime=function(n){if(isNaN(n)||n===0)return"0:00";var t=Math.floor(n/60),i=Math.floor(n-t*60),r=i<10?"0":"";return t+":"+r+i},t.prototype.getAudioStatusText=function(t){switch(t){case n.AudioStatus.Aborted:return"Unable to play";case n.AudioStatus.Buffering:return"Buffering...";case n.AudioStatus.Ended:return"Ended...";case n.AudioStatus.Erred:return"Encountered an error";case n.AudioStatus.Paused:return"Paused";case n.AudioStatus.Playing:return"";case n.AudioStatus.Stalled:return"Stalled..."}},t.prototype.restoreVolumeFromSignedInUser=function(){this.accountApi.currentUser&&(this.volume=Math.max(.1,this.accountApi.currentUser.volume))},t.prototype.saveVolumePreference=function(n){this.accountApi.currentUser&&this.accountApi.currentUser.volume!==n&&(this.accountApi.currentUser.volume=n,this.userApi.saveVolume(n))},t.prototype.shouldShowErrorNotification=function(t){var i=this.audioPlayer.song.getValue(),r=!i||!t.songId||i.id===t.songId,u=t.mp3Url&&t.mp3Url.includes("soundEffects"),f=this.audioPlayer.status.getValue()===n.AudioStatus.Playing;return r&&!f&&!u},t.prototype.onAudioError=function(n){this.shouldShowErrorNotification(n)?(this.showAudioErrorNotification(n),this.songApi.songFailed(n)):this.playNextSong()},t.prototype.showAudioErrorNotification=function(n){var t=this;console.log("Error playing audio",n);this.isShowingAudioError=!0;this.appNav.showErrorPlayingAudio(n,this.audioPlayer.song.getValue()).closed.finally(function(){return t.isShowingAudioError=!1})},t.$inject=["audioPlayer","songBatch","likeApi","songRequestApi","accountApi","userApi","songApi","stationIdentifier","adAnnouncer","appNav","$scope"],t}();n.FooterController=t;n.App.controller("FooterController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){var i,r;this.accountApi=n;this.$routeParams=t;this.email="";this.pwned=!1;this.resetPasswordSuccessfully=!1;this.couldNotFindEmail=!1;this.resetErrorMessage="";this.isBusy=!1;i=t.email;i&&(this.email=i);r=t.pwned;r&&(this.pwned=Boolean(r))}return Object.defineProperty(n.prototype,"registerUrl",{get:function(){return this.email&&this.email.indexOf("@")>=0?"#/register/"+encodeURIComponent(this.email):"#/register"},enumerable:!1,configurable:!0}),n.prototype.resetPassword=function(){var n=this,t=this.email&&this.email.includes("@");if(!t){this.resetErrorMessage="Please enter your email so we can reset your password";return}this.resetFields();this.isBusy||(this.isBusy=!0,this.accountApi.sendPasswordResetEmail(this.email).then(function(t){return n.passwordResetCompleted(t)}).finally(function(){return n.isBusy=!1}))},n.prototype.passwordResetCompleted=function(n){n.success?this.resetPasswordSuccessfully=!0:n.invalidEmail?this.couldNotFindEmail=!0:this.resetErrorMessage=n.errorMessage||"Unable to reset password"},n.prototype.resetFields=function(){this.couldNotFindEmail=!1;this.resetPasswordSuccessfully=!1;this.resetErrorMessage=""},n.$inject=["accountApi","$routeParams",],n}();n.ForgotPasswordController=t;n.App.controller("ForgotPasswordController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f,e){var o=this;this.homeViewModel=n;this.accountApi=t;this.appNav=i;this.pwaInstall=r;this.pushNotifications=u;this.audioPlayer=f;this.$timeout=e;this.profilePicUrl=null;this.canSubscribeToPushNotifications=!1;this.showDonationBanner=!1;this.accountApi.signedInState.select(function(){return o.accountApi.currentUser}).subscribe(function(n){return o.signedInUserChanged(n)})}return Object.defineProperty(n.prototype,"isAdmin",{get:function(){return this.accountApi.currentUser===undefined||this.accountApi.currentUser===null?!1:this.accountApi.currentUser.isAdmin},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentUserName",{get:function(){return this.accountApi.currentUser?this.accountApi.currentUser.email:""},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"unreadNotificationCount",{get:function(){return this.notifications?this.notifications.filter(function(n){return n.isUnread}).length:0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this.homeViewModel.pageTitle},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"desc",{get:function(){return this.homeViewModel.pageDescription},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canInstallPwa",{get:function(){var n=window.matchMedia&&(window.matchMedia("(display-mode: minimal-ui)").matches||window.matchMedia("(display-mode: standalone)").matches);return!n&&this.pwaInstall.canInstall},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isOnIOS",{get:function(){var n=navigator.userAgent.toLowerCase();return n.includes("iphone")||n.includes("ipad")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"showGoBack",{get:function(){return window.location.hash!=="#/"},enumerable:!1,configurable:!0}),n.prototype.$onInit=function(){var n=this;this.loadPushNotificationState();this.updateAppBadge(this.unreadNotificationCount);this.hasDismissedDonationBanner()||this.$timeout(function(){return n.showDonationBanner=!0},3e5)},n.prototype.loadPushNotificationState=function(){var n=this;this.pushNotifications.canSubscribe().then(function(t){return n.canSubscribeToPushNotifications=t})},n.prototype.markNotificationsAsRead=function(){this.notifications.some(function(n){return n.isUnread})&&(this.notifications.forEach(function(n){return n.isUnread=!1}),this.accountApi.clearNotifications());this.updateAppBadge(0)},n.prototype.signOut=function(){var n=this;this.accountApi.signOut().then(function(){return n.appNav.signOut()})},n.prototype.signedInUserChanged=function(n){n&&(this.notifications=n.notifications,this.profilePicUrl=n.profilePicUrl,this.updateAppBadge(this.unreadNotificationCount))},n.prototype.installPwa=function(){var t=this,n=this.pwaInstall.install();n&&n.then(function(n){n.outcome==="accepted"&&t.audioPlayer.pause()})},n.prototype.askPermissionForPushNotifications=function(){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(t){switch(t.label){case 0:return[4,this.pushNotifications.askPermission()];case 1:return(n=t.sent(),!(n==="granted"))?[3,3]:[4,this.pushNotifications.subscribe()];case 2:return t.sent(),this.appNav.pushSubscriptionSuccessful(),[3,4];case 3:console.log("Push notification permission wasn't granted",n);t.label=4;case 4:return this.loadPushNotificationState(),[2]}})})},n.prototype.updateAppBadge=function(n){var t=navigator,i=t.setAppBadge&&t.clearAppBadge;i&&(n>0?t.setAppBadge(n):t.clearAppBadge())},n.prototype.hasDismissedDonationBanner=function(){return window.localStorage.getItem(n.donationBannerLocalStorageKey)==="true"},n.prototype.dismissDonationBanner=function(){window.localStorage.setItem(n.donationBannerLocalStorageKey,"true")},n.donationBannerLocalStorageKey="hasDismissedDonationBanner",n.$inject=["homeViewModel","accountApi","appNav","pwaInstall","pushNotifications","audioPlayer","$timeout"],n}();n.HeaderController=t;n.App.controller("HeaderController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t){var i=this;this.logApi=t;this.logs=new n.PagedList(function(n,t){return i.logApi.getAll(n,t,i.selectedFilter.value,i.selectedSort.value)});this.saving=!1;this.timeAgoCache={};this.filterOptions=[{title:"All",value:null,description:""},{title:"Critical",value:n.LogLevel.Critical,description:"text-danger"},{title:"Error",value:n.LogLevel.Error,description:"text-danger"},{title:"Warning",value:n.LogLevel.Warning,description:"text-warning"},{title:"Info",value:n.LogLevel.Information,description:"text-info"},{title:"Debug",value:n.LogLevel.Debug,description:"text-info"},{title:"Trace",value:n.LogLevel.Trace,description:"text-info"}];this.selectedFilter=this.filterOptions[0];this.sortOptions=[{title:"Newest",value:n.LogSort.Newest},{title:"Oldest",value:n.LogSort.Oldest},{title:"Total occurrences",value:n.LogSort.OccurrenceCount}];this.selectedSort=this.sortOptions[0]}return t.prototype.$onInit=function(){this.logs.fetchNextChunk()},t.prototype.getTimeAgo=function(n){var f=this.timeAgoCache[n];if(f)return f;var e=moment(n).local(),o=e.diff(moment()),s=Math.abs(o),h=s/1e3,t=h/60,i=t/60,r=i/24,u="";return u=r>=1?Math.floor(r)+" day"+(r>=2?"s":"")+" ago ("+e.format("M/D/YY H:mm a")+")":i>=1?Math.floor(i)+" hour"+(i>=2?"s":"")+" ago":t>=1?Math.floor(t)+" minute"+(t>=2?"s":"")+" ago":"less than a minute ago",this.timeAgoCache[n]=u,u},t.prototype.getFriendlyDate=function(n){return moment(n).local().format("dddd MMMM DD, YYYY h:mma")},t.prototype.deleteLog=function(n){var t=this;this.saving||(this.saving=!0,this.logApi.deleteLog(n.id).then(function(){return t.logs.resetAndFetch()}).finally(function(){return t.saving=!1}))},t.prototype.getActiveOccurrenceText=function(n){var t=n.occurrences[n.activeOccurrenceIndex];return t?JSON.stringify(t,null,4):""},t.prototype.getIconClass=function(t){switch(t){case n.LogLevel.Critical:case n.LogLevel.Error:return"fa-exclamation-circle text-danger";case n.LogLevel.Warning:return"fa-exclamation-triangle text-warning";case n.LogLevel.Information:case n.LogLevel.Debug:case n.LogLevel.Trace:return"fa-info-circle text-info";default:return""}},t.prototype.getLogClass=function(t){switch(t.level){case n.LogLevel.Critical:return"left-border border-danger text-danger";case n.LogLevel.Error:return"left-border border-danger";case n.LogLevel.Warning:return"left-border border-warning";case n.LogLevel.Information:return"left-border border-info";default:return""}},t.prototype.getLevelDescription=function(n){var t=this.filterOptions.find(function(t){return t.value===n});return t?t.title:""},t.prototype.getException=function(n){var t=n.occurrences.find(function(n){return!!n.exception});return t?t.exception:null},t.prototype.getLogLevel=function(t){switch(t.level){case n.LogLevel.Critical:return"Critical";case n.LogLevel.Error:return"Error";case n.LogLevel.Warning:return"Warn";case n.LogLevel.Information:return"Info";case n.LogLevel.Debug:return"Debug";case n.LogLevel.Trace:return"Trace";default:return""}},t.prototype.getLogDetails=function(n){return n.activeCategory==="Message"?n.messageTemplate:n.activeCategory==="Exception"?this.getException(n):n.activeCategory==="Occurrences"?this.getActiveOccurrenceText(n):""},t.prototype.selectFilter=function(n){this.selectedFilter!==n&&(this.selectedFilter=n,this.logs.resetAndFetch())},t.prototype.selectSort=function(n){this.selectedSort!==n&&(this.selectedSort=n,this.logs.resetAndFetch())},t.$inject=["logApi"],t}();n.LogEditorController=t;n.App.controller("LogEditorController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r,u,f,e){var o=this;this.songApi=t;this.albumApi=i;this.artistApi=r;this.audioPlayer=u;this.sharing=f;this.appNav=e;this.songs=new n.PagedList(function(n,t){return o.songApi.getLikes(n,t,o.search)});this.albums=new n.PagedList(function(n,t){return o.albumApi.getLikedAlbums(n,t,o.search)});this.artists=new n.PagedList(function(n,t){return o.artistApi.getLikedArtists(n,t,o.search)});this.searchText="";this.activeCategory="Songs";this.allCategories=["Songs","Albums","Artists",];this.songs.take=20;this.albums.take=20;this.artists.take=20}return Object.defineProperty(t.prototype,"search",{get:function(){return this.searchText},set:function(n){this.searchText=n;this.fetchItemsForCurrentView()},enumerable:!1,configurable:!0}),t.prototype.$onInit=function(){this.songs.fetchNextChunk()},t.prototype.playSong=function(n){this.audioPlayer.playSongById(n.id)},t.prototype.playAlbum=function(n){this.audioPlayer.playSongFromAlbumId(n.id)},t.prototype.playArtist=function(n){this.audioPlayer.playSongFromArtist(n.name)},t.prototype.loadMoreSongs=function(){this.songs.fetchNextChunk()},t.prototype.loadMoreAlbums=function(){this.albums.fetchNextChunk()},t.prototype.loadMoreArtists=function(){this.artists.fetchNextChunk()},t.prototype.setCategory=function(n){this.activeCategory!==n&&(this.activeCategory=n,this.fetchItemsForCurrentView())},t.prototype.fetchItemsForCurrentView=function(){switch(this.activeCategory){case"Songs":this.songs.resetAndFetch();break;case"Albums":this.albums.resetAndFetch();break;case"Artists":this.artists.resetAndFetch()}},t.prototype.getFacebookShareUrl=function(n){return this.sharing.facebookShareUrl(n)},t.prototype.getTwitterShareUrl=function(n){return this.sharing.twitterShareUrl(n)},t.$inject=["songApi","albumApi","artistApi","audioPlayer","sharing","appNav"],t}();n.MyLikesController=t;n.App.controller("MyLikesController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r,u,f,e,o,s,h,c){var l=this,a;this.songApi=t;this.songBatch=i;this.audioPlayer=r;this.homeViewModel=u;this.appNav=f;this.accountApi=e;this.commentThreadApi=o;this.sharing=s;this.songRequestApi=h;this.$q=c;this.trending=new n.List(function(){return l.songApi.getTrendingSongs(0,3).then(function(n){return n.items})},"trending",n.SongApiService.songConverter);this.likes=new n.List(function(){return l.songApi.getRandomLikedSongs(3)},"mylikes",n.SongApiService.songConverter);this.recent=new n.List(function(){return l.getRecentPlays()},"recent",n.SongApiService.songConverter);this.popular=new n.List(function(){return l.songApi.getRandomPopular(3)},"popular",n.SongApiService.songConverter);this.newSongs=new n.List(function(){return l.songApi.getRandomNewSongs(3)},"newSongs",n.SongApiService.songConverter);this.recentSongRequests=new n.List(function(){return l.songRequestApi.getRandomRecentlyRequestedSongs(3)},"recentRequests",n.SongApiService.songConverter);this.songs=[];this.isFetchingAlbums=!1;this.disposed=new Rx.Subject;this.commentThread=null;this.isLoadingCommentThread=!1;this.newCommentText="";this.canNativeShare=!!navigator.share;this.audioPlayer.song.takeUntil(this.disposed).subscribeOnNext(function(n){return l.nextSongBeginning(n)});this.audioPlayer.songCompleted.takeUntil(this.disposed).throttle(5e3).subscribe(function(n){return l.songCompleted(n)});this.songBatch.songsBatch.takeUntil(this.disposed).subscribeOnNext(function(){return l.songs=l.getSongs()});u.embed?this.homeViewModel.song&&(this.audioPlayer.playNewSong(new n.Song(this.homeViewModel.song)),this.audioPlayer.pause()):(a=this.audioPlayer.song.getValue(),a||this.playSongInUrlQuery()||this.songBatch.playNext())}return Object.defineProperty(t.prototype,"currentArtistDonateUrl",{get:function(){var n=this.currentSong;return n&&n.artist?"#/donate/"+encodeURIComponent(n.artist):"#/donate"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCurrentSongPaused",{get:function(){return!!this.currentSong&&this.audioPlayer.status.getValue()===n.AudioStatus.Paused},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSongShareUrl",{get:function(){return this.currentSong?this.currentSong.isShowingEmbedCode?this.sharing.getEmbedCode(this.currentSong.id):this.sharing.shareUrl(this.currentSong.id):""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSongTwitterShareUrl",{get:function(){return this.currentSong?this.sharing.twitterShareUrl(this.currentSong):"#"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSongSmsShareUrl",{get:function(){return this.currentSong?this.sharing.smsShareUrl(this.currentSong):"#"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSongWhatsAppShareUrl",{get:function(){return this.currentSong?this.sharing.whatsAppShareUrl(this.currentSong):"#"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSongFacebookShareUrl",{get:function(){return this.currentSong?this.sharing.facebookShareUrl(this.currentSong):"#"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"commentsTitle",{get:function(){return!this.currentSong||this.currentSong.commentCount===0?"Comments":this.currentSong.commentCount===1?"1 comment":this.currentSong.commentCount+" comments"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentUserProfileUrl",{get:function(){return"/api/cdn/getuserprofile?userId="+(this.accountApi.currentUser?encodeURIComponent(this.accountApi.currentUser.id):"")},enumerable:!1,configurable:!0}),t.prototype.getEditSongUrl=function(){return this.currentSong?this.accountApi.isSignedIn?this.appNav.getEditSongUrl(this.currentSong.id):this.appNav.promptSignInUrl:"#"},t.prototype.$onInit=function(){this.currentSong&&(this.currentSong.areCommentsExpanded=!1)},t.prototype.$onDestroy=function(){this.recurringFetchHandle&&clearTimeout(this.recurringFetchHandle);this.disposed.onNext(!0)},t.prototype.pauseOverlayClicked=function(){this.currentSong&&this.audioPlayer.status.getValue()===n.AudioStatus.Paused&&this.audioPlayer.resume()},t.prototype.getSongs=function(){return[this.audioPlayer.song.getValue(),this.songBatch.songsBatch.getValue()[0],this.songBatch.songsBatch.getValue()[1],this.songBatch.songsBatch.getValue()[2],this.songBatch.songsBatch.getValue()[3]].filter(function(n){return!!n&&n.name})},t.prototype.getSongOrPlaceholder=function(t){return t||n.Song.empty()},t.prototype.getRecentPlays=function(){return this.accountApi.isSignedIn?this.songApi.getRecentPlays(3):this.$q.resolve(this.recent.items)},t.prototype.nextSongBeginning=function(n){this.songs=this.getSongs();n&&(this.currentSong&&(this.recent.items.splice(0,0,this.currentSong),this.recent.items=_.uniqBy(this.recent.items,function(n){return n.id}),this.recent.items.length>3&&(this.recent.items.length=3),this.recent.cache()),this.currentSong=n,this.commentThread=null)},t.prototype.songCompleted=function(n){n&&this.songApi.songCompleted(n.id)},t.prototype.songClicked=function(t){t!==this.currentSong&&(t.setSolePickReason(n.SongPick.YouRequestedSong),this.songBatch.playQueuedSong(t))},t.prototype.playSongFromCurrentArtist=function(){!this.currentSong||!this.currentSong.artistId||this.audioPlayer.playSongFromArtistId(this.currentSong.artistId)},t.prototype.playSongFromCurrentAlbum=function(){!this.currentSong||!this.currentSong.albumId||this.audioPlayer.playSongFromAlbumId(this.currentSong.albumId)},t.prototype.playSongWithTag=function(n){this.audioPlayer.playSongWithTag(n)},t.prototype.playSongInUrlQuery=function(){var i=this.getUrlQueryOrNull("song"),n,t;return i?(this.audioPlayer.playSongById(i),!0):(n=this.getUrlQueryOrNull("artist"),t=this.getUrlQueryOrNull("album"),n&&t)?(this.audioPlayer.playSongFromArtistAndAlbum(n,t),!0):t?(this.audioPlayer.playSongFromAlbum(t),!0):n?(this.audioPlayer.playSongFromArtist(n),!0):!1},t.prototype.copyShareUrl=function(){var n=document.querySelector("#currentSongShareLink");navigator.clipboard?navigator.clipboard.writeText(n.value):(n.select(),document.execCommand("copy"))},t.prototype.tryNativeShare=function(){this.currentSong&&this.sharing.nativeShare(this.currentSong)},t.prototype.toggleCommentThread=function(){var n=this;this.currentSong&&(this.currentSong.areCommentsExpanded=!this.currentSong.areCommentsExpanded,this.isLoadingCommentThread||this.commentThread||(this.isLoadingCommentThread=!0,this.commentThreadApi.get("commentThreads/"+this.currentSong.id).then(function(t){return n.commentThreadLoaded(t)}).finally(function(){return n.isLoadingCommentThread=!1})))},t.prototype.addNewComment=function(){var t=this,n,i;this.newCommentText.length>0&&this.commentThread&&this.accountApi.currentUser&&this.currentSong&&(n={content:this.newCommentText,date:(new Date).toISOString(),flagCount:0,lastFlagDate:null,userDisplayName:this.accountApi.currentUser.displayName,userId:this.accountApi.currentUser.id},this.commentThread.comments.push(n),this.newCommentText="",i=this.commentThread,this.commentThreadApi.addComment(n.content,this.commentThread.songId).then(function(n){t.commentThread===i&&(t.commentThread=n)}))},t.prototype.commentThreadLoaded=function(n){var t=this.currentSong&&this.currentSong.id.localeCompare(n.songId,undefined,{sensitivity:"base"})===0;t&&(this.commentThread=n)},t.prototype.getUrlQueryOrNull=function(n){var r=window.location.search,i,f;if(r){var e=r.split("&"),u=n+"=",o="?"+u,t=e.find(function(n){return n.startsWith(u)||n.startsWith(o)});if(t&&(i=t.substr(t.indexOf("=")+1),i))return f=i.split("+").join(" "),decodeURIComponent(f)}return null},t.$inject=["songApi","songBatch","audioPlayer","homeViewModel","appNav","accountApi","commentThreadApi","sharing","songRequestApi","$q"],t}();n.NowPlayingController=t;n.App.controller("NowPlayingController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var i=function(){function i(n,t,i,r,u,f){var e=this;this.accountApi=n;this.appNav=t;this.userApi=i;this.$timeout=u;this.email="";this.profilePic=null;this.showPasswordError=!1;this.passwordError="";this.isBusy=!1;this.password="";this.staySignedIn=!0;this.signInSuccessful=!1;this.showResendConfirmEmail=!1;this.sendConfirmationEmailState="none";this.email=r.email;f.$watch(function(){return e.password},function(){return e.passwordChanged()})}return Object.defineProperty(i.prototype,"isPasswordValid",{get:function(){return this.password.length>=6},enumerable:!1,configurable:!0}),i.prototype.$onInit=function(){var n=this;this.userApi.getProfilePicForEmailAddress(this.email).then(function(t){return n.profilePic=t})},i.prototype.signIn=function(){var i=this,n;if(!this.isPasswordValid){this.showPasswordError=!0;this.passwordError="Passwords must be at least 6 characters long.";return}this.isBusy||(this.isBusy=!0,n=new t,n.email=this.email,n.password=this.password,n.staySignedIn=this.staySignedIn,this.accountApi.signIn(n).then(function(n){return i.signInCompleted(n)},function(n){return i.signInErred(n)}).finally(function(){return i.isBusy=!1}))},i.prototype.signInCompleted=function(t){var i=this;t.status===n.SignInStatus.Success?(this.signInSuccessful=!0,this.$timeout(function(){return i.appNav.nowPlaying()},2e3)):t.status===n.SignInStatus.LockedOut?(this.showPasswordError=!0,this.passwordError="Your account is locked out. Please contact judahgabriel@gmail.com"):t.status===n.SignInStatus.RequiresVerification?(this.showPasswordError=!0,this.passwordError="Please check your email. We've sent you an email with a link to confirm your account.",this.showResendConfirmEmail=!0):t.status===n.SignInStatus.Failure?(this.showPasswordError=!0,this.passwordError="Incorrect password"):t.status===n.SignInStatus.Pwned&&(this.showPasswordError=!0,this.passwordError=t.errorMessage||"Select a different password because the password you chose has appeared in a data breach",this.$timeout(function(){return i.appNav.resetPwnedPassword(i.email)},4e3))},i.prototype.signInErred=function(n){this.showPasswordError=!0;this.passwordError="There was a problem signing in. If the problem keeps happening, email us: chavah@messianicradio.com. Error details: "+(n&&n.toString?n.toString():"[null]")},i.prototype.passwordChanged=function(){this.showPasswordError=!1;this.passwordError=""},i.prototype.sendConfirmationEmail=function(){var n=this;this.sendConfirmationEmailState="sending";this.accountApi.resendConfirmationEmail(this.email).then(function(){return n.sendConfirmationEmailState="sent"})},i.$inject=["accountApi","appNav","userApi","$routeParams","$timeout","$scope",],i}(),t;n.PasswordController=i;t=function(){function n(){}return n}();n.SignInModel=t;n.App.controller("PasswordController",i)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i){var r=this;this.songApi=t;this.appNav=i;this.songsList=new n.PagedList(function(n,t){return r.songApi.getPopular(n,t)})}return t.prototype.$onInit=function(){this.songsList.take=25;this.songsList.fetchNextChunk()},t.$inject=["songApi","appNav",],t}();n.PopularController=t;n.App.controller("PopularController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r,u){this.appNav=t;this.accountApi=i;this.userApi=r;this.pushNotifications=u;this.profilePicUrl=null;this.isSaving=!1;this.isUploadingPhoto=!1;this.hasSavedSuccessfully=!1;this.deviceSupportsPushNotifications=!1;this.isSubscribedPushNotifications=!1;this.showPushNotificationsBlocked=!1;this.user=new n.User(this.accountApi.currentUser);this.profilePicUrl=this.user.profilePicUrl;var f=moment(this.user.registrationDate);this.registrationDateAgo=f.fromNow()+" ("+f.format("dddd, MMMM Do YYYY, h:mm a")+")"}return Object.defineProperty(t.prototype,"isSavingOrUploading",{get:function(){return this.isSaving||this.isUploadingPhoto},enumerable:!1,configurable:!0}),t.prototype.$onInit=function(){this.loadPushNotificationState()},t.prototype.loadPushNotificationState=function(){return __awaiter(this,void 0,void 0,function(){var n,t,i;return __generator(this,function(r){switch(r.label){case 0:return n=this,[4,this.pushNotifications.isSupported()];case 1:return n.deviceSupportsPushNotifications=r.sent(),t=this,[4,this.pushNotifications.isSubscribed()];case 2:return t.isSubscribedPushNotifications=r.sent(),[4,this.pushNotifications.getStatus()];case 3:return i=r.sent(),this.showPushNotificationsBlocked=i==="denied",[2]}})})},t.prototype.launchImagePicker=function(){$("#imagePicker").click()},t.prototype.profilePicChanged=function(n){return __awaiter(this,void 0,void 0,function(){var r,i,t,u;return __generator(this,function(f){switch(f.label){case 0:return!this.isSaving?(r=n.target.files,i=r.item(0),!i)?[3,5]:[4,this.appNav.cropImageModal(i).result]:[3,5];case 1:if(t=f.sent(),!(t&&t.image))return[3,5];t.imageBase64&&(this.profilePicUrl=t.imageBase64);this.isUploadingPhoto=!0;this.hasSavedSuccessfully=!1;f.label=2;case 2:return f.trys.push([2,,4,5]),[4,this.userApi.updateProfilePic(t.image)];case 3:return u=f.sent(),this.profilePicUrl=u,this.hasSavedSuccessfully=!0,[3,5];case 4:return this.isUploadingPhoto=!1,[7];case 5:return[2]}})})},t.prototype.subscribeToPushNotifications=function(){return __awaiter(this,void 0,void 0,function(){var n,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.pushNotifications.isSubscribed()];case 1:return(n=i.sent(),n)?[2]:[4,this.pushNotifications.askPermission()];case 2:if(t=i.sent(),!(t==="granted"))return[3,6];this.isSaving=!0;i.label=3;case 3:return i.trys.push([3,,5,6]),[4,this.pushNotifications.subscribe()];case 4:return i.sent(),[3,6];case 5:return this.isSaving=!1,[7];case 6:return this.loadPushNotificationState(),[2]}})})},t.prototype.unsubscribeFromPushNotifications=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:this.isSaving=!0;n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.pushNotifications.unsubscribe()];case 2:return n.sent(),[3,4];case 3:return this.isSaving=!1,[7];case 4:return this.loadPushNotificationState(),[2]}})})},t.prototype.save=function(){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(t){switch(t.label){case 0:if(!!this.isSaving)return[3,4];this.isSaving=!0;this.hasSavedSuccessfully=!1;t.label=1;case 1:return t.trys.push([1,,3,4]),[4,this.userApi.updateProfile(this.user)];case 2:return n=t.sent(),this.hasSavedSuccessfully=!0,this.profileSaved(n),[3,4];case 3:return this.isSaving=!1,[7];case 4:return[2]}})})},t.prototype.profileSaved=function(n){this.accountApi.currentUser&&this.accountApi.currentUser.updateFrom(n)},t.$inject=["appNav","accountApi","userApi","pushNotifications"],t}();n.ProfileController=t;n.App.controller("ProfileController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r){var u=this;this.songApi=t;this.$q=i;this.appNav=r;this.songsList=new n.PagedList(function(n,t){return u.getRecentSongsAsPagedList(n,t)})}return t.prototype.$onInit=function(){this.songsList.take=25;this.songsList.fetchNextChunk()},t.prototype.getRecentSongsAsPagedList=function(n,t){var i=this.$q.defer();return this.songApi.getRecentPlays(this.songsList.take).then(function(r){var u={items:r,skip:n,take:t,total:r.length};i.resolve(u)}),i.promise},t.$inject=["songApi","$q","appNav"],t}();n.RecentController=t;n.App.controller("RecentController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var i=function(){function n(n,t,i){this.accountApi=n;this.appNav=t;this.email="";this.password="";this.confirmPassword="";this.showEmailError=!1;this.showPasswordError=!1;this.showRegisterSuccess=!1;this.showAlreadyRegistered=!1;this.showNeedsConfirmation=!1;this.showPasswordIsPwned=!1;this.registrationError="";this.isBusy=!1;var r=i.email;r&&(this.email=r)}return Object.defineProperty(n.prototype,"isValidEmail",{get:function(){return!!this.email&&this.email.lastIndexOf("@")>=0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isValidPassword",{get:function(){return!!this.password&&this.password.length>=6},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isMatchingPassword",{get:function(){return this.isValidPassword&&this.password!==this.confirmPassword},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"showRegisterForm",{get:function(){return!this.showAlreadyRegistered&&!this.showNeedsConfirmation&&!this.showRegisterSuccess},enumerable:!1,configurable:!0}),n.prototype.register=function(){var i=this,n;if(this.reset(),!this.isValidEmail){this.showEmailError=!0;return}if(!this.isValidPassword){this.showPasswordError=!0;return}this.isBusy||(this.isBusy=!0,n=new t,n.email=this.email,n.password=this.password,n.confirmPassword=this.password,this.accountApi.register(n).then(function(n){return i.registrationCompleted(n)}).finally(function(){return i.isBusy=!1}))},n.prototype.registrationCompleted=function(n){n.success?this.showRegisterSuccess=!0:n.needsConfirmation?this.showNeedsConfirmation=!0:n.isAlreadyRegistered?this.showAlreadyRegistered=!0:n.isPwned?this.showPasswordIsPwned=!0:this.registrationError=n.errorMessage||"Unable to register your user. Please contact judahgabriel@gmail.com"},n.prototype.reset=function(){this.registrationError="";this.showAlreadyRegistered=!1;this.showEmailError=!1;this.showNeedsConfirmation=!1;this.showPasswordError=!1;this.showRegisterSuccess=!1;this.showPasswordIsPwned=!1},n.$inject=["accountApi","appNav","$routeParams"],n}(),t;n.RegisterController=i;t=function(){function n(){}return n}();n.RegisterModel=t;n.App.controller("RegisterController",i)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r){this.songApi=n;this.templatePaths=t;this.$uibModalInstance=i;this.$q=r;this.songRequestText="";this.isLoading=!1;this.songRequestResultView=t.songRequestResult}return n.prototype.getSongMatches=function(n){var i=this,r=10,t=this.$q.defer();return this.isLoading=!0,this.songApi.getSongMatches(n).then(function(n){return t.resolve(n.slice(0,r))}).catch(function(n){return t.reject(n)}).finally(function(){var t=n===i.songRequestText;t&&(i.isLoading=!1)}),t.promise},n.prototype.songChosen=function(n){this.selectedSongRequest=n},n.prototype.requestSelectedSong=function(){this.selectedSongRequest&&this.$uibModalInstance.close(this.selectedSongRequest)},n.prototype.close=function(){this.$uibModalInstance.close(null)},n.$inject=["songApi","templatePaths","$uibModalInstance","$q",],n}();n.RequestSongController=t;n.App.controller("RequestSongController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t){this.accountApi=n;this.$routeParams=t;this.email="";this.password="";this.showPasswordError=!1;this.isBusy=!1;this.passwordResetSucccessful=!1;this.passwordResetFailed=!1;this.passwordResetFailedMessage="";this.email=t.email;var r=t.confirmCode,i=t.confirmCode||"";this.confirmCode=i.replace(new RegExp("___","g"),"/")}return Object.defineProperty(n.prototype,"isValidPassword",{get:function(){return!!this.password&&this.password.length>=6&&!!this.password.match(n.regexContainsLetterAndNumber)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"showChangePasswordForm",{get:function(){return!this.passwordResetSucccessful&&!this.passwordResetFailed},enumerable:!1,configurable:!0}),n.prototype.changePassword=function(){var n=this;if(!this.isValidPassword){this.showPasswordError=!0;return}this.isBusy||(this.resetValidationStates(),this.isBusy=!0,this.accountApi.resetPassword(this.email,this.confirmCode,this.password).then(function(t){return n.passwordResetCompleted(t)}).finally(function(){return n.isBusy=!1}))},n.prototype.passwordResetCompleted=function(n){n.success?this.passwordResetSucccessful=!0:(this.passwordResetFailed=!0,this.passwordResetFailedMessage=n.errorMessage)},n.prototype.resetValidationStates=function(){this.passwordResetFailed=!1;this.passwordResetFailedMessage="";this.passwordResetSucccessful=!1;this.showPasswordError=!1},n.regexContainsLetterAndNumber=/^(?=.*[a-zA-Z])(?=.*[0-9])/,n.$inject=["accountApi","$routeParams"],n}();n.ResetPasswordController=t;n.App.controller("ResetPasswordController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.artist=n.artist}return Object.defineProperty(n.prototype,"donateUrl",{get:function(){return this.artist?"#/donate/"+encodeURIComponent(this.artist):"#/donate"},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"donateText",{get:function(){return this.artist?"Donate to "+this.artist:"Donate to the artists"},enumerable:!1,configurable:!0}),n.$inject=["$routeParams",],n}();n.ShareThanksController=t;n.App.controller("ShareThanksController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this;this.accountApi=n;this.appNav=t;this.email="";this.showEmailError=!1;this.showUserNotInSystem=!1;this.isBusy=!1;i.$watch(function(){return r.email},function(){return r.showUserNotInSystem=!1})}return Object.defineProperty(n.prototype,"registerUrl",{get:function(){return this.email&&this.email.indexOf("@")>=0?"#/register/"+this.email:"#/register"},enumerable:!1,configurable:!0}),n.prototype.checkEmail=function(){var n=this;this.email?this.isBusy||(this.resetValidationStates(),this.isBusy=!0,this.accountApi.getUserWithEmail(this.email).then(function(t){return n.userFetched(t)}).finally(function(){return n.isBusy=!1})):this.showEmailError=!0},n.prototype.userFetched=function(n){n==null?this.showUserNotInSystem=!0:n.requiresPasswordReset?this.appNav.createPassword(this.email):this.appNav.password(this.email)},n.prototype.resetValidationStates=function(){this.showUserNotInSystem=!1;this.showEmailError=!1},n.$inject=["accountApi","appNav","$scope",],n}();n.SignInController=t;n.App.controller("SignInController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t){this.audioPlayer=n;this.sharing=t;this.canNativeShare=this.sharing.canNativeShare}return t.prototype.$onInit=function(){this.songs.items.length===0&&(this.songs.fetchNextChunk(),this.sharing.nativeShare)},t.prototype.playSong=function(t){var i=new n.Song(t);i.setSolePickReason(n.SongPick.YouRequestedSong);this.audioPlayer.playNewSong(i)},t.$inject=["audioPlayer","sharing"],t}();n.SongDeckController=t;n.App.component("songDeck",{templateUrl:n.FindAppView("SongDeck.html"),controller:t,controllerAs:"vm",bindings:{songs:n.AngularBindings.OneWay,showLoadMore:n.AngularBindings.OneWay}})})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){this.artist=n.artist;this.songName=n.songName}return n.$inject=["$routeParams",],n}();n.SongEditApprovedController=t;n.App.controller("SongEditApprovedController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(n,t){this.audioPlayer=n;this.$q=t;this.refreshHandle=null}return t.prototype.$onInit=function(){var n=this;this.songs.items.length===0&&setTimeout(function(){return n.fetchSongs()},Math.random()*5e3);this.refreshInterval||(this.refreshInterval=6e4);this.refreshInterval!==-1&&(this.refreshHandle=setInterval(function(){return n.fetchSongs()},this.refreshInterval+Math.random()*3e3))},t.prototype.$onDestroy=function(){this.refreshHandle&&clearInterval(this.refreshHandle)},t.prototype.playSong=function(t){var i=new n.Song(t);i.setSolePickReason(n.SongPick.YouRequestedSong);this.audioPlayer.playNewSong(i)},t.prototype.fetchSongs=function(){this.songs instanceof n.List?this.songs.fetch():this.songs.refresh()},t.$inject=["audioPlayer","$q"],t}();n.SongListController=t;n.App.component("songList",{templateUrl:n.FindAppView("SongList.html"),controller:t,controllerAs:"vm",bindings:{songs:n.AngularBindings.OneWay,refreshInterval:n.AngularBindings.OneWay}})})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.accountApi=n;this.name="";this.email="";this.message="";this.isSaving=!1;this.state="unsubmitted";this.accountApi.signedInState.select(function(){return t.accountApi.currentUser}).subscribe(function(n){return t.signedInUserChanged(n)});n.currentUser&&(this.email=n.currentUser.email)}return Object.defineProperty(n.prototype,"canSubmit",{get:function(){return!this.isSaving&&!!this.message&&this.message.length>0&&!!this.email&&this.email.length>0&&!!this.name&&this.name.length>0},enumerable:!1,configurable:!0}),n.prototype.submit=function(){var n=this;this.canSubmit&&(this.isSaving=!0,this.accountApi.sendSupportMessage(this.name,this.email,this.message,window.navigator.userAgent).then(function(){return n.state="success"},function(){return n.state="error"}).finally(function(){return n.isSaving=!1}))},n.prototype.signedInUserChanged=function(n){n&&(this.email=n.email)},n.$inject=["accountApi"],n}();n.SupportController=t;n.App.controller("SupportController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function n(n){var t=this;this.tagApi=n;this.allTags=[];this.selectedTag=null;this.newTagName="";this.isSaving=!1;this.tagApi.getAll().then(function(n){return t.allTags=n.sort()})}return n.prototype.selectTag=function(n){this.newTagName=n||"";this.selectedTag=n},n.prototype.deleteTag=function(n){var t=this;this.isSaving||(this.isSaving=!0,this.tagApi.deleteTag(n).then(function(){_.pull(t.allTags,n);t.selectTag(null)}).finally(function(){return t.isSaving=!1}))},n.prototype.renameTag=function(n){var t=this,i=this.newTagName;this.isSaving||i===n||(this.isSaving=!0,this.tagApi.renameTag(n,i).then(function(r){var u=t.allTags.indexOf(n);u>=0&&(t.allTags[u]=r,t.allTags=_.uniq(t.allTags));t.selectTag(i)}).finally(function(){return t.isSaving=!1}))},n.$inject=["tagApi"],n}();n.TagEditorController=t;n.App.controller("TagEditorController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i){var r=this;this.songApi=t;this.appNav=i;this.songsList=new n.PagedList(function(n,t){return r.songApi.getTrendingSongs(n,t)})}return t.prototype.$onInit=function(){this.songsList.take=25;this.songsList.fetchNextChunk()},t.$inject=["songApi","appNav"],t}();n.TrendingController=t;n.App.controller("TrendingController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={})),function(n){var t;(function(n){var t=function(){function t(t,i,r,u){this.albumApi=t;this.appNav=i;this.$scope=r;this.$q=u;this.albumName="";this.artistName="";this.albumHebrewName=null;this.songs=[];this.isSaving=!1;this.albumArt=null;this.purchaseUrl="";this.genre="";this.uploadError=null;this.allGenres=["Messianic Jewish","Hebrew Roots","Jewish Christian","Jewish","Christian"];this.foreColor=n.Song.defaultSwatch.getBodyTextColor();this.backColor=n.Song.defaultSwatch.getHex();this.mutedColor=n.Song.defaultSwatch.getHex();this.textShadowColor=n.Song.defaultSwatch.getBodyTextColor();this.allAlbumSwatches=[]}return Object.defineProperty(t.prototype,"isUploadingMediaFiles",{get:function(){return this.songs.some(function(n){return n.status==="uploading"})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anySongsFailedToUpload",{get:function(){return this.songs.some(function(n){return n.status==="failed"})},enumerable:!1,configurable:!0}),t.prototype.chooseSongs=function(){$("#chooseMp3sInput").click()},t.prototype.chooseAlbumArt=function(){$("#chooseAlbumArtInput").click()},t.prototype.songsChosen=function(n){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(){return t=n.target,t&&t.files&&t.files.length>0&&(this.addFilesToUploadQueue(Array.from(t.files)),this.$scope.$applyAsync()),[2]})})},t.prototype.albumArtChosen=function(n){return __awaiter(this,void 0,void 0,function(){var t,r,i,u=this;return __generator(this,function(){return t=n.target,t&&t.files&&t.files.length===1&&(r=t.files[0],i=this.createMediaFileUpload(r),i.status="uploading",this.albumArt=i,this.albumApi.uploadTempFile(r).then(function(n){return u.albumArtUploadSucceeded(i,n)}).catch(function(n){return u.albumArtUploadFailed(i,n)})),this.$scope.$applyAsync(),[2]})})},t.prototype.albumArtUploadSucceeded=function(n,t){this.markUploadAsCompleted(n,t);this.reloadAlbumColorSwatches(t.url)},t.prototype.albumArtUploadFailed=function(n,t){this.markUploadAsFailed(n,t)},t.prototype.addFilesToUploadQueue=function(n){var t,i=this,r=n.sort(function(n,t){return n.name<t.name?-1:n.name>t.name?1:0}).map(function(n){return i.createMediaFileUpload(n)});(t=this.songs).push.apply(t,r);this.processFileUploads()},t.prototype.createMediaFileUpload=function(n){return{file:n,name:t.songNameFromFileName(n.name),error:null,url:null,status:"queued",id:null}},t.prototype.processFileUploads=function(){var t=this,n=this.songs.find(function(n){return n.status==="queued"});n&&(n.status="uploading",this.albumApi.uploadTempFile(n.file).then(function(i){return t.songUploadSucceeded(n,i)}).catch(function(i){return t.songUploadFailed(n,i)}).finally(function(){return t.processFileUploads()}))},t.prototype.songUploadSucceeded=function(n,t){this.markUploadAsCompleted(n,t)},t.prototype.songUploadFailed=function(n,t){this.markUploadAsFailed(n,t)},t.prototype.markUploadAsCompleted=function(n,t){n.status="completed";n.url=t.url;n.id=t.id;n.error=null},t.prototype.markUploadAsFailed=function(n,t){n.status="failed";n.url=null;n.error=JSON.stringify(t||"failed to upload file")},t.prototype.reloadAlbumColorSwatches=function(i){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(u){switch(u.label){case 0:return[4,this.fetchAlbumColorSwatches(i)];case 1:return r=u.sent(),r&&(this.allAlbumSwatches=t.getFriendlySwatches(r),this.backColor=(r.DarkVibrant||r.DarkMuted||n.Song.defaultSwatch).getHex(),this.foreColor=(r.LightVibrant||r.Vibrant||n.Song.defaultSwatch).getHex(),this.mutedColor=(r.DarkMuted||r.DarkVibrant||r.Vibrant||n.Song.defaultSwatch).getBodyTextColor(),this.textShadowColor=(r.DarkMuted||r.DarkVibrant||n.Song.defaultSwatch).getHex()),[2]}})})},t.prototype.fetchAlbumColorSwatches=function(n){var t=document.createElement("img"),i=this.$q.defer();return t.crossOrigin="Anonymous",t.src="/api/albums/imageOnDomain?imageUrl="+encodeURIComponent(n),t.addEventListener("load",function(){var n=new Vibrant(t,64,5),r=n.swatches();i.resolve(r)},{once:!0}),t.addEventListener("error",function(n){return i.reject(n)},{once:!0}),i.promise},t.prototype.moveSongUp=function(n){var t=this.songs.indexOf(n),i;t>0&&(i=t-1,this.songs.splice(t,1),this.songs.splice(i,0,n))},t.prototype.moveSongDown=function(n){var t=this.songs.indexOf(n),i;t<this.songs.length-1&&(i=t+1,this.songs.splice(t,1),this.songs.splice(i,0,n))},t.prototype.removeSong=function(n){var t=this.songs.indexOf(n);t>=0&&this.songs.splice(t,1)},t.prototype.hexToRgbString=function(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t&&t.length>=4?"rgb("+parseInt(t[1],16)+", "+parseInt(t[2],16)+", "+parseInt(t[3],16)+")":""},t.prototype.upload=function(){var i=this,n;if(this.uploadError=null,!this.albumArt||!this.albumArt.url){this.uploadError="Must have album art.";return}if(!this.albumName){this.uploadError="Must have album name.";return}if(!this.artistName){this.uploadError="Must have an artist";return}if(this.isUploadingMediaFiles){this.uploadError="Song upload is still progress";return}if(this.songs.some(function(n){return!n.url||!n.id})){this.uploadError="Some songs haven't finished uploading";return}this.isSaving||(n={albumArt:t.mediaUploadToTempFile(this.albumArt),artist:this.artistName,backColor:this.backColor,foreColor:this.foreColor,genres:this.genre,mutedColor:this.mutedColor,name:this.albumName,hebrewName:this.albumHebrewName,purchaseUrl:this.purchaseUrl,songs:this.songs?this.songs.map(t.mediaUploadToTempFile):[],textShadowColor:this.textShadowColor},this.isSaving=!0,this.albumApi.upload(n).then(function(){return i.appNav.editAlbum(n.artist,n.name)}).finally(function(){return i.isSaving=!1}))},t.songNameFromFileName=function(n){var t=n,r=t.lastIndexOf("."),i;return r>0&&(t=t.substring(0,r)),i=t.lastIndexOf(" - "),i>=0&&(t=t.substr(i+3)),t},t.mediaUploadToTempFile=function(n){if(!n.id)throw new Error("Media file "+n.name+" hasn't been uploaded");return{name:n.name,url:n.url,id:n.id}},t.getFriendlySwatches=function(n){return Object.getOwnPropertyNames(n).filter(function(t){return!!n[t]}).map(function(t){var i=n[t];return{name:t,color:i.getHex(),titleTextColor:i.getTitleTextColor(),bodyTextColor:i.getBodyTextColor()}})},t.$inject=["albumApi","appNav","$scope","$q"],t}();n.UploadAlbumController=t;n.App.controller("UploadAlbumController",t)})(t=n.Chavah||(n.Chavah={}))}(BitShuva||(BitShuva={}));